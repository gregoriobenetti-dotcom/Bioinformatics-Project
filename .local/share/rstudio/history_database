1760388406699:# Load required packages
1760388406700:library(tidyverse)
1760389440578:# Load required packages
1760389440579:library(tidyverse)
1760389655069:# Load required packages
1760389655069:library(tidyverse)
1760389678050:install.packages(tidyverse)
1760389695397:install.packages("tidyverse")
1760389880697:# Load required packages
1760389880698:library(tidyverse)
1760389881233:# === 1. Load data ===
1760389881233:# (update filenames if needed)
1760389881233:bulk_counts <- read_csv("bulk_counts_long.csv")
1760389881339:metadata <- read_csv("sample_metadata.csv")
1760389881379:# Inspect the data structure
1760389881379:# glimpse(bulk_counts)
1760389881379:# glimpse(metadata)
1760389881379:# === 2. Process data ===
1760389881379:results <- bulk_counts %>%
1760389881380:# Join metadata
1760389881380:left_join(metadata, by = "sample_id") %>%
1760389881380:# Filter for treated samples and genes starting with "GENE_00"
1760389881380:filter(condition == "treated", str_starts(gene_id, "GENE_00")) %>%
1760389881380:# === 3. Summarize mean and median count by gene ===
1760389881381:group_by(gene_id) %>%
1760389881381:summarise(
1760389881381:mean_count = mean(count, na.rm = TRUE),
1760389881381:median_count = median(count, na.rm = TRUE)
1760389881381:) %>%
1760389881382:# === 4. Join again to compute per-condition mean ===
1760389881382:left_join(
1760389881382:bulk_counts %>%
1760389881382:left_join(metadata, by = "sample_id") %>%
1760389881382:group_by(gene_id, condition) %>%
1760389881382:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760389881383:by = "gene_id"
1760389881383:)
1760389899083:# Load required packages
1760389899084:library(tidyverse)
1760389899085:# === 1. Load data ===
1760389899086:# (update filenames if needed)
1760389899086:bulk_counts <- read_csv("bulk_counts_long.csv")
1760389899159:metadata <- read_csv("sample_metadata.csv")
1760389899196:# Inspect the data structure
1760389899196:# glimpse(bulk_counts)
1760389899196:# glimpse(metadata)
1760389899197:# === 2. Process data ===
1760389899197:results <- bulk_counts %>%
1760389899197:# Join metadata
1760389899197:left_join(metadata, by = "sample_id") %>%
1760389899197:# Filter for treated samples and genes starting with "GENE_00"
1760389899197:filter(condition == "treated", str_starts(gene_id, "GENE_00")) %>%
1760389899198:# === 3. Summarize mean and median count by gene ===
1760389899198:group_by(gene_id) %>%
1760389899198:summarise(
1760389899198:mean_count = mean(count, na.rm = TRUE),
1760389899198:median_count = median(count, na.rm = TRUE)
1760389899198:) %>%
1760389899199:# === 4. Join again to compute per-condition mean ===
1760389899199:left_join(
1760389899199:bulk_counts %>%
1760389899199:left_join(metadata, by = "sample_id") %>%
1760389899199:group_by(gene_id, condition) %>%
1760389899199:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760389899200:by = "gene_id"
1760389899200:)
1760390106781:View(metadata)
1760390111611:View(bulk_counts)
1760390184202:# Install required packages (run once if needed)
1760390184203:# install.packages(c("dplyr", "readr", "stringr"))
1760390184204:library(dplyr)
1760390184205:library(readr)
1760390184206:library(stringr)
1760390184206:# === 1. Load data ===
1760390184207:bulk_counts <- read_csv("bulk_counts_long.csv")
1760390184299:metadata <- read_csv("sample_metadata.csv")
1760390184337:# === 2. Process and summarize ===
1760390184337:results <- bulk_counts %>%
1760390184337:left_join(metadata, by = "sample_id") %>%
1760390184337:filter(condition == "treated", str_starts(gene_id, "GENE_00")) %>%
1760390184338:group_by(gene) %>%
1760390184338:summarise(
1760390184338:mean_count = mean(count, na.rm = TRUE),
1760390184338:median_count = median(count, na.rm = TRUE)
1760390184338:) %>%
1760390184338:left_join(
1760390184339:bulk_counts %>%
1760390184339:left_join(metadata, by = "sample_id") %>%
1760390184339:group_by(gene_id, condition) %>%
1760390184339:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760390184339:by = "gene_id"
1760390184339:)
1760390221978:# Install required packages (run once if needed)
1760390221979:# install.packages(c("dplyr", "readr", "stringr"))
1760390221980:library(dplyr)
1760390221981:library(readr)
1760390221981:library(stringr)
1760390221983:# === 1. Load data ===
1760390221984:bulk_counts <- read_csv("bulk_counts_long.csv")
1760390222053:metadata <- read_csv("sample_metadata.csv")
1760390222093:# === 2. Process and summarize ===
1760390222093:results <- bulk_counts %>%
1760390222093:left_join(metadata, by = "sample_id") %>%
1760390222094:filter(condition == "treated", str_starts(gene, "GENE_00")) %>%
1760390222094:group_by(gene) %>%
1760390222094:summarise(
1760390222094:mean_count = mean(count, na.rm = TRUE),
1760390222094:median_count = median(count, na.rm = TRUE)
1760390222095:) %>%
1760390222095:left_join(
1760390222095:bulk_counts %>%
1760390222095:left_join(metadata, by = "sample_id") %>%
1760390222095:group_by(gene_id, condition) %>%
1760390222096:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760390222096:by = "gene"
1760390222096:)
1760390265592:# Install required packages (run once if needed)
1760390265593:# install.packages(c("dplyr", "readr", "stringr"))
1760390265594:library(dplyr)
1760390265595:library(readr)
1760390265595:library(stringr)
1760390265596:# === 1. Load data ===
1760390265597:bulk_counts <- read_csv("bulk_counts_long.csv")
1760390265709:metadata <- read_csv("sample_metadata.csv")
1760390265765:# === 2. Process and summarize ===
1760390265765:results <- bulk_counts %>%
1760390265765:left_join(metadata, by = "sample_id") %>%
1760390265766:filter(condition == "treated", str_starts(gene, "GENE_00")) %>%
1760390265766:group_by(gene) %>%
1760390265766:summarise(
1760390265766:mean_count = mean(count, na.rm = TRUE),
1760390265766:median_count = median(count, na.rm = TRUE)
1760390265766:) %>%
1760390265767:left_join(
1760390265767:bulk_counts %>%
1760390265767:left_join(metadata, by = "sample_id") %>%
1760390265767:group_by(gene, condition) %>%
1760390265767:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760390265767:by = "gene"
1760390265768:)
1760390265784:# === 3. Save results ===
1760390265784:write_csv(results, "filtered_summarized_counts.csv")
1760390265797:print(results)
1760390296648:View(results)
1760390300480:View(results)
1760390308097:View(results)
1760390309313:View(results)
1760390570254:getwd()
1760390589563:View(results)
1760462880215:# Load required packages
1760462880217:library(tidyverse)
1760462880220:# === 1. Load data ===
1760462880220:# (update filenames if needed)
1760462880221:bulk_counts <- read_csv("bulk_counts_long.csv")
1760462880369:metadata <- read_csv("sample_metadata.csv")
1760462880415:# Inspect the data structure
1760462880416:# glimpse(bulk_counts)
1760462880416:# glimpse(metadata)
1760462880416:# === 2. Process data ===
1760462880416:results <- bulk_counts %>%
1760462880416:# Join metadata
1760462880417:left_join(metadata, by = "sample_id") %>%
1760462880417:# Filter for treated samples and genes starting with "GENE_00"
1760462880417:filter(condition == "treated", str_starts(gene_id, "GENE_00")) %>%
1760462880417:# === 3. Summarize mean and median count by gene ===
1760462880418:group_by(gene_id) %>%
1760462880418:summarise(
1760462880418:mean_count = mean(count, na.rm = TRUE),
1760462880418:median_count = median(count, na.rm = TRUE)
1760462880418:) %>%
1760462880418:# === 4. Join again to compute per-condition mean ===
1760462880419:left_join(
1760462880419:bulk_counts %>%
1760462880419:left_join(metadata, by = "sample_id") %>%
1760462880419:group_by(gene_id, condition) %>%
1760462880419:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760462880419:by = "gene_id"
1760462880420:)
1760462977874:# Load required packages
1760462977875:library(data.table)
1760462977947:# === 1. Load data ===
1760462977948:# (update filenames if needed)
1760462977948:bulk_counts <- read_csv("bulk_counts_long.csv")
1760462977988:metadata <- read_csv("sample_metadata.csv")
1760462978023:# Inspect the data structure
1760462978023:# glimpse(bulk_counts)
1760462978024:# glimpse(metadata)
1760462978024:# === 2. Process data ===
1760462978024:results <- bulk_counts %>%
1760462978024:# Join metadata
1760462978024:left_join(metadata, by = "sample_id") %>%
1760462978025:# Filter for treated samples and genes starting with "GENE_00"
1760462978025:filter(condition == "treated", str_starts(gene, "GENE_00")) %>%
1760462978025:# === 3. Summarize mean and median count by gene ===
1760462978025:group_by(gene_id) %>%
1760462978025:summarise(
1760462978026:mean_count = mean(count, na.rm = TRUE),
1760462978026:median_count = median(count, na.rm = TRUE)
1760462978026:) %>%
1760462978026:# === 4. Join again to compute per-condition mean ===
1760462978026:left_join(
1760462978027:bulk_counts %>%
1760462978027:left_join(metadata, by = "sample_id") %>%
1760462978027:group_by(gene, condition) %>%
1760462978027:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760462978027:by = "gene"
1760462978027:)
1760463016142:# Load required packages
1760463016143:library(tidyverse)
1760463016144:# === 1. Load data ===
1760463016144:# (update filenames if needed)
1760463016144:bulk_counts <- read_csv("bulk_counts_long.csv")
1760463016211:metadata <- read_csv("sample_metadata.csv")
1760463016250:# Inspect the data structure
1760463016250:# glimpse(bulk_counts)
1760463016250:# glimpse(metadata)
1760463016250:# === 2. Process data ===
1760463016250:results <- bulk_counts %>%
1760463016251:# Join metadata
1760463016251:left_join(metadata, by = "sample_id") %>%
1760463016251:# Filter for treated samples and genes starting with "GENE_00"
1760463016251:filter(condition == "treated", str_starts(gene, "GENE_00")) %>%
1760463016252:# === 3. Summarize mean and median count by gene ===
1760463016252:group_by(gene) %>%
1760463016252:summarise(
1760463016252:mean_count = mean(count, na.rm = TRUE),
1760463016252:median_count = median(count, na.rm = TRUE)
1760463016252:) %>%
1760463016253:# === 4. Join again to compute per-condition mean ===
1760463016253:left_join(
1760463016253:bulk_counts %>%
1760463016253:left_join(metadata, by = "sample_id") %>%
1760463016253:group_by(gene, condition) %>%
1760463016253:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760463016254:by = "gene"
1760463016254:)
1760463016269:# === 5. Save results ===
1760463016270:write_csv(results, "filtered_summarized_counts.csv")
1760463016280:# Print preview
1760463016280:print(results)
1760521235861:# Print preview
1760521235862:print(results)
1760521574263:# Load required packages
1760521574264:library(data.table)
1760521574266:# === 1. Load data ===
1760521574266:# (update filenames if needed)
1760521574267:bulk_counts <- read_csv("bulk_counts_long.csv")
1760521612890:# Load required packages
1760521612890:library(data.table)
1760521613405:# === 1. Load data ===
1760521613406:# (update filenames if needed)
1760521613406:bulk_counts <- read_csv("workspace/r.bulk_counts_long.csv")
1760521661972:# Load required packages
1760521661973:library(data.table)
1760521662423:# === 1. Load data ===
1760521662424:# (update filenames if needed)
1760521662424:bulk_counts <- read_csv("workspace/home/rstudio.bulk_counts_long.csv")
1760521682139:# Load required packages
1760521682141:library(data.table)
1760521682655:# === 1. Load data ===
1760521682655:# (update filenames if needed)
1760521682656:bulk_counts <- read_csv("/home/worksoace/rstudio.bulk_counts_long.csv")
1760521701989:# Load required packages
1760521701989:library(data.table)
1760521702403:# === 1. Load data ===
1760521702404:# (update filenames if needed)
1760521702405:bulk_counts <- read_csv("/home/workspace/bulk_counts_long.csv")
1760521714454:# Load required packages
1760521714454:library(data.table)
1760521715092:# === 1. Load data ===
1760521715095:# (update filenames if needed)
1760521715095:bulk_counts <- read_csv("/home/workspace/rstudiobulk_counts_long.csv")
1760521744205:# Load required packages
1760521744205:library(data.table)
1760521745022:# === 1. Load data ===
1760521745023:# (update filenames if needed)
1760521745023:bulk_counts <- read_csv("workspace/bulk_counts_long.csv")
1760521748388:metadata <- read_csv("sample_metadata.csv")
1760521749305:# === 2. Process data ===
1760521749306:results <- bulk_counts %>%
1760521749306:# Join metadata
1760521749307:left_join(metadata, by = "sample_id") %>%
1760521749308:# Filter for treated samples and genes starting with "GENE_00"
1760521749308:filter(condition == "treated", str_starts(gene_id, "GENE_00")) %>%
1760521749308:# === 3. Summarize mean and median count by gene ===
1760521749308:group_by(gene_id) %>%
1760521749309:summarise(
1760521749309:mean_count = mean(count, na.rm = TRUE),
1760521749310:median_count = median(count, na.rm = TRUE)
1760521749310:) %>%
1760521749310:# === 4. Join again to compute per-condition mean ===
1760521749311:left_join(
1760521749311:bulk_counts %>%
1760521749311:left_join(metadata, by = "sample_id") %>%
1760521749312:group_by(gene_id, condition) %>%
1760521749312:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760521749312:by = "gene_id"
1760521749313:)
1760521776655:# Load required packages
1760521776655:library(data.table)
1760521777305:# === 1. Load data ===
1760521777306:# (update filenames if needed)
1760521777307:bulk_counts <- read_csv("workspace/bulk_counts_long.csv")
1760521778586:metadata <- read_csv("workspace/sample_metadata.csv")
1760521781338:# === 2. Process data ===
1760521781339:results <- bulk_counts %>%
1760521781339:# Join metadata
1760521781340:left_join(metadata, by = "sample_id") %>%
1760521781340:# Filter for treated samples and genes starting with "GENE_00"
1760521781341:filter(condition == "treated", str_starts(gene_id, "GENE_00")) %>%
1760521781341:# === 3. Summarize mean and median count by gene ===
1760521781342:group_by(gene_id) %>%
1760521781342:summarise(
1760521781342:mean_count = mean(count, na.rm = TRUE),
1760521781343:median_count = median(count, na.rm = TRUE)
1760521781343:) %>%
1760521781344:# === 4. Join again to compute per-condition mean ===
1760521781344:left_join(
1760521781344:bulk_counts %>%
1760521781345:left_join(metadata, by = "sample_id") %>%
1760521781345:group_by(gene_id, condition) %>%
1760521781345:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760521781346:by = "gene_id"
1760521781346:)
1760521783369:# === 5. Save results ===
1760521783370:write_csv(results, "filtered_summarized_counts.csv")
1760521823069:# Load required packages
1760521823070:library(data.table)
1760521823616:# === 1. Load data ===
1760521823617:# (update filenames if needed)
1760521823618:bulk_counts <- read_csv("workspace/bulk_counts_long.csv")
1760521825605:metadata <- read_csv("workspace/sample_metadata.csv")
1760521827753:# === 2. Process data ===
1760521827754:results <- bulk_counts %>%
1760521827755:# Join metadata
1760521827755:left_join(metadata, by = "sample_id") %>%
1760521827756:# Filter for treated samples and genes starting with "GENE_00"
1760521827756:filter(condition == "treated", str_starts(gene, "GENE_00")) %>%
1760521827757:# === 3. Summarize mean and median count by gene ===
1760521827757:group_by(gene) %>%
1760521827757:summarise(
1760521827758:mean_count = mean(count, na.rm = TRUE),
1760521827758:median_count = median(count, na.rm = TRUE)
1760521827758:) %>%
1760521827759:# === 4. Join again to compute per-condition mean ===
1760521827759:left_join(
1760521827760:bulk_counts %>%
1760521827760:left_join(metadata, by = "sample_id") %>%
1760521827760:group_by(gene, condition) %>%
1760521827761:summarise(per_condition_mean = mean(count, na.rm = TRUE), .groups = "drop"),
1760521827761:by = "gene"
1760521827762:)
1760521842204:View(bulk_counts)
1760521842343:View(bulk_counts)
1760521940703:# Load necessary packages
1760521940704:# (Already installed in your Docker container if you added tidyverse)
1760521940704:library(dplyr)
1760521942136:library(readr)
1760521943339:# === 1. Load data ===
1760521943339:bulk_counts <- read_csv("bulk_counts_long.csv")
1760521959434:# Load necessary packages
1760521959436:# (Already installed in your Docker container if you added tidyverse)
1760521959436:library(dplyr)
1760521959979:library(readr)
1760521960538:# === 1. Load data ===
1760521960538:bulk_counts <- read_csv("workspace/bulk_counts_long.csv")
1760521961801:# === 2. Add derived columns ===
1760521961802:bulk_counts_qc <- bulk_counts %>%
1760521961802:# Add log2(count + 1) to avoid log(0)
1760521961803:mutate(log2_count = log2(count + 1),
1760521961803:high = count > 100) %>%
1760521961804:# === 3. Overwrite 'high' using gene-wise median threshold ===
1760521961804:group_by(gene_id) %>%
1760521961805:mutate(high = count > median(count, na.rm = TRUE)) %>%
1760521961805:ungroup()
1760521975334:# Load necessary packages
1760521975335:# (Already installed in your Docker container if you added tidyverse)
1760521975335:library(dplyr)
1760521975883:library(readr)
1760521976669:# === 1. Load data ===
1760521976669:bulk_counts <- read_csv("workspace/bulk_counts_long.csv")
1760521977653:# === 2. Add derived columns ===
1760521977654:bulk_counts_qc <- bulk_counts %>%
1760521977654:# Add log2(count + 1) to avoid log(0)
1760521977654:mutate(log2_count = log2(count + 1),
1760521977655:high = count > 100) %>%
1760521977656:# === 3. Overwrite 'high' using gene-wise median threshold ===
1760521977656:group_by(gene) %>%
1760521977657:mutate(high = count > median(count, na.rm = TRUE)) %>%
1760521977657:ungroup()
1760538954619:View(bulk_counts)
1760538955874:View(metadata)
1760538956572:View(results)
1760538984524:# Load necessary packages
1760538984525:# (Already installed in your Docker container if you added tidyverse)
1760538984525:library(dplyr)
1760538985025:library(readr)
1760538985572:# === 1. Load data ===
1760538985573:bulk_counts <- read_csv("workspace/bulk_counts_long.csv")
1760538986491:# === 2. Add derived columns ===
1760538986492:bulk_counts_qc <- bulk_counts %>%
1760538986492:# Add log2(count + 1) to avoid log(0)
1760538986492:mutate(log2_count = log2(count + 1),
1760538986492:high = count > 100) %>%
1760538986493:# === 3. Overwrite 'high' using gene-wise median threshold ===
1760538986493:group_by(gene) %>%
1760538986494:mutate(high = count > median(count, na.rm = TRUE)) %>%
1760538986494:ungroup()
1760538987286:# === 4. Save results ===
1760538987286:write_csv(bulk_counts_qc, "bulk_counts_qc.csv")
1760538994377:View(metadata)
1760538995189:View(metadata)
1760538995850:View(results)
1760542041569:# task3.R — Speed up joins/lookups
1760542041570:suppressPackageStartupMessages(library(data.table))
1760542043180:wsp <- "workspace"
1760542044517:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542045902:# Load data
1760542045903:meta  <- read_dt("sample_metadata.CSV")
1760542068735:# task3.R — Speed up joins/lookups
1760542068735:suppressPackageStartupMessages(library(data.table))
1760542069568:wsp <- "workspace"
1760542070334:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542071247:# Load data
1760542071247:meta  <- read_dt("workspace/sample_metadata.CSV")
1760542124202:# task3.R — Speed up joins/lookups
1760542124203:suppressPackageStartupMessages(library(data.table))
1760542125151:wsp <- "workspace"
1760542126000:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542126533:# Load data
1760542126534:meta  <- read_dt("wsp/sample_metadata.CSV")
1760542152019:# task3.R — Speed up joins/lookups
1760542152020:suppressPackageStartupMessages(library(data.table))
1760542152550:wsp <- "workspace"
1760542153067:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542153582:# Load data
1760542153582:meta  <- read_dt("sample_metadata.CSV")
1760542193434:# task3.R — Speed up joins/lookups
1760542193434:suppressPackageStartupMessages(library(data.table))
1760542193915:wsp <- "workspace"
1760542194560:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542195068:# Load data
1760542195069:meta  <- read_dt("workspace/sample_metadata.CSV")
1760542357016:suppressPackageStartupMessages(library(data.table))
1760542358435:# ---- Helper to find the right folder ----
1760542358435:# It checks if files are inside "workspace/" or the current folder.
1760542358436:resolve_path <- function(fname) {
1760542358436:if (file.exists(fname)) {
1760542358436:return(fname)
1760542358437:} else if (file.exists(file.path("workspace", fname))) {
1760542358437:return(file.path("workspace", fname))
1760542358437:} else {
1760542358438:stop("File not found: ", fname,
1760542358438:" — check that your CSV is in /home/rstudio/workspace/")
1760542358439:}
1760542358439:}
1760542360247:# ---- Load data ----
1760542360247:meta_file   <- resolve_path("sample_metadata.CSV")
1760542380135:# ---- Helper to find the right folder ----
1760542380135:# It checks if files are inside "workspace/" or the current folder.
1760542380136:resolve_path <- function(fname) {
1760542380136:if (file.exists(fname)) {
1760542380136:return(fname)
1760542380137:} else if (file.exists(file.path("workspace", fname))) {
1760542380137:return(file.path("workspace", fname))
1760542380137:} else {
1760542380138:stop("File not found: ", fname,
1760542380138:" — check that your CSV is in /home/rstudio/workspace/")
1760542380139:}
1760542380139:}
1760542381098:# ---- Load data ----
1760542381100:meta_file   <- resolve_path("sample_metadata.csv")
1760542382666:counts_file <- resolve_path("bulk_counts_long.csv")
1760542384217:meta   <- fread(meta_file)
1760542385400:counts <- fread(counts_file)
1760542386085:# ---- data.table approach ----
1760542386086:dt_meta   <- copy(meta)
1760542387382:dt_counts <- copy(counts)
1760542387999:# 1️⃣ setkey on sample_metadata by sample_id
1760542388000:setkey(dt_meta, sample_id)
1760542388866:# 2️⃣ Equi-join into the long counts
1760542388867:t_dt_join <- system.time({
1760542388867:dt_joined <- dt_meta[dt_counts, on = "sample_id"]
1760542388868:})
1760542389715:# 3️⃣ Add a secondary index on (gene, sample_id)
1760542389716:setindex(dt_counts, gene, sample_id)
1760542391383:# 4️⃣ Benchmark subset query before/after index
1760542391383:query_fun <- function() dt_counts[gene == "GENE_005" & sample_id == "SAMPLE_01"]
1760542392665:t_before <- system.time(no_index <- query_fun())
1760542393800:t_after  <- system.time(with_index <- query_fun())
1760542394530:# ---- data.frame approach ----
1760542394530:df_meta   <- as.data.frame(meta)
1760542395367:df_counts <- as.data.frame(counts)
1760542396100:t_df_join <- system.time({
1760542396101:df_joined <- merge(df_counts, df_meta, by = "sample_id", all.x = TRUE)
1760542396101:})
1760542396734:# ---- Print performance summary ----
1760542396735:perf <- data.table(
1760542396735:Step = c("data.table join", "data.frame join",
1760542396736:"subset before index", "subset after index"),
1760542396736:Time_sec = c(t_dt_join["elapsed"], t_df_join["elapsed"],
1760542396736:t_before["elapsed"], t_after["elapsed"])
1760542396737:)
1760542398699:print(perf)
1760542399334:# ---- Show a small result preview ----
1760542399334:print(head(dt_joined))
1760542474291:# task3_minimal.R — data.table only version
1760542474292:suppressPackageStartupMessages(library(data.table))
1760542475359:# Load data (assuming you're inside /home/rstudio/workspace)
1760542475360:meta   <- fread("sample_metadata.csv")
1760542577712:# task3_minimal.R — data.table only version
1760542577712:suppressPackageStartupMessages(library(data.table))
1760542578510:# Load data (assuming you're inside /home/rstudio/workspace)
1760542578511:meta   <- fread("/home/rstudio/workspace/sample_metadata.CSV")
1760542594140:# task3_minimal.R — data.table only version
1760542594140:suppressPackageStartupMessages(library(data.table))
1760542594592:# Load data (assuming you're inside /home/rstudio/workspace)
1760542594594:meta   <- fread("workspace/sample_metadata.CSV")
1760542602445:# task3_minimal.R — data.table only version
1760542602445:suppressPackageStartupMessages(library(data.table))
1760542603026:# Load data (assuming you're inside /home/rstudio/workspace)
1760542603027:meta   <- fread("workspace/sample_metadata.csv")
1760542603960:counts <- fread("workspace/bulk_counts_long.csv")
1760542604676:# 1. Key metadata by sample_id
1760542604676:setkey(meta, sample_id)
1760542605544:# 2. Join metadata into counts
1760542605545:joined <- meta[counts, on = "sample_id"]
1760542606429:# 3. Add secondary index on (gene, sample_id)
1760542606429:setindex(counts, gene, sample_id)
1760542607227:# 4. Benchmark subset query before and after index
1760542607229:query <- function() counts[gene == "GENE_005" & sample_id == "SAMPLE_01"]
1760542608178:system.time(query())   # before index (first run)
1760542609077:system.time(query())   # after index (second run, uses index)
1760542609792:# Preview joined data
1760542609793:head(joined)
1760542681982:# task4.R — Annotate counts with sample/patient info
1760542681984:suppressPackageStartupMessages(library(data.table))
1760542682878:wsp <- "workspace"
1760542683777:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542684594:# Load
1760542684595:meta  <- read_dt("workspace/sample_metadata.csv")
1760542704678:# task4.R — Annotate counts with sample/patient info
1760542704679:suppressPackageStartupMessages(library(data.table))
1760542705228:wsp <- "workspace"
1760542705761:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542706360:# Load
1760542706361:meta  <- read_dt("sample_metadata.csv")
1760542707344:counts <- read_dt("bulk_counts_long.csv")
1760542707895:#--- data.table version ---
1760542707896:dt_meta <- copy(meta)
1760542708480:dt_counts <- copy(counts)
1760542709178:# Join sample metadata
1760542709179:setkey(dt_meta, sample_id)
1760542709890:joined <- dt_meta[dt_counts, on = "sample_id"]
1760542710429:# Per-patient total counts
1760542710431:patient_totals <- joined[, .(total_count = sum(count)), by = patient_id]
1760542711045:# Top 10 genes by average count within each condition
1760542711047:top_genes <- joined[, .(avg_count = mean(count)), by = .(condition, gene)
1760542711047:][order(condition, -avg_count), head(.SD, 10), by = condition]
1760542711711:#--- data.frame version ---
1760542711712:df_meta <- as.data.frame(meta)
1760542714197:df_counts <- as.data.frame(counts)
1760542714712:df_joined <- merge(df_counts, df_meta, by = "sample_id", all.x = TRUE)
1760542715145:df_patient_total <- aggregate(count ~ patient_id, df_joined, sum)
1760542715594:df_top_genes <- do.call(rbind, lapply(split(df_joined, df_joined$condition), function(x) {
1760542715595:t <- aggregate(count ~ gene, x, mean)
1760542715595:head(t[order(-t$count), ], 10)
1760542715595:}))
1760542716209:#--- Output small checks ---
1760542716211:print(head(patient_totals))
1760542716761:print(head(top_genes))
1760542759942:# task3_minimal.R — data.table only version
1760542759942:suppressPackageStartupMessages(library(data.table))
1760542760394:# Load data (assuming you're inside /home/rstudio/workspace)
1760542760395:meta   <- fread("workspace/sample_metadata.csv")
1760542760794:counts <- fread("workspace/bulk_counts_long.csv")
1760542761176:# 1. Key metadata by sample_id
1760542761177:setkey(meta, sample_id)
1760542761343:# 2. Join metadata into counts
1760542761344:joined <- meta[counts, on = "sample_id"]
1760542761510:# 3. Add secondary index on (gene, sample_id)
1760542761510:setindex(counts, gene, sample_id)
1760542761658:# 4. Benchmark subset query before and after index
1760542761658:query <- function() counts[gene == "GENE_005" & sample_id == "SAMPLE_01"]
1760542761861:system.time(query())   # before index (first run)
1760542762127:system.time(query())   # after index (second run, uses index)
1760542762378:# Preview joined data
1760542762379:head(joined)
1760542769394:# task4.R — Annotate counts with sample/patient info
1760542769395:suppressPackageStartupMessages(library(data.table))
1760542769641:wsp <- "workspace"
1760542769827:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542770028:# Load
1760542770029:meta  <- read_dt("sample_metadata.csv")
1760542770244:counts <- read_dt("bulk_counts_long.csv")
1760542770445:#--- data.table version ---
1760542770446:dt_meta <- copy(meta)
1760542770672:dt_counts <- copy(counts)
1760542770878:# Join sample metadata
1760542770879:setkey(dt_meta, sample_id)
1760542771094:joined <- dt_meta[dt_counts, on = "sample_id"]
1760542771277:# Per-patient total counts
1760542771278:patient_totals <- joined[, .(total_count = sum(count)), by = patient_id]
1760542771495:# Top 10 genes by average count within each condition
1760542771495:top_genes <- joined[, .(avg_count = mean(count)), by = .(condition, gene)
1760542771496:][order(condition, -avg_count), head(.SD, 10), by = condition]
1760542771711:#--- data.frame version ---
1760542771712:df_meta <- as.data.frame(meta)
1760542771961:df_counts <- as.data.frame(counts)
1760542772294:df_joined <- merge(df_counts, df_meta, by = "sample_id", all.x = TRUE)
1760542772493:df_patient_total <- aggregate(count ~ patient_id, df_joined, sum)
1760542772677:df_top_genes <- do.call(rbind, lapply(split(df_joined, df_joined$condition), function(x) {
1760542772678:t <- aggregate(count ~ gene, x, mean)
1760542772678:head(t[order(-t$count), ], 10)
1760542772678:}))
1760542772876:#--- Output small checks ---
1760542772876:print(head(patient_totals))
1760542773078:print(head(top_genes))
1760542809830:# task5.R — Classify labs as normal/out_of_range
1760542809830:suppressPackageStartupMessages(library(data.table))
1760542810495:wsp <- "workspace"
1760542810978:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542811444:labs <- read_dt("clinical_labs.csv")
1760542811928:ranges <- read_dt("lab_reference_ranges.csv")
1760542812413:#--- data.table version ---
1760542812414:dt_labs <- copy(labs)
1760542812827:dt_ranges <- copy(ranges)
1760542813196:# Non-equi join: value between lower and upper
1760542813196:setkey(dt_ranges, lab)
1760542813478:classified <- dt_ranges[dt_labs, on = .(lab, lower <= value, upper >= value), nomatch = 0L]
1760542813761:classified[, status := ifelse(!is.na(lower), "normal", "out_of_range")]
1760542814011:# Fill missing labs as out_of_range
1760542814012:out_all <- merge(dt_labs, classified, all.x = TRUE)
1760542814245:out_all[is.na(status), status := "out_of_range"]
1760542814495:# Count abnormal rates
1760542814495:abnormal_rates_patient <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = patient_id]
1760542814712:abnormal_rates_lab <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = lab]
1760542814944:#--- data.frame version ---
1760542814945:df_labs <- as.data.frame(labs)
1760542815195:df_ranges <- as.data.frame(ranges)
1760542815427:df_joined <- merge(df_labs, df_ranges, by = "lab", all.x = TRUE)
1760542815661:df_joined$status <- ifelse(df_joined$value >= df_joined$lower & df_joined$value <= df_joined$upper, "normal", "out_of_range")
1760542815895:df_pat <- aggregate(status == "out_of_range" ~ patient_id, df_joined, mean)
1760542816127:df_lab <- aggregate(status == "out_of_range" ~ lab, df_joined, mean)
1760542816378:#--- Output check ---
1760542816378:print(head(abnormal_rates_patient))
1760542816594:print(head(abnormal_rates_lab))
1760542880353:# task6.R — Nearest-time matching of vitals to lab draws
1760542880353:suppressPackageStartupMessages(library(data.table))
1760542880846:wsp <- "workspace"
1760542881196:read_dt <- function(fname) fread(file.path(wsp, fname))
1760542881594:labs <- read_dt("clinical_labs.csv")
1760542882025:vitals <- read_dt("vitals_time_series.csv")
1760542882394:# Convert timestamps
1760542882394:labs[, time := as.POSIXct(time)]
1760542882730:vitals[, time := as.POSIXct(time)]
1760542996610:suppressPackageStartupMessages(library(data.table))
1760542997530:# ---- Helper to read with auto path detection ----
1760542997530:resolve_path <- function(fname) {
1760542997530:if (file.exists(fname)) fname else file.path("workspace", fname)
1760542997531:}
1760542998146:# ---- Load data ----
1760542998147:labs   <- fread(resolve_path("clinical_labs.csv"))
1760542998614:vitals <- fread(resolve_path("vitals_time_series.csv"))
1760542999031:fix_time <- function(x) {
1760542999031:if (inherits(x, "POSIXct")) return(x)
1760542999032:if (is.numeric(x)) {
1760542999032:# interpret numeric as UNIX seconds
1760542999032:return(as.POSIXct(x, origin = "1970-01-01", tz = "UTC"))
1760542999033:}
1760542999033:# force to character first
1760542999034:x <- as.character(x)
1760542999034:# Try common formats automatically
1760542999034:try_formats <- c(
1760542999035:"%Y-%m-%d %H:%M:%S",
1760542999035:"%Y/%m/%d %H:%M:%S",
1760542999036:"%d/%m/%Y %H:%M",
1760542999036:"%Y-%m-%dT%H:%M:%S",
1760542999036:"%Y-%m-%d"
1760542999037:)
1760542999037:as.POSIXct(x, format = try_formats[which(!is.na(as.POSIXct(x, format = try_formats, tz = "UTC")))[1]], tz = "UTC")
1760542999037:}
1760542999396:labs[,  time := fix_time(time)]
1760543028511:labs[,  (time) := fix_time(time)]
1760543036478:suppressPackageStartupMessages(library(data.table))
1760543036779:# ---- Helper to read with auto path detection ----
1760543036779:resolve_path <- function(fname) {
1760543036780:if (file.exists(fname)) fname else file.path("workspace", fname)
1760543036780:}
1760543036943:# ---- Load data ----
1760543036944:labs   <- fread(resolve_path("clinical_labs.csv"))
1760543037178:vitals <- fread(resolve_path("vitals_time_series.csv"))
1760543037544:fix_time <- function(x) {
1760543037545:if (inherits(x, "POSIXct")) return(x)
1760543037545:if (is.numeric(x)) {
1760543037546:# interpret numeric as UNIX seconds
1760543037546:return(as.POSIXct(x, origin = "1970-01-01", tz = "UTC"))
1760543037546:}
1760543037547:# force to character first
1760543037547:x <- as.character(x)
1760543037547:# Try common formats automatically
1760543037548:try_formats <- c(
1760543037548:"%Y-%m-%d %H:%M:%S",
1760543037548:"%Y/%m/%d %H:%M:%S",
1760543037549:"%d/%m/%Y %H:%M",
1760543037549:"%Y-%m-%dT%H:%M:%S",
1760543037549:"%Y-%m-%d"
1760543037550:)
1760543037550:as.POSIXct(x, format = try_formats[which(!is.na(as.POSIXct(x, format = try_formats, tz = "UTC")))[1]], tz = "UTC")
1760543037553:}
1760543037828:labs[,  (time) := fix_time(time)]
1760543063678:suppressPackageStartupMessages(library(data.table))
1760543064061:# ---- Helper to read with auto path detection ----
1760543064062:resolve_path <- function(fname) {
1760543064063:if (file.exists(fname)) fname else file.path("workspace", fname)
1760543064063:}
1760543064296:# ---- Load data ----
1760543064296:labs   <- fread(resolve_path("clinical_labs.csv"))
1760543064462:vitals <- fread(resolve_path("vitals_time_series.csv"))
1760543064857:fix_time <- function(x) {
1760543064858:if (inherits(x, "POSIXct")) return(x)
1760543064858:if (is.numeric(x)) {
1760543064859:# interpret numeric as UNIX seconds
1760543064859:return(as.POSIXct(x, origin = "1970-01-01", tz = "UTC"))
1760543064859:}
1760543064860:# force to character first
1760543064860:x <- as.character(x)
1760543064860:# Try common formats automatically
1760543064861:try_formats <- c(
1760543064861:"%Y-%m-%d %H:%M:%S",
1760543064861:"%Y/%m/%d %H:%M:%S",
1760543064862:"%d/%m/%Y %H:%M",
1760543064862:"%Y-%m-%dT%H:%M:%S",
1760543064862:"%Y-%m-%d"
1760543064863:)
1760543064863:as.POSIXct(x, format = try_formats[which(!is.na(as.POSIXct(x, format = try_formats, tz = "UTC")))[1]], tz = "UTC")
1760543064863:}
1760543065491:labs[,  time := fix_time(time)]
1760543241482:suppressPackageStartupMessages(library(data.table))
1760543242010:# ---- Path helper (works if you run from /home/rstudio or /home/rstudio/workspace) ----
1760543242010:resolve_path <- function(fname) {
1760543242011:if (file.exists(fname)) fname else file.path("workspace", fname)
1760543242011:}
1760543242612:# ---- Load data ----
1760543242612:labs   <- fread(resolve_path("clinical_labs.csv"))
1760543243545:vitals <- fread(resolve_path("vitals_time_series.csv"))
1760543244114:# ---- Auto-detect and normalize the time column to 'time' ----
1760543244115:detect_time_col <- function(dt) {
1760543244115:candidates <- c("time","timestamp","datetime","draw_time","collection_time",
1760543244115:"date_time","sample_time","event_time","measure_time")
1760543244116:hit <- candidates[candidates %in% names(dt)]
1760543244116:if (length(hit) > 0) return(hit[1])
1760543244117:# fallback: any column name containing 'time' or 'date'
1760543244117:pat <- grep("(time|date)", names(dt), ignore.case = TRUE, value = TRUE)
1760543244117:if (length(pat) > 0) return(pat[1])
1760543244117:stop("No time-like column found. Available columns: ", paste(names(dt), collapse = ", "))
1760543244118:}
1760543245597:labs_time_col   <- detect_time_col(labs)
1760543246146:vitals_time_col <- detect_time_col(vitals)
1760543246766:if (labs_time_col   != "time")   setnames(labs,   labs_time_col,   "time")
1760543247246:if (vitals_time_col != "time")   setnames(vitals, vitals_time_col, "time")
1760543248630:# ---- Safe time parsing ----
1760543250346:if (inherits(x, "POSIXct")) return(x)
1760543251245:if (is.factor(x)) x <- as.character(x)
1760543251812:# Numeric epoch: detect ms vs s
1760543252329:xn <- as.numeric(x)
1760543256863:if (all(is.na(xn))) return(as.POSIXct(rep(NA_real_, length(x)), origin="1970-01-01", tz="UTC"))
1760543257262:maxv <- suppressWarnings(max(xn, na.rm = TRUE))
1760543257628:if (is.finite(maxv) && maxv >
1760624248566:suppressPackageStartupMessages(library(data.table))
1760624249259:# ---- Path helper (works if you run from /home/rstudio or /home/rstudio/workspace) ----
1760624249260:resolve_path <- function(fname) {
1760624287442:suppressPackageStartupMessages(library(data.table))
1760624288177:# ---- Path helper (works if you run from /home/rstudio or /home/rstudio/workspace) ----
1760624288178:resolve_path <- function(fname) {
1760624288178:if (file.exists(fname)) fname else file.path("workspace", fname)
1760624288178:}
1760624288823:# ---- Load data ----
1760624288824:labs   <- fread(resolve_path("workspace/clinical_labs.csv"))
1760624289556:vitals <- fread(resolve_path("workspace/vitals_time_series.csv"))
1760624290343:# ---- Auto-detect and normalize the time column to 'time' ----
1760624290343:detect_time_col <- function(dt) {
1760624290344:candidates <- c("time","timestamp","datetime","draw_time","collection_time",
1760624290344:"date_time","sample_time","event_time","measure_time")
1760624290345:hit <- candidates[candidates %in% names(dt)]
1760624290345:if (length(hit) > 0) return(hit[1])
1760624290346:# fallback: any column name containing 'time' or 'date'
1760624290346:pat <- grep("(time|date)", names(dt), ignore.case = TRUE, value = TRUE)
1760624290346:if (length(pat) > 0) return(pat[1])
1760624290347:stop("No time-like column found. Available columns: ", paste(names(dt), collapse = ", "))
1760624290347:}
1760624291727:labs_time_col   <- detect_time_col(labs)
1760624292260:vitals_time_col <- detect_time_col(vitals)
1760624292777:if (labs_time_col   != "time")   setnames(labs,   labs_time_col,   "time")
1760624293961:if (vitals_time_col != "time")   setnames(vitals, vitals_time_col, "time")
1760624294621:# ---- Safe time parsing ----
1760624295493:if (inherits(x, "POSIXct")) return(x)
1760624295959:if (is.factor(x)) x <- as.character(x)
1760624296343:# Numeric epoch: detect ms vs s
1760624296809:xn <- as.numeric(x)
1760624297059:if (all(is.na(xn))) return(as.POSIXct(rep(NA_real_, length(x)), origin="1970-01-01", tz="UTC"))
1760624297275:maxv <- suppressWarnings(max(xn, na.rm = TRUE))
1760624297677:if (is.finite(maxv) && maxv >
1760624522527:suppressPackageStartupMessages(library(data.table))
1760624523575:# ---- Load data ----
1760624523575:labs   <- fread("clinical_labs.csv")
1760624556390:suppressPackageStartupMessages(library(data.table))
1760624556878:# ---- Load data ----
1760624556878:labs   <- fread("clinical_labs.csv")
1760624557538:vitals <- fread("vitals_time_series.csv")
1760624582276:suppressPackageStartupMessages(library(data.table))
1760624582796:# ---- Load data ----
1760624582796:labs   <- fread("workspace/clinical_labs.csv")
1760624583175:vitals <- fread("workspace/vitals_time_series.csv")
1760624583675:# ---- Convert time columns ----
1760624583675:# Adjust the format if your timestamps differ
1760624583676:labs[,   time := as.POSIXct(time,   format = "%Y-%m-%d %H:%M:%S", tz = "UTC")]
1760624684327:suppressPackageStartupMessages(library(data.table))
1760624698094:# ---- Load data ----
1760624698094:labs   <- fread("workspace/clinical_labs.csv")
1760624698843:vitals <- fread("workspace/vitals_time_series.csv")
1760624699507:# ---- Normalize column names ----
1760624699508:setnames(labs,   tolower(trimws(names(labs))))
1760624700394:setnames(vitals, tolower(trimws(names(vitals))))
1760624701209:# ---- Find time-like column names ----
1760624701212:find_time <- function(dt) {
1760624701213:possible <- c("time","timestamp","datetime","date_time",
1760624701213:"collection_time","draw_time","recorded_time")
1760624701214:hit <- intersect(possible, names(dt))
1760624701214:if (length(hit) == 0) stop("❌ No time column found. Columns: ", paste(names(dt), collapse=", "))
1760624701214:return(hit[1])
1760624701215:}
1760624702594:lab_time_col    <- find_time(labs)
1760624703155:vitals_time_col <- find_time(vitals)
1760624792995:# ---- Convert to POSIXct ----
1760624792996:labs[[lab_time_col]]   <- as.POSIXct(labs[[lab_time_col]],   tz = "UTC", tryFormats = c(
1760624792997:"%Y-%m-%d %H:%M:%S", "%Y/%m/%d %H:%M:%S", "%d/%m/%Y %H:%M:%S",
1760624792997:"%d/%m/%Y %H:%M", "%Y-%m-%dT%H:%M:%S", "%Y-%m-%d"
1760624792997:))
1760624798145:vitals[[vitals_time_col]] <- as.POSIXct(vitals[[vitals_time_col]], tz = "UTC", tryFormats = c(
1760624798148:"%Y-%m-%d %H:%M:%S", "%Y/%m/%d %H:%M:%S", "%d/%m/%Y %H:%M:%S",
1760624798149:"%d/%m/%Y %H:%M", "%Y-%m-%dT%H:%M:%S", "%Y-%m-%d"
1760624798150:))
1760624798908:# Rename detected columns to 'time' for simplicity
1760624798908:setnames(labs,   lab_time_col,    "time")
1760624799393:setnames(vitals, vitals_time_col, "time")
1760624988394:suppressPackageStartupMessages(library(data.table))
1760624988970:# ---- Load data ----
1760624988971:labs   <- fread("clinical_labs.csv")
1760625003261:suppressPackageStartupMessages(library(data.table))
1760625003792:# ---- Load data ----
1760625003794:labs   <- fread("workspace/clinical_labs.csv")
1760625004259:vitals <- fread("workspace/vitals_time_series.csv")
1760625005125:# ---- Standardize column names ----
1760625005125:setnames(labs,   tolower(trimws(names(labs))))
1760625005826:setnames(vitals, tolower(trimws(names(vitals))))
1760625006423:# Rename 'time_iso' to 'time'
1760625006424:setnames(labs,   "time_iso", "time")
1760625007208:setnames(vitals, "time_iso", "time")
1760625007858:# ---- Convert to POSIXct ----
1760625007859:labs[,   time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625007860:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625007860:))]
1760625008658:vitals[, time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625008658:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625008659:))]
1760625009292:# ---- Keep only HR and SBP ----
1760625009293:vitals_sub <- vitals[vital %in% c("HR", "SBP")]
1760625009862:# Split into HR and SBP tables
1760625009863:hr  <- vitals_sub[vital == "HR",  .(patient_id, time, HR  = value)]
1760625010411:sbp <- vitals_sub[vital == "SBP", .(patient_id, time, SBP = value)]
1760625010811:# ---- Rolling joins ----
1760625010812:setkey(hr,  patient_id, time)
1760625011274:setkey(sbp, patient_id, time)
1760625011743:setkey(labs, patient_id, time)
1760625012260:# Find nearest HR and SBP for each lab draw
1760625012261:labs_hr  <- hr[labs,  roll = "nearest"]
1760625012776:labs_sbp <- sbp[labs, roll = "nearest"]
1760625013393:# Merge HR and SBP results
1760625013393:merged <- merge(
1760625013394:labs_hr[, .(patient_id, time, lab, value, HR,  time_HR  = i.time)],
1760625013394:labs_sbp[, .(patient_id, time,        SBP, time_SBP = i.time)],
1760625013395:by = c("patient_id", "time"),
1760625013395:all.x = TRUE
1760625013396:)
1760625014023:# ---- Compute lag (minutes) ----
1760625014024:merged[, lag_HR  := abs(as.numeric(difftime(time, time_HR,  units = "mins")))]
1760625014577:merged[, lag_SBP := abs(as.numeric(difftime(time, time_SBP, units = "mins")))]
1760625015060:# ---- Correlation between CRP and vitals per patient ----
1760625015060:corr_summary <- merged[lab == "CRP",
1760625015061:.(
1760625015061:cor_HR  = cor(value, HR,  use = "pairwise.complete.obs"),
1760625015062:cor_SBP = cor(value, SBP, use = "pairwise.complete.obs")
1760625015062:),
1760625015062:by = patient_id]
1760625015593:# ---- Output preview ----
1760625015594:print(head(merged))
1760625096825:suppressPackageStartupMessages(library(data.table))
1760625097210:# ---- Load data ----
1760625097210:labs   <- fread("workspace/clinical_labs.csv")
1760625097461:vitals <- fread("workspace/vitals_time_series.csv")
1760625097671:# ---- Standardize column names ----
1760625097672:setnames(labs,   tolower(trimws(names(labs))))
1760625098057:setnames(vitals, tolower(trimws(names(vitals))))
1760625098277:# Rename 'time_iso' to 'time'
1760625098277:setnames(labs,   "time_iso", "time")
1760625098494:setnames(vitals, "time_iso", "time")
1760625098743:# ---- Convert to POSIXct ----
1760625098743:labs[,   time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625098744:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625098744:))]
1760625099110:vitals[, time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625099111:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625099111:))]
1760625099476:# ---- Keep only HR and SBP ----
1760625099477:vitals_sub <- vitals[vital %in% c("HR", "SBP")]
1760625099960:# Split into HR and SBP tables
1760625099960:hr  <- vitals_sub[vital == "HR",  .(patient_id, time, HR  = value)]
1760625100360:sbp <- vitals_sub[vital == "SBP", .(patient_id, time, SBP = value)]
1760625100793:# ---- Rolling joins ----
1760625100794:setkey(hr,  patient_id, time)
1760625101210:setkey(sbp, patient_id, time)
1760625101641:setkey(labs, patient_id, time)
1760625102076:# Find nearest HR and SBP for each lab draw
1760625102076:labs_hr  <- hr[labs,  roll = "nearest"]
1760625102602:labs_sbp <- sbp[labs, roll = "nearest"]
1760625103077:# Merge HR and SBP results
1760625103078:merged <- merge(
1760625103078:labs_hr[, .(patient_id, time, lab, value, HR,  time_HR  = time)],
1760625103078:labs_sbp[, .(patient_id, time,        SBP, time_SBP = time)],
1760625103079:by = c("patient_id", "time"),
1760625103079:all.x = TRUE
1760625103080:)
1760625103443:# ---- Compute lag (minutes) ----
1760625103443:merged[, lag_HR  := abs(as.numeric(difftime(time, time_HR,  units = "mins")))]
1760625103942:merged[, lag_SBP := abs(as.numeric(difftime(time, time_SBP, units = "mins")))]
1760625104343:# ---- Correlation between CRP and vitals per patient ----
1760625104344:corr_summary <- merged[lab == "CRP",
1760625104344:.(
1760625104345:cor_HR  = cor(value, HR,  use = "pairwise.complete.obs"),
1760625104345:cor_SBP = cor(value, SBP, use = "pairwise.complete.obs")
1760625104346:),
1760625104346:by = patient_id]
1760625104793:# ---- Output preview ----
1760625104793:print(head(merged))
1760625132305:# task5.R — Classify labs as normal/out_of_range
1760625132307:suppressPackageStartupMessages(library(data.table))
1760625132742:wsp <- "workspace"
1760625132920:read_dt <- function(fname) fread(file.path(wsp, fname))
1760625133138:labs <- read_dt("clinical_labs.csv")
1760625133627:ranges <- read_dt("lab_reference_ranges.csv")
1760625133826:#--- data.table version ---
1760625133826:dt_labs <- copy(labs)
1760625134027:dt_ranges <- copy(ranges)
1760625134241:# Non-equi join: value between lower and upper
1760625134241:setkey(dt_ranges, lab)
1760625134527:classified <- dt_ranges[dt_labs, on = .(lab, lower <= value, upper >= value), nomatch = 0L]
1760625134756:classified[, status := ifelse(!is.na(lower), "normal", "out_of_range")]
1760625134954:# Fill missing labs as out_of_range
1760625134954:out_all <- merge(dt_labs, classified, all.x = TRUE)
1760625135175:out_all[is.na(status), status := "out_of_range"]
1760625135392:# Count abnormal rates
1760625135393:abnormal_rates_patient <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = patient_id]
1760625135588:abnormal_rates_lab <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = lab]
1760625135788:#--- data.frame version ---
1760625135788:df_labs <- as.data.frame(labs)
1760625136042:df_ranges <- as.data.frame(ranges)
1760625136291:df_joined <- merge(df_labs, df_ranges, by = "lab", all.x = TRUE)
1760625136491:df_joined$status <- ifelse(df_joined$value >= df_joined$lower & df_joined$value <= df_joined$upper, "normal", "out_of_range")
1760625136705:df_pat <- aggregate(status == "out_of_range" ~ patient_id, df_joined, mean)
1760625136922:df_lab <- aggregate(status == "out_of_range" ~ lab, df_joined, mean)
1760625137157:#--- Output check ---
1760625137158:print(head(abnormal_rates_patient))
1760625137376:print(head(abnormal_rates_lab))
1760625304444:suppressPackageStartupMessages(library(data.table))
1760625304745:# ---- Load data ----
1760625304746:labs   <- fread("workspace/clinical_labs.csv")
1760625304977:vitals <- fread("workspace/vitals_time_series.csv")
1760625305157:# ---- Standardize column names ----
1760625305158:setnames(labs,   tolower(trimws(names(labs))))
1760625305358:setnames(vitals, tolower(trimws(names(vitals))))
1760625305579:# Rename 'time_iso' to 'time'
1760625305579:setnames(labs,   "time_iso", "time")
1760625305792:setnames(vitals, "time_iso", "time")
1760625306025:# ---- Convert to POSIXct ----
1760625306025:labs[,   time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625306026:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625306026:))]
1760625306308:vitals[, time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625306309:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625306309:))]
1760625306694:# ---- Keep only HR and SBP ----
1760625306694:vitals_sub <- vitals[vital %in% c("HR", "SBP")]
1760625307025:# Split into HR and SBP tables
1760625307026:hr  <- vitals_sub[vital == "HR",  .(patient_id, time, HR  = value)]
1760625307293:sbp <- vitals_sub[vital == "SBP", .(patient_id, time, SBP = value)]
1760625307876:# ---- Rolling joins ----
1760625307876:setkey(hr,  patient_id, time)
1760625308376:setkey(sbp, patient_id, time)
1760625308942:setkey(labs, patient_id, time)
1760625309476:# Find nearest HR and SBP for each lab draw
1760625309479:labs_hr  <- hr[labs,  roll = "nearest"]
1760625310009:labs_sbp <- sbp[labs, roll = "nearest"]
1760625310409:# Merge HR and SBP results
1760625310410:merged <- merge(
1760625310410:labs_hr[, .(patient_id, time, lab, value, HR,  time_HR  = time)],
1760625310411:labs_sbp[, .(patient_id, time,        SBP, time_SBP = time)],
1760625310411:by = c("patient_id", "time"),
1760625310412:all.x = TRUE
1760625310412:)
1760625310776:# ---- Compute lag (minutes) ----
1760625310777:merged[, lag_HR  := abs(as.numeric(difftime(time, time_HR,  units = "mins")))]
1760625311259:merged[, lag_SBP := abs(as.numeric(difftime(time, time_SBP, units = "mins")))]
1760625311659:# ---- Correlation between CRP and vitals per patient ----
1760625311659:corr_summary <- merged[lab == "CRP",
1760625311660:.(
1760625311660:cor_HR  = cor(value, HR,  use = "pairwise.complete.obs"),
1760625311660:cor_SBP = cor(value, SBP, use = "pairwise.complete.obs")
1760625311661:),
1760625311661:by = patient_id]
1760625348476:suppressPackageStartupMessages(library(data.table))
1760625349209:# ---- Load data ----
1760625349210:peaks <- fread("workspace/atac_peaks.bed.csv")
1760625349944:# ---- Standardize column names ----
1760625349944:setnames(peaks, tolower(trimws(names(peaks))))
1760625350611:# ---- Filter: peaks on chr2 with start between 2–4 Mb ----
1760625350611:filtered <- peaks[chr == "chr2" & start >= 2e6 & start <= 4e6]
1760625351308:# ---- Order by descending score and select top 50 ----
1760625351309:setorder(filtered, -score)
1760625351893:top50 <- filtered[1:50]
1760625352422:# ---- Output preview ----
1760625352423:print(head(top50))
1760625353293:print(paste("✅ Selected", nrow(top50), "peaks on chr2 between 2–4 Mb (top 50 by score)."))
1760625390087:suppressPackageStartupMessages(library(data.table))
1760625390255:# ---- Load data ----
1760625390255:labs   <- fread("workspace/clinical_labs.csv")
1760625390405:vitals <- fread("workspace/vitals_time_series.csv")
1760625390554:# ---- Standardize column names ----
1760625390554:setnames(labs,   tolower(trimws(names(labs))))
1760625390707:setnames(vitals, tolower(trimws(names(vitals))))
1760625391942:# Rename 'time_iso' to 'time'
1760625391943:setnames(labs,   "time_iso", "time")
1760625392258:setnames(vitals, "time_iso", "time")
1760625392441:# ---- Convert to POSIXct ----
1760625392441:labs[,   time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625392442:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625392442:))]
1760625392805:vitals[, time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625392806:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625392807:))]
1760625393058:# ---- Keep only HR and SBP ----
1760625393059:vitals_sub <- vitals[vital %in% c("HR", "SBP")]
1760625393440:# Split into HR and SBP tables
1760625393440:hr  <- vitals_sub[vital == "HR",  .(patient_id, time, HR  = value)]
1760625393825:sbp <- vitals_sub[vital == "SBP", .(patient_id, time, SBP = value)]
1760625394128:# ---- Rolling joins ----
1760625394129:setkey(hr,  patient_id, time)
1760625394458:setkey(sbp, patient_id, time)
1760625395047:setkey(labs, patient_id, time)
1760625395410:# Find nearest HR and SBP for each lab draw
1760625395412:labs_hr  <- hr[labs,  roll = "nearest"]
1760625395591:labs_sbp <- sbp[labs, roll = "nearest"]
1760625395859:# Merge HR and SBP results
1760625395860:merged <- merge(
1760625395860:labs_hr[, .(patient_id, time, lab, value, HR,  time_HR  = time)],
1760625395861:labs_sbp[, .(patient_id, time,        SBP, time_SBP = time)],
1760625395861:by = c("patient_id", "time"),
1760625395861:all.x = TRUE
1760625395862:)
1760625396110:# ---- Compute lag (minutes) ----
1760625396111:merged[, lag_HR  := abs(as.numeric(difftime(time, time_HR,  units = "mins")))]
1760625396324:merged[, lag_SBP := abs(as.numeric(difftime(time, time_SBP, units = "mins")))]
1760625396593:# ---- Correlation between CRP and vitals per patient ----
1760625396594:corr_summary <- merged[lab == "CRP",
1760625396594:.(
1760625396595:cor_HR  = cor(value, HR,  use = "pairwise.complete.obs"),
1760625396595:cor_SBP = cor(value, SBP, use = "pairwise.complete.obs")
1760625396596:),
1760625396596:by = patient_id]
1760625410711:View(vitals_sub)
1760625556072:############################################################
1760625556073:# task6.R — Nearest-time matching of vitals to lab draws
1760625556073:# Final minimal version (handles time_iso correctly)
1760625556074:############################################################
1760625556074:suppressPackageStartupMessages(library(data.table))
1760625556076:# ---- Load data ----
1760625556076:labs   <- fread("workspace/clinical_labs.csv")
1760625556079:vitals <- fread("workspace/vitals_time_series.csv")
1760625556081:# ---- Standardize column names ----
1760625556081:setnames(labs,   tolower(trimws(names(labs))))
1760625556082:setnames(vitals, tolower(trimws(names(vitals))))
1760625556082:# Rename 'time_iso' to 'time'
1760625556083:setnames(labs,   "time_iso", "time")
1760625556084:setnames(vitals, "time_iso", "time")
1760625556085:# ---- Convert to POSIXct ----
1760625556085:labs[,   time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625556086:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625556086:))]
1760625556088:vitals[, time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760625556088:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760625556089:))]
1760625556090:# ---- Keep only HR and SBP ----
1760625556090:vitals_sub <- vitals[vital %in% c("HR", "SBP")]
1760625556093:# Split into HR and SBP tables
1760625556094:hr  <- vitals_sub[vital == "HR",  .(patient_id, time, HR  = value)]
1760625556096:sbp <- vitals_sub[vital == "SBP", .(patient_id, time, SBP = value)]
1760625556098:# ---- Rolling joins ----
1760625556098:setkey(hr,  patient_id, time)
1760625556099:setkey(sbp, patient_id, time)
1760625556099:setkey(labs, patient_id, time)
1760625556100:# Find nearest HR and SBP for each lab draw
1760625556100:labs_hr  <- hr[labs,  roll = "nearest"]
1760625556101:labs_sbp <- sbp[labs, roll = "nearest"]
1760625556102:# Merge HR and SBP results
1760625556102:merged <- merge(
1760625556103:labs_hr[, .(patient_id, time, lab, value, HR,  time_HR  = time)],
1760625556103:labs_sbp[, .(patient_id, time,        SBP, time_SBP = time)],
1760625556103:by = c("patient_id", "time"),
1760625556103:all.x = TRUE
1760625556104:)
1760625556107:# ---- Compute lag (minutes) ----
1760625556107:merged[, lag_HR  := abs(as.numeric(difftime(time, time_HR,  units = "mins")))]
1760625556108:merged[, lag_SBP := abs(as.numeric(difftime(time, time_SBP, units = "mins")))]
1760625556108:# ---- Correlation between CRP and vitals per patient ----
1760625556109:corr_summary <- merged[lab == "CRP",
1760625556109:.(
1760625556109:cor_HR  = cor(value, HR,  use = "pairwise.complete.obs"),
1760625556109:cor_SBP = cor(value, SBP, use = "pairwise.complete.obs")
1760625556110:),
1760625556110:by = patient_id]
1760625650725:suppressPackageStartupMessages(library(data.table))
1760625651209:# ---- Load data ----
1760625651210:counts <- fread("workspace/bulk_counts_long.csv")
1760625652275:meta   <- fread("workspace/sample_metadata.CSV")
1760625652543:# ---- Standardize column names ----
1760625652544:setnames(counts, tolower(trimws(names(counts))))
1760625652789:setnames(meta,   tolower(trimws(names(meta))))
1760625671644:suppressPackageStartupMessages(library(data.table))
1760625671926:# ---- Load data ----
1760625671927:counts <- fread("workspace/bulk_counts_long.csv")
1760625672125:meta   <- fread("workspace/sample_metadata.csv")
1760625672443:# ---- Standardize column names ----
1760625672444:setnames(counts, tolower(trimws(names(counts))))
1760625672675:setnames(meta,   tolower(trimws(names(meta))))
1760625672871:# ---- Join metadata to counts ----
1760625672871:setkey(meta, sample_id)
1760625673109:dt <- meta[counts, on = "sample_id"]
1760625673725:# ---- Compute summary stats by gene and condition ----
1760625673726:# Q1 = 25th percentile, Q3 = 75th percentile
1760625673726:summ_stats <- dt[, .(
1760625673727:mean   = mean(count),
1760625673727:median = median(count),
1760625673727:q1     = quantile(count, 0.25),
1760625673728:q3     = quantile(count, 0.75)
1760625673728:), by = .(gene, condition)]
1760625674108:# ---- Reshape: wide form for treated/control comparison ----
1760625674109:wide <- dcast(summ_stats, gene ~ condition, value.var = "mean")
1760625674543:# ---- Filter: treated mean ≥ 2× control mean ----
1760625674545:# (use na.rm to handle genes missing in one condition)
1760625674545:filtered_genes <- wide[treated >= 2 * control, gene]
1760625674993:# ---- Final results (stats only for selected genes) ----
1760625674994:result <- summ_stats[gene %in% filtered_genes]
1760625675475:# ---- Output preview ----
1760625675476:print(head(result))
1760625755210:suppressPackageStartupMessages(library(data.table))
1760625755742:# ---- Load data ----
1760625755743:wide <- fread("workspace/bulk_counts_wide.csv")
1760625756211:# ---- Standardize column names ----
1760625756212:setnames(wide, tolower(trimws(names(wide))))
1760625756742:# ---- Convert wide → long ----
1760625756743:long <- melt(
1760625756743:wide,
1760625756744:id.vars = "gene",
1760625756744:variable.name = "sample_id",
1760625756745:value.name = "count"
1760625756745:)
1760625757277:# ---- Add per-sample totals ----
1760625757281:sample_totals <- long[, .(total_count = sum(count)), by = sample_id]
1760625757776:long <- merge(long, sample_totals, by = "sample_id")
1760625758261:# ---- Derive condition from sample name (if encoded) ----
1760625758262:# e.g., "treated_01", "control_03" → "treated", "control"
1760625758262:# Modify this regex if your sample names differ
1760625758263:long[, condition := fifelse(grepl("treated", sample_id, ignore.case = TRUE),
1760625758263:"treated", "control")]
1760625758561:# ---- Compute mean counts by gene × condition ----
1760625758562:summary_wide <- long[, .(mean_count = mean(count)), by = .(gene, condition)]
1760625759145:# ---- Convert back to wide format for plotting ----
1760625759146:final <- dcast(summary_wide, gene ~ condition, value.var = "mean_count")
1760625759678:# ---- Output preview ----
1760625759679:print(head(final))
1760625860828:suppressPackageStartupMessages(library(data.table))
1760625861209:# ---- Load data ----
1760625861210:peaks <- fread("atac_peaks.bed.csv")
1760625861509:genes <- fread("gene_annotation.bed.csv")
1760625884193:suppressPackageStartupMessages(library(data.table))
1760625884558:# ---- Load data ----
1760625884558:peaks <- fread("workspace/atac_peaks.bed.csv")
1760625884754:genes <- fread("workspace/gene_annotation.bed.csv")
1760625884975:# ---- Standardize column names ----
1760625884976:setnames(peaks, tolower(trimws(names(peaks))))
1760625885208:setnames(genes, tolower(trimws(names(genes))))
1760625885476:# ---- Key by chromosome and coordinates ----
1760625885477:setkey(peaks, chr, start, end)
1760625885743:setkey(genes, chr, start, end)
1760625886127:# ---- Non-equi join to find overlaps ----
1760625886127:# Condition: peak.start <= gene.end  AND  peak.end >= gene.start
1760625886128:overlaps <- foverlaps(
1760625886128:peaks,
1760625886128:genes,
1760625886129:by.x = c("chr", "start", "end"),
1760625886129:by.y = c("chr", "start", "end"),
1760625886129:type = "any",
1760625886130:nomatch = 0L
1760625886130:)
1760625887292:# ---- Compute overlap length in bp ----
1760625887293:# overlap = min(peak.end, gene.end) - max(peak.start, gene.start)
1760625887294:overlaps[, overlap_bp :=
1760625887294:pmax(0, pmin(end, i.end) - pmax(start, i.start))
1760625887294:]
1760625887575:# ---- Count peaks per gene ----
1760625887576:peaks_per_gene <- overlaps[, .(n_peaks = uniqueN(.I)), by = gene]
1760625888255:# ---- Sum overlap length per gene ----
1760625888255:bp_per_gene <- overlaps[, .(total_overlap_bp = sum(overlap_bp)), by = gene]
1760625888737:# ---- Combine and rank ----
1760625888738:summary <- merge(peaks_per_gene, bp_per_gene, by = "gene")
1760625889345:setorder(summary, -total_overlap_bp)
1760625890089:# ---- Select top 20 genes ----
1760625890089:top20 <- summary[1:20]
1760625890678:# ---- Output preview ----
1760625890679:print(top20)
1760625891109:cat("\n✅ Top 20 genes by total overlapped base-pairs shown above.\n")
1760625965993:suppressPackageStartupMessages(library(data.table))
1760625966476:# ---- Load data ----
1760625966480:variants <- fread("workspace/variants.csv")
1760625966909:genes    <- fread("workspace/gene_annotation.bed.csv")
1760625967356:# ---- Standardize column names ----
1760625967357:setnames(variants, tolower(trimws(names(variants))))
1760625968093:setnames(genes,    tolower(trimws(names(genes))))
1760625968559:# ---- Convert variant positions to 1-bp intervals ----
1760625968561:variants[, start := pos]
1760625969242:variants[, end   := pos]
1760625969692:# ---- Set keys for overlap join ----
1760625969693:setkey(variants, chr, start, end)
1760625970007:setkey(genes,    chr, start, end)
1760625970359:# ---- Find overlaps (which gene each variant falls in) ----
1760625970360:overlaps <- foverlaps(
1760625970360:variants,
1760625970360:genes,
1760625970360:by.x = c("chr", "start", "end"),
1760625970361:by.y = c("chr", "start", "end"),
1760625970361:type = "any",
1760625970361:nomatch = 0L
1760625970362:)
1760625970728:# ---- Filter for HIGH-impact variants ----
1760625970728:high_imp <- overlaps[tolower(impact) == "high"]
1760625971243:# ---- Count HIGH variants by gene and sample ----
1760625971244:counts_gene_sample <- high_imp[, .N, by = .(gene, sample_id)]
1760625971659:setnames(counts_gene_sample, "N", "high_variant_count")
1760625972059:# ---- Summarize genes with HIGH-impact variants in all samples ----
1760625972059:samples_with_high <- unique(high_imp[, .(gene, sample_id)])
1760625972378:gene_sample_counts <- samples_with_high[, .N, by = gene]
1760625972591:total_samples <- uniqueN(variants$sample_id)
1760625972895:genes_all_samples <- gene_sample_counts[N == total_samples, gene]
1760625973327:# ---- Output ----
1760625973328:cat("✅ Count of HIGH-impact variants by gene and sample:\n")
1760625973827:print(head(counts_gene_sample))
1760625974275:cat("\n✅ Genes with HIGH-impact variants in all samples:\n")
1760625974891:print(genes_all_samples)
1760626078024:suppressPackageStartupMessages(library(data.table))
1760626078442:# ---- Load data ----
1760626078443:A <- fread("workspace/cohortA_samples.csv")
1760626078843:B <- fread("workspace/cohortB_samples.csv")
1760626079240:counts <- fread("workspace/bulk_counts_long.csv")
1760626079526:# ---- Standardize column names ----
1760626079527:setnames(A, tolower(trimws(names(A))))
1760626079757:setnames(B, tolower(trimws(names(B))))
1760626080210:setnames(counts, tolower(trimws(names(counts))))
1760626080572:# ---- Combine cohorts safely ----
1760626080572:combined_meta <- rbindlist(list(A, B), use.names = TRUE, fill = TRUE)
1760626080841:# Verify alignment (optional sanity check)
1760626080841:stopifnot(all(c("sample_id", "condition", "cohort") %in% names(combined_meta)))
1760626081075:# ---- Order by cohort, condition, sample_id ----
1760626081075:setorder(combined_meta, cohort, condition, sample_id)
1760626081391:# ---- Join back to counts ----
1760626081392:setkey(combined_meta, sample_id)
1760626081960:dt <- combined_meta[counts, on = "sample_id"]
1760626082340:# ---- Compute gene variability ----
1760626082341:# Variance across all samples to pick top 100 most variable genes
1760626082342:gene_var <- dt[, .(var_count = var(count)), by = gene]
1760626082559:top100_genes <- gene_var[order(-var_count)][1:100, gene]
1760626082809:# ---- Filter for those genes ----
1760626082810:dt_top <- dt[gene %in% top100_genes]
1760626083076:# ---- Per-cohort, per-condition mean counts ----
1760626083079:summary_stats <- dt_top[, .(mean_count = mean(count)),
1760626083080:by = .(cohort, condition, gene)]
1760626083475:# ---- Output preview ----
1760626083476:print(head(summary_stats))
1760626083873:cat("\n✅ Combined cohorts and summarized top 100 most variable genes.\n")
1760626670529:suppressPackageStartupMessages(library(data.table))
1760626672344:# ---- Load data ----
1760626672345:counts <- fread("workspace/bulk_counts_long.csv")
1760626672792:meta   <- fread("workspace/sample_metadata.csv")
1760626673492:# ---- Standardize column names ----
1760626673493:setnames(counts, tolower(trimws(names(counts))))
1760626673909:setnames(meta,   tolower(trimws(names(meta))))
1760626674327:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1760626674328:filtered <- counts[grepl("^GENE_00", gene)]
1760626674738:# Join to get condition info
1760626674738:setkey(meta, sample_id)
1760626675160:filtered <- meta[filtered, on = "sample_id"]
1760626675560:filtered <- filtered[condition == "treated"]
1760626675978:# ---- 2️⃣ Compute mean and median count by gene ----
1760626675978:summary_gene <- filtered[, .(
1760626675979:mean_count   = mean(count),
1760626675979:median_count = median(count)
1760626675980:), by = gene]
1760626676359:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene (in one pipeline) ----
1760626676360:per_condition_summary <- meta[counts, on = "sample_id"
1760626676360:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760627758194:suppressPackageStartupMessages(library(data.table))
1760627758855:# ---- Load data ----
1760627758855:counts <- fread("workspace/bulk_counts_long.csv")
1760627763878:suppressPackageStartupMessages(library(data.table))
1760627764309:# ---- Load data ----
1760627764310:counts <- fread("workspace/bulk_counts_long.csv")
1760627764695:# ---- Standardize column names ----
1760627764696:setnames(counts, tolower(trimws(names(counts))))
1760627765076:# ---- 1️⃣ Add log2(count) column ----
1760627765077:# Add a small offset (e.g. +1) to avoid log(0) errors
1760627765077:counts[, log2_count := log2(count + 1)]
1760627765426:# ---- 2️⃣ Add a binary flag 'high' if count > 100 ----
1760627765427:counts[, high := count > 100]
1760627765827:# ---- 3️⃣ Overwrite 'high' to use a gene-wise threshold ----
1760627765828:# For each gene, compute its median count, then mark high if above that median
1760627765828:counts[, high := count > median(count), by = gene]
1760627766241:# ---- Output preview ----
1760627766241:cat("✅ Added derived columns:\n")
1760627767160:print(head(counts))
1760697541982:#' library(data.table)
1760697541983:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1760697541983:#'                      sample_id = c("S1","S2","S3","S4"),
1760697541984:#'                      count = c(100, 120, 80, 200))
1760697541984:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1760697541984:#'                    condition = c("treated","control","treated","control"))
1760697541985:#' result <- task1_filter_counts(counts, meta)
1760697541985:#' result$summary_gene
1760697541985:#'
1760697541986:#' @export
1760697541986:task1_filter_counts <- function(counts, meta) {
1760697541987:# Ensure column names are standardized
1760697541987:setnames(counts, tolower(trimws(names(counts))))
1760697541987:setnames(meta,   tolower(trimws(names(meta))))
1760697541987:# Expect:
1760697541988:# counts: gene, sample_id, count
1760697541988:# meta:   sample_id, condition
1760697541989:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1760697541989:filtered <- counts[grepl("^GENE_00", gene)]
1760697541989:setkey(meta, sample_id)
1760697541990:filtered <- meta[filtered, on = "sample_id"]
1760697541991:filtered <- filtered[condition == "treated"]
1760697541991:# 2️⃣ Mean and median per gene (treated only)
1760697541992:summary_gene <- filtered[, .(
1760697541993:mean_count   = mean(count),
1760697541993:median_count = median(count)
1760697541994:), by = gene]
1760697541994:# 3️⃣ Per-condition mean counts (all data)
1760697541995:per_condition_summary <- meta[counts, on = "sample_id"
1760697541995:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760697541995:# Return both tables as a list
1760697541996:list(
1760697541996:summary_gene = summary_gene,
1760697541996:per_condition_summary = per_condition_summary
1760697541996:)
1760697541997:}
1760697762537:#' library(data.table)
1760697762537:#' counts <- data.table(
1760697762537:#'   gene = c("GENE_001", "GENE_001", "GENE_002", "GENE_002"),
1760697762538:#'   sample_id = c("S1", "S2", "S3", "S4"),
1760697762538:#'   count = c(120, 80, 200, 50)
1760697762538:#' )
1760697762538:#' result <- task2_add_qc_flags(counts)
1760697762539:#' head(result)
1760697762539:#'
1760697762539:#' @export
1760697762539:task2_add_qc_flags <- function(counts) {
1760697762539:# Make sure columns are clean
1760697762540:setnames(counts, tolower(trimws(names(counts))))
1760697762540:# Expect: gene, sample_id, count
1760697762540:if (!all(c("gene", "sample_id", "count") %in% names(counts))) {
1760697762540:stop("Input data must contain columns: gene, sample_id, count")
1760697762541:}
1760697762541:# Add log2(count + 1)
1760697762541:counts[, log2_count := log2(count + 1)]
1760697762542:# Add QC flag: high if count > median(count) within each gene
1760697762542:counts[, high := count > median(count), by = gene]
1760697762542:return(counts[])
1760697762543:}
1760698088957:#' )
1760698088958:#' meta <- data.table(
1760698088958:#'   sample_id = c("S1","S2","S3","S4","S5","S6"),
1760698088958:#'   condition = c("treated","treated","control","control","treated","control"),
1760698088959:#'   patient_id = c("P1","P2","P1","P2","P3","P3")
1760698088959:#' )
1760698088959:#' result <- task4_annotate_counts(counts, meta)
1760698088959:#' head(result$patient_totals)
1760698088960:#'
1760698088960:#' @export
1760698088960:task4_annotate_counts <- function(counts, meta) {
1760698088961:# ---- 1️⃣ Standardize names ----
1760698088961:setnames(counts, tolower(trimws(names(counts))))
1760698088962:setnames(meta,   tolower(trimws(names(meta))))
1760698088963:# ---- 2️⃣ Join metadata ----
1760698088963:setkey(meta, sample_id)
1760698088963:joined <- meta[counts, on = "sample_id"]
1760698088964:# ---- 3️⃣ Compute total counts per patient ----
1760698088964:patient_totals <- joined[, .(total_count = sum(count, na.rm = TRUE)), by = patient_id]
1760698088965:# ---- 4️⃣ Top 10 genes by average count per condition ----
1760698088965:top_genes <- joined[, .(avg_count = mean(count, na.rm = TRUE)), by = .(condition, gene)
1760698088965:][order(condition, -avg_count), head(.SD, 10), by = condition]
1760698088966:# ---- 5️⃣ Return results ----
1760698088966:list(
1760698088967:joined = joined,
1760698088967:patient_totals = patient_totals,
1760698088968:top_genes = top_genes
1760698088968:)
1760698088969:}
1760698392641:#' peaks <- data.table(
1760698392642:#'   chr = rep("chr2", 100),
1760698392643:#'   start = seq(1e6, 5e6, length.out = 100),
1760698392643:#'   end = seq(1e6 + 100, 5e6 + 100, length.out = 100),
1760698392643:#'   score = runif(100, 0, 100)
1760698392644:#' )
1760698392644:#' result <- task7_filter_genomic_peaks(peaks)
1760698392645:#' head(result)
1760698392645:#'
1760698392645:#' @export
1760698392645:task7_filter_genomic_peaks <- function(peaks,
1760698392646:chromosome = "chr2",
1760698392646:start_range = c(2e6, 4e6),
1760698392646:top_n = 50) {
1760698392647:# ---- 1️⃣ Standardize column names ----
1760698392647:setnames(peaks, tolower(trimws(names(peaks))))
1760698392648:# ---- 2️⃣ Filter by chromosome and range ----
1760698392648:filtered <- peaks[
1760698392649:chr == chromosome &
1760698392649:start >= start_range[1] &
1760698392649:start <= start_range[2]
1760698392650:]
1760698392650:# ---- 3️⃣ Rank by descending score ----
1760698392650:setorder(filtered, -score)
1760698392651:# ---- 4️⃣ Select top peaks ----
1760698392651:top_peaks <- head(filtered, top_n)
1760698392652:# ---- 5️⃣ Return filtered table ----
1760698392653:return(top_peaks[])
1760698392653:}
1760698440990:#'   count = c(100,200,150,220, 20,30,25,40, 300,600,250,800)
1760698440990:#' )
1760698440990:#' meta <- data.table(
1760698440991:#'   sample_id = paste0("S", 1:12),
1760698440991:#'   condition = rep(c("control","treated"), each = 6)
1760698440991:#' )
1760698440992:#' res <- task8_summarize_gene_stats(counts, meta)
1760698440992:#' head(res$result)
1760698440993:#'
1760698440993:#' @export
1760698440993:task8_summarize_gene_stats <- function(counts, meta) {
1760698440994:# ---- 1️⃣ Standardize column names ----
1760698440994:setnames(counts, tolower(trimws(names(counts))))
1760698440995:setnames(meta,   tolower(trimws(names(meta))))
1760698440996:# ---- 2️⃣ Join metadata to counts ----
1760698440996:setkey(meta, sample_id)
1760698440996:dt <- meta[counts, on = "sample_id"]
1760698440997:# ---- 3️⃣ Compute summary statistics per gene × condition ----
1760698440997:summ_stats <- dt[, .(
1760698440998:mean   = mean(count, na.rm = TRUE),
1760698440998:median = median(count, na.rm = TRUE),
1760698440998:q1     = quantile(count, 0.25, na.rm = TRUE),
1760698440999:q3     = quantile(count, 0.75, na.rm = TRUE)
1760698440999:), by = .(gene, condition)]
1760698441000:# ---- 4️⃣ Reshape: wide for mean comparison ----
1760698441000:wide <- dcast(summ_stats, gene ~ condition, value.var = "mean")
1760698441001:# ---- 5️⃣ Filter: treated mean ≥ 2× control mean ----
1760698441001:filtered_genes <- wide[treated >= 2 * control, gene]
1760698441002:# ---- 6️⃣ Subset results ----
1760698441003:result <- summ_stats[gene %in% filtered_genes]
1760698441004:# ---- ✅ Return outputs ----
1760698441004:list(
1760698441004:summ_stats = summ_stats,
1760698441005:filtered_genes = filtered_genes,
1760698441005:result = result
1760698441005:)
1760698441006:}
1760698543207:#'   gene = c("GENE_001","GENE_002"),
1760698543208:#'   treated_01 = c(100, 200),
1760698543208:#'   treated_02 = c(150, 180),
1760698543209:#'   control_01 = c(50, 70),
1760698543209:#'   control_02 = c(60, 90)
1760698543209:#' )
1760698543210:#' result <- task9_reshape_counts(wide)
1760698543210:#' head(result$final)
1760698543211:#'
1760698543211:#' @export
1760698543211:task9_reshape_counts <- function(wide, treated_pattern = "treated") {
1760698543212:# ---- 1️⃣ Standardize column names ----
1760698543212:setnames(wide, tolower(trimws(names(wide))))
1760698543213:# ---- 2️⃣ Convert wide → long ----
1760698543213:long <- melt(
1760698543213:wide,
1760698543213:id.vars = "gene",
1760698543214:variable.name = "sample_id",
1760698543214:value.name = "count"
1760698543214:)
1760698543215:# ---- 3️⃣ Add per-sample totals ----
1760698543215:sample_totals <- long[, .(total_count = sum(count, na.rm = TRUE)), by = sample_id]
1760698543215:long <- merge(long, sample_totals, by = "sample_id")
1760698543216:# ---- 4️⃣ Derive condition from sample_id ----
1760698543216:long[, condition := fifelse(
1760698543217:grepl(treated_pattern, sample_id, ignore.case = TRUE),
1760698543217:"treated", "control"
1760698543217:)]
1760698543218:# ---- 5️⃣ Compute mean counts by gene × condition ----
1760698543218:summary_wide <- long[, .(mean_count = mean(count, na.rm = TRUE)), by = .(gene, condition)]
1760698543219:# ---- 6️⃣ Convert back to wide format ----
1760698543220:final <- dcast(summary_wide, gene ~ condition, value.var = "mean_count")
1760698543220:# ---- ✅ Return outputs ----
1760698543221:list(
1760698543221:long = long,
1760698543221:summary_wide = summary_wide,
1760698543222:final = final
1760698543222:)
1760698543223:}
1760698599055:#' genes <- data.table(
1760698599055:#'   chr = c("chr1","chr1","chr2"),
1760698599056:#'   start = c(150, 550, 1999000),
1760698599056:#'   end = c(300, 650, 2000500),
1760698599056:#'   gene = c("G1","G2","G3")
1760698599057:#' )
1760698599057:#' result <- task10_map_peaks_to_genes(peaks, genes)
1760698599057:#' head(result$top_genes)
1760698599058:#'
1760698599058:#' @export
1760698599058:task10_map_peaks_to_genes <- function(peaks, genes, top_n = 20) {
1760698599059:# ---- 1️⃣ Standardize names ----
1760698599059:setnames(peaks, tolower(trimws(names(peaks))))
1760698599060:setnames(genes, tolower(trimws(names(genes))))
1760698599060:# ---- 2️⃣ Key both tables by chr/start/end ----
1760698599060:setkey(peaks, chr, start, end)
1760698599061:setkey(genes, chr, start, end)
1760698599061:# ---- 3️⃣ Find overlaps ----
1760698599062:overlaps <- foverlaps(
1760698599062:peaks,
1760698599062:genes,
1760698599063:by.x = c("chr", "start", "end"),
1760698599063:by.y = c("chr", "start", "end"),
1760698599064:type = "any",
1760698599077:nomatch = 0L
1760698599079:)
1760698599085:# ---- 4️⃣ Compute overlap length (in base pairs) ----
1760698599085:overlaps[, overlap_bp :=
1760698599086:pmax(0, pmin(end, i.end) - pmax(start, i.start))]
1760698599086:# ---- 5️⃣ Summarize per gene ----
1760698599086:peaks_per_gene <- overlaps[, .(n_peaks = uniqueN(.I)), by = gene]
1760698599086:bp_per_gene    <- overlaps[, .(total_overlap_bp = sum(overlap_bp, na.rm = TRUE)), by = gene]
1760698599087:summary <- merge(peaks_per_gene, bp_per_gene, by = "gene")
1760698599087:# ---- 6️⃣ Rank and select top genes ----
1760698599087:setorder(summary, -total_overlap_bp)
1760698599087:top_genes <- head(summary, top_n)
1760698599088:# ---- ✅ Return results ----
1760698599088:list(
1760698599088:overlaps = overlaps,
1760698599088:summary = summary,
1760698599088:top_genes = top_genes
1760698599089:)
1760698599089:}
1760700995510:#' genes <- data.table(
1760700995511:#'   chr = c("chr1","chr2"),
1760700995511:#'   start = c(100, 2000),
1760700995511:#'   end = c(600, 2100),
1760700995512:#'   gene = c("G1","G2")
1760700995512:#' )
1760700995512:#' result <- task11_map_variants_to_genes(variants, genes)
1760700995513:#' head(result$counts_gene_sample)
1760700995513:#'
1760700995513:#' @export
1760700995514:task11_map_variants_to_genes <- function(variants, genes) {
1760700995514:# ---- 1️⃣ Standardize column names ----
1760700995514:setnames(variants, tolower(trimws(names(variants))))
1760700995515:setnames(genes,    tolower(trimws(names(genes))))
1760700995515:# ---- 2️⃣ Convert variant positions into 1-bp intervals ----
1760700995516:variants[, start := pos]
1760700995516:variants[, end   := pos]
1760700995517:# ---- 3️⃣ Set keys for overlap join ----
1760700995517:setkey(variants, chr, start, end)
1760700995517:setkey(genes,    chr, start, end)
1760700995518:# ---- 4️⃣ Find overlaps (which gene each variant falls into) ----
1760700995518:overlaps <- foverlaps(
1760700995519:variants,
1760700995519:genes,
1760700995519:by.x = c("chr", "start", "end"),
1760700995520:by.y = c("chr", "start", "end"),
1760700995520:type = "any",
1760700995521:nomatch = 0L
1760700995521:)
1760700995522:# ---- 5️⃣ Filter for HIGH-impact variants ----
1760700995522:high_imp <- overlaps[tolower(impact) == "high"]
1760700995523:# ---- 6️⃣ Count HIGH variants by gene × sample ----
1760700995523:counts_gene_sample <- high_imp[, .N, by = .(gene, sample_id)]
1760700995524:setnames(counts_gene_sample, "N", "high_variant_count")
1760700995524:# ---- 7️⃣ Identify genes with HIGH-impact variants in all samples ----
1760700995525:samples_with_high <- unique(high_imp[, .(gene, sample_id)])
1760700995525:gene_sample_counts <- samples_with_high[, .N, by = gene]
1760700995525:total_samples <- uniqueN(variants$sample_id)
1760700995525:genes_all_samples <- gene_sample_counts[N == total_samples, gene]
1760700995526:# ---- ✅ Return results ----
1760700995527:list(
1760700995527:overlaps = overlaps,
1760700995527:counts_gene_sample = counts_gene_sample,
1760700995528:genes_all_samples = genes_all_samples
1760700995528:)
1760700995528:}
1760701046914:?task11_map_variants_to_genes
1760701073690:?task11_map_variants_to_genes
1760701648222:#' )
1760701648223:#' counts <- data.table(
1760701648223:#'   gene = rep(c("G1","G2","G3"), each = 4),
1760701648224:#'   sample_id = c("S1","S2","S3","S4"),
1760701648224:#'   count = c(10,20,40,50, 5,7,30,35, 12,18,25,27)
1760701648224:#' )
1760701648225:#' result <- task12_combine_cohorts(cohortA, cohortB, counts)
1760701648226:#' head(result$summary_stats)
1760701648226:#'
1760701648226:#' @export
1760701648227:task12_combine_cohorts <- function(cohortA, cohortB, counts, top_n = 100) {
1760701648228:# ---- 1️⃣ Standardize names ----
1760701648228:setnames(cohortA, tolower(trimws(names(cohortA))))
1760701648229:setnames(cohortB, tolower(trimws(names(cohortB))))
1760701648229:setnames(counts,  tolower(trimws(names(counts))))
1760701648230:# ---- 2️⃣ Combine metadata safely ----
1760701648230:combined_meta <- rbindlist(list(cohortA, cohortB), use.names = TRUE, fill = TRUE)
1760701648231:# ---- 3️⃣ Sanity check ----
1760701648231:stopifnot(all(c("sample_id", "condition", "cohort") %in% names(combined_meta)))
1760701648233:# ---- 4️⃣ Sort metadata ----
1760701648233:setorder(combined_meta, cohort, condition, sample_id)
1760701648234:# ---- 5️⃣ Join with counts ----
1760701648235:setkey(combined_meta, sample_id)
1760701648235:dt <- combined_meta[counts, on = "sample_id"]
1760701648236:# ---- 6️⃣ Compute variance per gene ----
1760701648236:gene_var <- dt[, .(var_count = var(count, na.rm = TRUE)), by = gene]
1760701648236:top_genes <- gene_var[order(-var_count)][1:top_n, gene]
1760701648237:# ---- 7️⃣ Filter for top variable genes ----
1760701648237:dt_top <- dt[gene %in% top_genes]
1760701648238:# ---- 8️⃣ Compute mean per cohort × condition × gene ----
1760701648238:summary_stats <- dt_top[, .(mean_count = mean(count, na.rm = TRUE)),
1760701648239:by = .(cohort, condition, gene)]
1760701648240:# ---- ✅ Return results ----
1760701648240:list(
1760701648240:combined_meta = combined_meta,
1760701648241:gene_var = gene_var,
1760701648241:summary_stats = summary_stats
1760701648241:)
1760701648242:}
1760701659009:View(task12_combine_cohorts)
1760703641815:?task5_classify_labs
1760703658134:??task5_classify_labs
1760703941398:task5 <-
1760703958201:task12_combine_cohorts()
1760703974326:#' library(data.table)
1760703974326:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1760703974327:#'                      sample_id = c("S1","S2","S3","S4"),
1760703974327:#'                      count = c(100, 120, 80, 200))
1760703974327:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1760703974327:#'                    condition = c("treated","control","treated","control"))
1760703974328:#' result <- task1_filter_counts(counts, meta)
1760703974328:#' result$summary_gene
1760703974328:#'
1760703974329:#' @export
1760703974329:task1_filter_counts <- function(counts, meta) {
1760703974329:# Ensure column names are standardized
1760703974330:setnames(counts, tolower(trimws(names(counts))))
1760703974330:setnames(meta,   tolower(trimws(names(meta))))
1760703974331:# Expect:
1760703974331:# counts: gene, sample_id, count
1760703974332:# meta:   sample_id, condition
1760703974332:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1760703974332:filtered <- counts[grepl("^GENE_00", gene)]
1760703974333:setkey(meta, sample_id)
1760703974333:filtered <- meta[filtered, on = "sample_id"]
1760703974333:filtered <- filtered[condition == "treated"]
1760703974334:# 2️⃣ Mean and median per gene (treated only)
1760703974334:summary_gene <- filtered[, .(
1760703974334:mean_count   = mean(count),
1760703974335:median_count = median(count)
1760703974335:), by = gene]
1760703974335:# 3️⃣ Per-condition mean counts (all data)
1760703974336:per_condition_summary <- meta[counts, on = "sample_id"
1760703974337:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760703974337:# Return both tables as a list
1760703974338:list(
1760703974338:summary_gene = summary_gene,
1760703974338:per_condition_summary = per_condition_summary
1760703974339:)
1760703974339:}
1760703979376:#' library(data.table)
1760703979377:#' counts <- data.table(
1760703979377:#'   gene = c("GENE_001", "GENE_001", "GENE_002", "GENE_002"),
1760703979378:#'   sample_id = c("S1", "S2", "S3", "S4"),
1760703979378:#'   count = c(120, 80, 200, 50)
1760703979379:#' )
1760703979379:#' result <- task2_add_qc_flags(counts)
1760703979380:#' head(result)
1760703979380:#'
1760703979381:#' @export
1760703979381:task2_add_qc_flags <- function(counts) {
1760703979381:# Make sure columns are clean
1760703979382:setnames(counts, tolower(trimws(names(counts))))
1760703979382:# Expect: gene, sample_id, count
1760703979383:if (!all(c("gene", "sample_id", "count") %in% names(counts))) {
1760703979383:stop("Input data must contain columns: gene, sample_id, count")
1760703979383:}
1760703979384:# Add log2(count + 1)
1760703979384:counts[, log2_count := log2(count + 1)]
1760703979385:# Add QC flag: high if count > median(count) within each gene
1760703979386:counts[, high := count > median(count), by = gene]
1760703979388:return(counts[])
1760703979388:}
1760703984656:#' library(data.table)
1760703984656:#' counts <- data.table(gene = rep(c("GENE_005","GENE_010"), each=3),
1760703984656:#'                      sample_id = paste0("SAMPLE_0", 1:3),
1760703984657:#'                      count = c(50, 70, 100, 10, 20, 30))
1760703984657:#' meta <- data.table(sample_id = paste0("SAMPLE_0", 1:3),
1760703984657:#'                    condition = c("treated","control","treated"))
1760703984657:#' result <- task3_join_and_index(counts, meta)
1760703984657:#' result$timings
1760703984658:#'
1760703984658:#' @export
1760703984658:task3_join_and_index <- function(counts, meta,
1760703984659:test_gene = "GENE_005",
1760703984659:test_sample = "SAMPLE_01") {
1760703984659:# ---- 1️⃣ Standardize names ----
1760703984660:setnames(counts, tolower(trimws(names(counts))))
1760703984660:setnames(meta,   tolower(trimws(names(meta))))
1760703984660:# ---- 2️⃣ Key metadata and join ----
1760703984661:setkey(meta, sample_id)
1760703984661:joined <- meta[counts, on = "sample_id"]
1760703984662:# ---- 3️⃣ Add secondary index on (gene, sample_id) ----
1760703984662:setindex(counts, gene, sample_id)
1760703984662:# ---- 4️⃣ Define a query function for benchmarking ----
1760703984663:query <- function() counts[gene == test_gene & sample_id == test_sample]
1760703984663:# Run twice to demonstrate index speed
1760703984663:time_before <- system.time(query())[["elapsed"]]
1760703984664:time_after  <- system.time(query())[["elapsed"]]
1760703984664:timings <- c(before_index = time_before, after_index = time_after)
1760703984665:# ---- 5️⃣ Return results ----
1760703984666:list(
1760703984666:joined = joined,
1760703984667:timings = timings,
1760703984667:query_result = query()
1760703984668:)
1760703984669:}
1760703988857:#' )
1760703988857:#' meta <- data.table(
1760703988857:#'   sample_id = c("S1","S2","S3","S4","S5","S6"),
1760703988858:#'   condition = c("treated","treated","control","control","treated","control"),
1760703988858:#'   patient_id = c("P1","P2","P1","P2","P3","P3")
1760703988858:#' )
1760703988859:#' result <- task4_annotate_counts(counts, meta)
1760703988859:#' head(result$patient_totals)
1760703988860:#'
1760703988860:#' @export
1760703988860:task4_annotate_counts <- function(counts, meta) {
1760703988861:# ---- 1️⃣ Standardize names ----
1760703988862:setnames(counts, tolower(trimws(names(counts))))
1760703988862:setnames(meta,   tolower(trimws(names(meta))))
1760703988862:# ---- 2️⃣ Join metadata ----
1760703988863:setkey(meta, sample_id)
1760703988863:joined <- meta[counts, on = "sample_id"]
1760703988864:# ---- 3️⃣ Compute total counts per patient ----
1760703988864:patient_totals <- joined[, .(total_count = sum(count, na.rm = TRUE)), by = patient_id]
1760703988865:# ---- 4️⃣ Top 10 genes by average count per condition ----
1760703988865:top_genes <- joined[, .(avg_count = mean(count, na.rm = TRUE)), by = .(condition, gene)
1760703988865:][order(condition, -avg_count), head(.SD, 10), by = condition]
1760703988866:# ---- 5️⃣ Return results ----
1760703988866:list(
1760703988867:joined = joined,
1760703988867:patient_totals = patient_totals,
1760703988867:top_genes = top_genes
1760703988868:)
1760703988868:}
1760704124686:task12_combine_cohorts()
1760704131151:usethis::create_package(".")
1760705060989:#' )
1760705060990:#' ranges <- data.table(
1760705060990:#'   lab = c("CRP","GLUCOSE"),
1760705060991:#'   lower = c(0, 70),
1760705060991:#'   upper = c(10, 140)
1760705060991:#' )
1760705060992:#' result <- task5_classify_labs(labs, ranges)
1760705060992:#' head(result$abnormal_rates_lab)
1760705060992:#'
1760705060993:#' @export
1760705060993:task5_classify_labs <- function(labs, ranges) {
1760705060994:# ---- 1️⃣ Standardize column names ----
1760705060994:setnames(labs, tolower(trimws(names(labs))))
1760705060994:setnames(ranges, tolower(trimws(names(ranges))))
1760705060995:# ---- 2️⃣ Non-equi join: classify results ----
1760705060996:setkey(ranges, lab)
1760705060996:classified <- ranges[labs, on = .(lab, lower <= value, upper >= value), nomatch = 0L]
1760705060996:classified[, status := ifelse(!is.na(lower), "normal", "out_of_range")]
1760705060997:# ---- 3️⃣ Merge back missing values (fill as out_of_range) ----
1760705060997:out_all <- merge(labs, classified, all.x = TRUE)
1760705060998:out_all[is.na(status), status := "out_of_range"]
1760705060998:# ---- 4️⃣ Summarize abnormal result rates ----
1760705060998:abnormal_rates_patient <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = patient_id]
1760705060999:abnormal_rates_lab     <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = lab]
1760705060999:# ---- 5️⃣ Return results ----
1760705061000:list(
1760705061001:classified = out_all,
1760705061001:abnormal_rates_patient = abnormal_rates_patient,
1760705061002:abnormal_rates_lab = abnormal_rates_lab
1760705061002:)
1760705061003:}
1760705082436:#' library(data.table)
1760705082436:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1760705082436:#'                      sample_id = c("S1","S2","S3","S4"),
1760705082437:#'                      count = c(100, 120, 80, 200))
1760705082437:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1760705082438:#'                    condition = c("treated","control","treated","control"))
1760705082438:#' result <- task1_filter_counts(counts, meta)
1760705082439:#' result$summary_gene
1760705082439:#'
1760705082440:#' @export
1760705082440:task1_filter_counts <- function(counts, meta) {
1760705082441:# Ensure column names are standardized
1760705082441:setnames(counts, tolower(trimws(names(counts))))
1760705082441:setnames(meta,   tolower(trimws(names(meta))))
1760705082442:# Expect:
1760705082442:# counts: gene, sample_id, count
1760705082443:# meta:   sample_id, condition
1760705082444:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1760705082444:filtered <- counts[grepl("^GENE_00", gene)]
1760705082445:setkey(meta, sample_id)
1760705082445:filtered <- meta[filtered, on = "sample_id"]
1760705082445:filtered <- filtered[condition == "treated"]
1760705082446:# 2️⃣ Mean and median per gene (treated only)
1760705082446:summary_gene <- filtered[, .(
1760705082447:mean_count   = mean(count),
1760705082447:median_count = median(count)
1760705082447:), by = gene]
1760705082448:# 3️⃣ Per-condition mean counts (all data)
1760705082448:per_condition_summary <- meta[counts, on = "sample_id"
1760705082448:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760705082449:# Return both tables as a list
1760705082449:list(
1760705082450:summary_gene = summary_gene,
1760705082450:per_condition_summary = per_condition_summary
1760705082450:)
1760705082451:}
1760705089179:#' library(data.table)
1760705089181:#' counts <- data.table(
1760705089182:#'   gene = c("GENE_001", "GENE_001", "GENE_002", "GENE_002"),
1760705089182:#'   sample_id = c("S1", "S2", "S3", "S4"),
1760705089183:#'   count = c(120, 80, 200, 50)
1760705089183:#' )
1760705089183:#' result <- task2_add_qc_flags(counts)
1760705089183:#' head(result)
1760705089184:#'
1760705089184:#' @export
1760705089184:task2_add_qc_flags <- function(counts) {
1760705089185:# Make sure columns are clean
1760705089185:setnames(counts, tolower(trimws(names(counts))))
1760705089185:# Expect: gene, sample_id, count
1760705089186:if (!all(c("gene", "sample_id", "count") %in% names(counts))) {
1760705089186:stop("Input data must contain columns: gene, sample_id, count")
1760705089186:}
1760705089187:# Add log2(count + 1)
1760705089188:counts[, log2_count := log2(count + 1)]
1760705089188:# Add QC flag: high if count > median(count) within each gene
1760705089189:counts[, high := count > median(count), by = gene]
1760705089189:return(counts[])
1760705089190:}
1760705094620:#' library(data.table)
1760705094620:#' counts <- data.table(gene = rep(c("GENE_005","GENE_010"), each=3),
1760705094621:#'                      sample_id = paste0("SAMPLE_0", 1:3),
1760705094621:#'                      count = c(50, 70, 100, 10, 20, 30))
1760705094622:#' meta <- data.table(sample_id = paste0("SAMPLE_0", 1:3),
1760705094622:#'                    condition = c("treated","control","treated"))
1760705094623:#' result <- task3_join_and_index(counts, meta)
1760705094623:#' result$timings
1760705094624:#'
1760705094624:#' @export
1760705094624:task3_join_and_index <- function(counts, meta,
1760705094625:test_gene = "GENE_005",
1760705094625:test_sample = "SAMPLE_01") {
1760705094626:# ---- 1️⃣ Standardize names ----
1760705094626:setnames(counts, tolower(trimws(names(counts))))
1760705094627:setnames(meta,   tolower(trimws(names(meta))))
1760705094627:# ---- 2️⃣ Key metadata and join ----
1760705094628:setkey(meta, sample_id)
1760705094628:joined <- meta[counts, on = "sample_id"]
1760705094629:# ---- 3️⃣ Add secondary index on (gene, sample_id) ----
1760705094629:setindex(counts, gene, sample_id)
1760705094630:# ---- 4️⃣ Define a query function for benchmarking ----
1760705094631:query <- function() counts[gene == test_gene & sample_id == test_sample]
1760705094632:# Run twice to demonstrate index speed
1760705094632:time_before <- system.time(query())[["elapsed"]]
1760705094633:time_after  <- system.time(query())[["elapsed"]]
1760705094634:timings <- c(before_index = time_before, after_index = time_after)
1760705094634:# ---- 5️⃣ Return results ----
1760705094635:list(
1760705094635:joined = joined,
1760705094635:timings = timings,
1760705094636:query_result = query()
1760705094636:)
1760705094637:}
1760705355395:devtools::document()
1760705513325:task5_classify_labs <- function(labs, ranges) {
1760705513326:# code here
1760705513326:}
1760705515799:View(task5_classify_labs)
1760705621332:#' Classify lab test results as normal or out of range
1760705621333:#'
1760705621333:#' @param labs data.table of lab results
1760705621334:#' @param ranges data.table of reference ranges
1760705621334:#' @return A data.table with a 'status' column
1760705621334:#' @export
1760705621335:task5_classify_labs <- function(labs, ranges) {
1760705621335:# code here
1760705621336:}
1760705639005:devtools::document()
1760705774632:devtools::document()
1760705883496:getwd()
1760705922678:usethis::create_package("project_october")
1760705939468:usethis::create_package("projectoctober")
1760706023294:usethis::create_package("projectoctober")
1760706108204:projectoctober/R/
1760706126155:devtools::document()
1760706844737:usethis::create_package("projectfunctions")
1760706996000:devtools::document()
1760707038434:devtools::load_all()
1760707060418:?task5_classify_labs
1760707097991:?task2_add_qc_flags.Rd
1760707258159:#' library(data.table)
1760707258159:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1760707258160:#'                      sample_id = c("S1","S2","S3","S4"),
1760707258160:#'                      count = c(100, 120, 80, 200))
1760707258160:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1760707258161:#'                    condition = c("treated","control","treated","control"))
1760707258161:#' result <- task1_filter_counts(counts, meta)
1760707258161:#' result$summary_gene
1760707258162:#'
1760707258162:#' @export
1760707258162:task1_filter_counts <- function(counts, meta) {
1760707258163:# Ensure column names are standardized
1760707258163:setnames(counts, tolower(trimws(names(counts))))
1760707258163:setnames(meta,   tolower(trimws(names(meta))))
1760707258163:# Expect:
1760707258164:# counts: gene, sample_id, count
1760707258164:# meta:   sample_id, condition
1760707258165:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1760707258165:filtered <- counts[grepl("^GENE_00", gene)]
1760707258165:setkey(meta, sample_id)
1760707258165:filtered <- meta[filtered, on = "sample_id"]
1760707258166:filtered <- filtered[condition == "treated"]
1760707258166:# 2️⃣ Mean and median per gene (treated only)
1760707258166:summary_gene <- filtered[, .(
1760707258167:mean_count   = mean(count),
1760707258167:median_count = median(count)
1760707258167:), by = gene]
1760707258167:# 3️⃣ Per-condition mean counts (all data)
1760707258168:per_condition_summary <- meta[counts, on = "sample_id"
1760707258168:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760707258169:# Return both tables as a list
1760707258169:list(
1760707258169:summary_gene = summary_gene,
1760707258170:per_condition_summary = per_condition_summary
1760707258170:)
1760707258170:}
1760707274024:suppressPackageStartupMessages(library(data.table))
1760707274987:# ---- Load data ----
1760707274988:counts <- fread("workspace/bulk_counts_long.csv")
1760707275419:meta   <- fread("workspace/sample_metadata.csv")
1760707309805:suppressPackageStartupMessages(library(data.table))
1760707310256:# ---- Load data ----
1760707310256:counts <- fread("home/workspace/bulk_counts_long.csv")
1760707374407:suppressPackageStartupMessages(library(data.table))
1760707374804:# ---- Load data ----
1760707374804:counts <- fread("workspace/bulk_counts_long.csv")
1760707399307:suppressPackageStartupMessages(library(data.table))
1760707399871:# ---- Load data ----
1760707399872:counts <- fread("workspace/bulk_counts_long.csv")
1760707465655:suppressPackageStartupMessages(library(data.table))
1760707466152:# ---- Load data ----
1760707466153:counts <- fread("workspace/bulk_counts_long.csv")
1760707545494:suppressPackageStartupMessages(library(data.table))
1760707545904:# ---- Load data ----
1760707545904:counts <- fread("workspace/bulk_counts_long.csv")
1760707723338:suppressPackageStartupMessages(library(data.table))
1760707723668:# ---- Load data ----
1760707723669:counts <- fread("home/rstudio/projectfunctions/workspace/bulk_counts_long.csv")
1760707786752:suppressPackageStartupMessages(library(data.table))
1760707787137:# ---- Load data ----
1760707787140:counts <- fread("../workspace/bulk_counts_long.csv")
1760707788019:meta   <- fread("../workspace/sample_metadata.csv")
1760707877619:suppressPackageStartupMessages(library(data.table))
1760707877957:# ---- Load data ----
1760707877959:counts <- fread("../workspace/bulk_counts_long.csv")
1760707878543:# ---- Standardize column names ----
1760707878544:setnames(counts, tolower(trimws(names(counts))))
1760707879190:# ---- 1️⃣ Add log2(count) column ----
1760707879191:# Add a small offset (e.g. +1) to avoid log(0) errors
1760707879191:counts[, log2_count := log2(count + 1)]
1760707879756:# ---- 2️⃣ Add a binary flag 'high' if count > 100 ----
1760707879757:counts[, high := count > 100]
1760707880353:# ---- 3️⃣ Overwrite 'high' to use a gene-wise threshold ----
1760707880353:# For each gene, compute its median count, then mark high if above that median
1760707880353:counts[, high := count > median(count), by = gene]
1760707880830:# ---- Output preview ----
1760707880831:cat("✅ Added derived columns:\n")
1760707881369:print(head(counts))
1760707892217:suppressPackageStartupMessages(library(data.table))
1760707901119:suppressPackageStartupMessages(library(data.table))
1760707901634:# ---- Load data ----
1760707901635:counts <- fread("../workspace/bulk_counts_long.csv")
1760707902299:# ---- Standardize column names ----
1760707902300:setnames(counts, tolower(trimws(names(counts))))
1760707902782:# ---- 1️⃣ Add log2(count) column ----
1760707902783:# Add a small offset (e.g. +1) to avoid log(0) errors
1760707902783:counts[, log2_count := log2(count + 1)]
1760707903398:# ---- 2️⃣ Add a binary flag 'high' if count > 100 ----
1760707903398:counts[, high := count > 100]
1760707903953:# ---- 3️⃣ Overwrite 'high' to use a gene-wise threshold ----
1760707903954:# For each gene, compute its median count, then mark high if above that median
1760707903954:counts[, high := count > median(count), by = gene]
1760707904349:# ---- Output preview ----
1760707904349:cat("✅ Added derived columns:\n")
1760707904767:print(head(counts))
1760707908152:View(counts)
1760707908342:View(counts)
1760707917031:# task3_minimal.R — data.table only version
1760707917032:suppressPackageStartupMessages(library(data.table))
1760707917718:# Load data (assuming you're inside /home/rstudio/workspace)
1760707917719:meta   <- fread("workspace/sample_metadata.csv")
1760707927651:# task3_minimal.R — data.table only version
1760707927652:suppressPackageStartupMessages(library(data.table))
1760707928015:# Load data (assuming you're inside /home/rstudio/workspace)
1760707928015:meta   <- fread("../workspace/sample_metadata.csv")
1760707928422:counts <- fread("../workspace/bulk_counts_long.csv")
1760707929001:# 1. Key metadata by sample_id
1760707929001:setkey(meta, sample_id)
1760707929369:# 2. Join metadata into counts
1760707929370:joined <- meta[counts, on = "sample_id"]
1760707929652:# 3. Add secondary index on (gene, sample_id)
1760707929653:setindex(counts, gene, sample_id)
1760707930100:# 4. Benchmark subset query before and after index
1760707930103:query <- function() counts[gene == "GENE_005" & sample_id == "SAMPLE_01"]
1760707930503:system.time(query())   # before index (first run)
1760707931735:system.time(query())   # after index (second run, uses index)
1760707932334:# Preview joined data
1760707932335:head(joined)
1760707944735:# task4.R — Annotate counts with sample/patient info
1760707944735:suppressPackageStartupMessages(library(data.table))
1760707944983:wsp <- "workspace"
1760707945165:read_dt <- function(fname) fread(file.path(wsp, fname))
1760707945384:# Load
1760707945384:meta  <- read_dt("../sample_metadata.csv")
1760707945601:counts <- read_dt("../bulk_counts_long.csv")
1760707967052:# task4.R — Annotate counts with sample/patient info
1760707967053:suppressPackageStartupMessages(library(data.table))
1760707970738:wsp <- "workspace"
1760707971166:read_dt <- function(fname) fread(file.path(wsp, fname))
1760707971617:# Load
1760707971618:meta  <- read_dt("../sample_metadata.csv")
1760708000284:# task4.R — Annotate counts with sample/patient info
1760708000287:suppressPackageStartupMessages(library(data.table))
1760708000566:wsp <- "workspace"
1760708000816:read_dt <- function(fname) fread(file.path(wsp, fname))
1760708001152:# Load
1760708001153:meta  <- read_dt("../workspace/sample_metadata.csv")
1760708017350:# task4.R — Annotate counts with sample/patient info
1760708017351:suppressPackageStartupMessages(library(data.table))
1760708017649:wsp <- "workspace"
1760708017918:read_dt <- function(fname) fread(file.path(wsp, fname))
1760708018316:# Load
1760708018316:meta  <- read_dt("sample_metadata.csv")
1760708087239:#' library(data.table)
1760708087240:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1760708087240:#'                      sample_id = c("S1","S2","S3","S4"),
1760708087240:#'                      count = c(100, 120, 80, 200))
1760708087241:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1760708087241:#'                    condition = c("treated","control","treated","control"))
1760708087242:#' result <- task1_filter_counts(counts, meta)
1760708087242:#' result$summary_gene
1760708087242:#'
1760708087243:#' @export
1760708087243:task1_filter_counts <- function(counts, meta) {
1760708087243:# Ensure column names are standardized
1760708087244:setnames(counts, tolower(trimws(names(counts))))
1760708087244:setnames(meta,   tolower(trimws(names(meta))))
1760708087245:# Expect:
1760708087245:# counts: gene, sample_id, count
1760708087245:# meta:   sample_id, condition
1760708087246:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1760708087246:filtered <- counts[grepl("^GENE_00", gene)]
1760708087246:setkey(meta, sample_id)
1760708087247:filtered <- meta[filtered, on = "sample_id"]
1760708087247:filtered <- filtered[condition == "treated"]
1760708087250:# 2️⃣ Mean and median per gene (treated only)
1760708087251:summary_gene <- filtered[, .(
1760708087251:mean_count   = mean(count),
1760708087252:median_count = median(count)
1760708087256:), by = gene]
1760708087262:# 3️⃣ Per-condition mean counts (all data)
1760708087262:per_condition_summary <- meta[counts, on = "sample_id"
1760708087263:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760708087263:# Return both tables as a list
1760708087263:list(
1760708087263:summary_gene = summary_gene,
1760708087264:per_condition_summary = per_condition_summary
1760708087264:)
1760708087264:}
1760708104705:?task1_filter_counts
1760708437038:suppressPackageStartupMessages(library(data.table))
1760708437449:# ---- Load data ----
1760708437449:counts <- fread("projectfunction/workspace/bulk_counts_long.csv")
1760708482082:suppressPackageStartupMessages(library(data.table))
1760708482434:# ---- Load data ----
1760708482434:counts <- fread("workspace/bulk_counts_long.csv")
1760708482647:meta   <- fread("workspace/sample_metadata.csv")
1760708535313:suppressPackageStartupMessages(library(data.table))
1760708535879:# ---- Load data ----
1760708535880:counts <- fread("home/projectfunction/workspace/bulk_counts_long.csv")
1760708536763:meta   <- fread("home/projectfunction/workspace/sample_metadata.csv")
1760708633708:suppressPackageStartupMessages(library(data.table))
1760708634105:# ---- Load data ----
1760708634105:counts <- fread("home/projectfunction/workspace/bulk_counts_long.csv")
1760709328585:suppressPackageStartupMessages(library(data.table))
1760709328822:# ---- Load data ----
1760709328823:counts <- fread("bulk_counts_long.csv")
1760709400013:suppressPackageStartupMessages(library(data.table))
1760709400542:# ---- Load data ----
1760709400542:counts <- fread("home/projectfuctions/workspace/bulk_counts_long.csv")
1760709419142:suppressPackageStartupMessages(library(data.table))
1760709419374:# ---- Load data ----
1760709419375:counts <- fread("home/rstudio/projectfuctions/workspace/bulk_counts_long.csv")
1760709434926:suppressPackageStartupMessages(library(data.table))
1760709435274:# ---- Load data ----
1760709435275:counts <- fread("projectfuctions/workspace/bulk_counts_long.csv")
1760709513428:suppressPackageStartupMessages(library(data.table))
1760709513758:# ---- Load data ----
1760709513758:counts <- fread("workspace/bulk_counts_long.csv")
1760709514740:meta   <- fread("workspace/sample_metadata.csv")
1760709526857:suppressPackageStartupMessages(library(data.table))
1760709527157:# ---- Load data ----
1760709527158:counts <- fread("workspace/bulk_counts_long.csv")
1760709535941:counts <- fread("workspace/bulk_counts_long.csv")
1760709566775:# task4.R — Annotate counts with sample/patient info
1760709566776:suppressPackageStartupMessages(library(data.table))
1760709567256:wsp <- "workspace"
1760709567703:read_dt <- function(fname) fread(file.path(wsp, fname))
1760709568423:# Load
1760709568424:meta  <- read_dt("workspace/sample_metadata.csv")
1760709647775:# task5.R — Classify labs as normal/out_of_range
1760709647776:suppressPackageStartupMessages(library(data.table))
1760709648251:wsp <- "workspace"
1760709648643:read_dt <- function(fname) fread(file.path(wsp, fname))
1760709649392:labs <- read_dt("clinical_labs.csv")
1760709650036:ranges <- read_dt("lab_reference_ranges.csv")
1760709650574:#--- data.table version ---
1760709650574:dt_labs <- copy(labs)
1760709662060:suppressPackageStartupMessages(library(data.table))
1760709662340:# ---- Load data ----
1760709662341:labs   <- fread("workspace/clinical_labs.csv")
1760709662706:vitals <- fread("workspace/vitals_time_series.csv")
1760709662973:# ---- Standardize column names ----
1760709662973:setnames(labs,   tolower(trimws(names(labs))))
1760709669390:suppressPackageStartupMessages(library(data.table))
1760709669773:# ---- Load data ----
1760709669774:peaks <- fread("workspace/atac_peaks.bed.csv")
1760709669988:# ---- Standardize column names ----
1760709669988:setnames(peaks, tolower(trimws(names(peaks))))
1760709670171:# ---- Filter: peaks on chr2 with start between 2–4 Mb ----
1760709670172:filtered <- peaks[chr == "chr2" & start >= 2e6 & start <= 4e6]
1760709712457:suppressPackageStartupMessages(library(data.table))
1760709712706:# ---- Load data ----
1760709712706:wide <- fread("workspace/bulk_counts_wide.csv")
1760709712974:# ---- Standardize column names ----
1760709712976:setnames(wide, tolower(trimws(names(wide))))
1760709720758:suppressPackageStartupMessages(library(data.table))
1760709721089:# ---- Load data ----
1760709721089:peaks <- fread("workspace/atac_peaks.bed.csv")
1760709721623:genes <- fread("workspace/gene_annotation.bed.csv")
1760709722656:# ---- Standardize column names ----
1760709722657:setnames(peaks, tolower(trimws(names(peaks))))
1760709728154:suppressPackageStartupMessages(library(data.table))
1760709728424:# ---- Load data ----
1760709728424:variants <- fread("workspace/variants.csv")
1760709728622:genes    <- fread("workspace/gene_annotation.bed.csv")
1760709728768:# ---- Standardize column names ----
1760709728768:setnames(variants, tolower(trimws(names(variants))))
1760709729056:setnames(genes,    tolower(trimws(names(genes))))
1760709735553:suppressPackageStartupMessages(library(data.table))
1760709736039:# ---- Load data ----
1760709736040:A <- fread("workspace/cohortA_samples.csv")
1760709736239:B <- fread("workspace/cohortB_samples.csv")
1760709736438:counts <- fread("workspace/bulk_counts_long.csv")
1760709773038:# task4.R — Annotate counts with sample/patient info
1760709773039:suppressPackageStartupMessages(library(data.table))
1760709773588:wsp <- "workspace"
1760709773955:read_dt <- function(fname) fread(file.path(wsp, fname))
1760709774338:# Load
1760709774339:meta  <- read_dt("sample_metadata.csv")
1760709774739:counts <- read_dt("bulk_counts_long.csv")
1760709775122:#--- data.table version ---
1760709775123:dt_meta <- copy(meta)
1760709798142:#' library(data.table)
1760709798142:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1760709798143:#'                      sample_id = c("S1","S2","S3","S4"),
1760709798143:#'                      count = c(100, 120, 80, 200))
1760709798143:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1760709798144:#'                    condition = c("treated","control","treated","control"))
1760709798144:#' result <- task1_filter_counts(counts, meta)
1760709798144:#' result$summary_gene
1760709798145:#'
1760709798145:#' @export
1760709798146:task1_filter_counts <- function(counts, meta) {
1760709798146:# Ensure column names are standardized
1760709798146:setnames(counts, tolower(trimws(names(counts))))
1760709798147:setnames(meta,   tolower(trimws(names(meta))))
1760709798147:# Expect:
1760709798148:# counts: gene, sample_id, count
1760709798148:# meta:   sample_id, condition
1760709798149:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1760709798149:filtered <- counts[grepl("^GENE_00", gene)]
1760709798149:setkey(meta, sample_id)
1760709798150:filtered <- meta[filtered, on = "sample_id"]
1760709798150:filtered <- filtered[condition == "treated"]
1760709798150:# 2️⃣ Mean and median per gene (treated only)
1760709798151:summary_gene <- filtered[, .(
1760709798151:mean_count   = mean(count),
1760709798151:median_count = median(count)
1760709798164:), by = gene]
1760709798169:# 3️⃣ Per-condition mean counts (all data)
1760709798171:per_condition_summary <- meta[counts, on = "sample_id"
1760709798171:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760709798172:# Return both tables as a list
1760709798172:list(
1760709798172:summary_gene = summary_gene,
1760709798172:per_condition_summary = per_condition_summary
1760709798173:)
1760709798173:}
1760709821496:?task1_filter_counts
1760709842631:?task1_filter_counts
1760709861606:??task1_filter_counts
1760709876991:View(task1_filter_counts)
1760709914662:#' library(data.table)
1760709914663:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1760709914664:#'                      sample_id = c("S1","S2","S3","S4"),
1760709914664:#'                      count = c(100, 120, 80, 200))
1760709914665:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1760709914665:#'                    condition = c("treated","control","treated","control"))
1760709914666:#' result <- task1_filter_counts(counts, meta)
1760709914666:#' result$summary_gene
1760709914668:#'
1760709914669:#' @export
1760709914669:task1_filter_counts <- function(counts, meta) {
1760709914670:# Ensure column names are standardized
1760709914671:setnames(counts, tolower(trimws(names(counts))))
1760709914672:setnames(meta,   tolower(trimws(names(meta))))
1760709914673:# Expect:
1760709914673:# counts: gene, sample_id, count
1760709914673:# meta:   sample_id, condition
1760709914674:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1760709914674:filtered <- counts[grepl("^GENE_00", gene)]
1760709914674:setkey(meta, sample_id)
1760709914675:filtered <- meta[filtered, on = "sample_id"]
1760709914675:filtered <- filtered[condition == "treated"]
1760709914675:# 2️⃣ Mean and median per gene (treated only)
1760709914675:summary_gene <- filtered[, .(
1760709914675:mean_count   = mean(count),
1760709914676:median_count = median(count)
1760709914676:), by = gene]
1760709914676:# 3️⃣ Per-condition mean counts (all data)
1760709914676:per_condition_summary <- meta[counts, on = "sample_id"
1760709914676:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760709914677:# Return both tables as a list
1760709914677:list(
1760709914677:summary_gene = summary_gene,
1760709914677:per_condition_summary = per_condition_summary
1760709914677:)
1760709914678:}
1760709931599:?task1_filter_counts
1760710051852:?task1_filter_counts
1760710132250:?task1_filter_counts
1760710248976:usethis::create_package("functionshelp")
1760710363841:devtools::document()
1760710407114:devtools::load_all()
1760710445675:?task5_classify_labs
1760710483943:?task1_filter_counts
1760710494557:suppressPackageStartupMessages(library(data.table))
1760710494871:# ---- Load data ----
1760710494871:counts <- fread("workspace/bulk_counts_long.csv")
1760710495253:meta   <- fread("workspace/sample_metadata.csv")
1760710651343:?task1_filter_counts
1760710673800:?task1_filter_count
1760710692594:?task1_filter_counts
1760710768071:counts <- fread("workspace/bulk_counts_long.csv")
1760710968988:suppressPackageStartupMessages(library(data.table))
1760710969599:# ---- Load data ----
1760710969600:counts <- fread("bulk_counts_long.csv")
1760710972318:meta   <- fread("sample_metadata.csv")
1760713505098:# ---- Load data ----
1760713505099:counts <- fread("home/bulk_counts_long.csv")
1760714007455:meta   <- fread("../sample_metadata.csv")
1760714139076:meta   <- fread("~/sample_metadata.csv")
1760714585279:?task1_filter_count
1760714610360:?task1_filter_counts
1760714644953:# ---- Load data ----
1760714644953:counts <- fread("workspace/bulk_counts_long.csv")
1760714677212:# ---- Load data ----
1760714677213:counts <- fread("~/bulk_counts_long.csv")
1760715241792:# ---- Load data ----
1760715241793:labs   <- fread("~/workspace/clinical_labs.csv")
1760715242864:vitals <- fread("~/workspace/vitals_time_series.csv")
1760715266880:# Load data (assuming you're inside /home/rstudio/workspace)
1760715266881:meta   <- fread("~/workspace/sample_metadata.csv")
1760715267712:counts <- fread("~/workspace/bulk_counts_long.csv")
1760715278312:read_dt <- function(fname) fread(file.path(wsp, fname))
1760715279178:# Load
1760715279179:meta  <- read_dt("sample_metadata.csv")
1760715293996:read_dt <- function(fname) fread(file.path(wsp, fname))
1760715294695:# Load
1760715294695:meta  <- read_dt("~/sample_metadata.csv")
1760715295926:counts <- read_dt("~/bulk_counts_long.csv")
1760715311578:read_dt <- function(fname) fread(file.path(wsp, fname))
1760715312095:# Load
1760715312096:meta  <- read_dt("~/workspace/sample_metadata.csv")
1760715312539:counts <- read_dt("~/workspace/bulk_counts_long.csv")
1760715323029:read_dt <- function(fname) fread(file.path(wsp, fname))
1760715323461:# Load
1760715323462:meta  <- read_dt("sample_metadata.csv")
1760715341447:read_dt <- function(fname) fread(file.path(wsp, fname))
1760715342028:labs <- read_dt("clinical_labs.csv")
1760715485633:# task4.R — Annotate counts with sample/patient info
1760715485634:suppressPackageStartupMessages(library(data.table))
1760715486078:# Define workspace folder
1760715486079:wsp <- "workspace"
1760715486610:# Define safe reader helper
1760715486610:read_dt <- function(fname) {
1760715486611:fread(file.path(wsp, fname))
1760715486611:}
1760715487227:# Load data
1760715487228:meta   <- read_dt("sample_metadata.csv")
1760715938127:read_dt <- function(fname) fread(file.path(wsp, fname))
1760715938575:# Load
1760715938576:meta  <- read_dt("sample_metadata.csv")
1760716309894:read_dt <- function(fname) fread(file.path(~, wsp, fname))
1760716381556:counts <- fread("~/workspace/bulk_counts_long.csv")
1760716395072:# task4.R — Annotate counts with sample/patient info
1760716395072:suppressPackageStartupMessages(library(data.table))
1760716405442:# Load
1760716405442:meta  <- fread("~/workspace/sample_metadata.csv")
1760716411020:counts <- fread("~/workspace/bulk_counts_long.csv")
1760716477523:#--- data.table version ---
1760716477524:dt_meta <- copy(meta)
1760716478005:dt_counts <- copy(counts)
1760716478321:# Join sample metadata
1760716478322:setkey(dt_meta, sample_id)
1760716478603:joined <- dt_meta[dt_counts, on = "sample_id"]
1760716478838:# Per-patient total counts
1760716478839:patient_totals <- joined[, .(total_count = sum(count)), by = patient_id]
1760716479070:# Top 10 genes by average count within each condition
1760716479071:top_genes <- joined[, .(avg_count = mean(count)), by = .(condition, gene)
1760716479071:][order(condition, -avg_count), head(.SD, 10), by = condition]
1760716479388:#--- data.frame version ---
1760716479389:df_meta <- as.data.frame(meta)
1760716479805:df_counts <- as.data.frame(counts)
1760716480186:df_joined <- merge(df_counts, df_meta, by = "sample_id", all.x = TRUE)
1760716480438:df_patient_total <- aggregate(count ~ patient_id, df_joined, sum)
1760716480655:df_top_genes <- do.call(rbind, lapply(split(df_joined, df_joined$condition), function(x) {
1760716480655:t <- aggregate(count ~ gene, x, mean)
1760716480656:head(t[order(-t$count), ], 10)
1760716480656:}))
1760716480903:#--- Output small checks ---
1760716480903:print(head(patient_totals))
1760716481138:print(head(top_genes))
1760716622706:# task5.R — Classify labs as normal/out_of_range
1760716622707:suppressPackageStartupMessages(library(data.table))
1760716623152:labs <- fread("~/workspace/clinical_labs.csv")
1760716623569:ranges <- fread("~/workspace/lab_reference_ranges.csv")
1760716624089:#--- data.table version ---
1760716624090:dt_labs <- copy(labs)
1760716624700:dt_ranges <- copy(ranges)
1760716625036:# Non-equi join: value between lower and upper
1760716625037:setkey(dt_ranges, lab)
1760716625553:classified <- dt_ranges[dt_labs, on = .(lab, lower <= value, upper >= value), nomatch = 0L]
1760716625837:classified[, status := ifelse(!is.na(lower), "normal", "out_of_range")]
1760716626168:# Fill missing labs as out_of_range
1760716626168:out_all <- merge(dt_labs, classified, all.x = TRUE)
1760716626538:out_all[is.na(status), status := "out_of_range"]
1760716626820:# Count abnormal rates
1760716626820:abnormal_rates_patient <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = patient_id]
1760716627105:abnormal_rates_lab <- out_all[, .(abnormal_rate = mean(status == "out_of_range")), by = lab]
1760716627405:#--- data.frame version ---
1760716627406:df_labs <- as.data.frame(labs)
1760716627671:df_ranges <- as.data.frame(ranges)
1760716627970:df_joined <- merge(df_labs, df_ranges, by = "lab", all.x = TRUE)
1760716628220:df_joined$status <- ifelse(df_joined$value >= df_joined$lower & df_joined$value <= df_joined$upper, "normal", "out_of_range")
1760716628503:df_pat <- aggregate(status == "out_of_range" ~ patient_id, df_joined, mean)
1760716628754:df_lab <- aggregate(status == "out_of_range" ~ lab, df_joined, mean)
1760716629020:#--- Output check ---
1760716629021:print(head(abnormal_rates_patient))
1760716629286:print(head(abnormal_rates_lab))
1760716648822:suppressPackageStartupMessages(library(data.table))
1760716649205:# ---- Load data ----
1760716649205:labs   <- fread("~/workspace/clinical_labs.csv")
1760716649420:vitals <- fread("~/workspace/vitals_time_series.csv")
1760716649639:# ---- Standardize column names ----
1760716649639:setnames(labs,   tolower(trimws(names(labs))))
1760716649820:setnames(vitals, tolower(trimws(names(vitals))))
1760716651289:# Rename 'time_iso' to 'time'
1760716651289:setnames(labs,   "time_iso", "time")
1760716651487:setnames(vitals, "time_iso", "time")
1760716651648:# ---- Convert to POSIXct ----
1760716651649:labs[,   time := as.POSIXct(time,   tz = "UTC", tryFormats = c(
1760716651649:"%Y-%m-%d %H:%M:%S", "%Y-%m-%dT%H:%M:%S", "%Y/%m/%d %H:%M:%S"
1760716651649:))]
1760716662821:suppressPackageStartupMessages(library(data.table))
1760716663220:# ---- Load data ----
1760716663221:peaks <- fread("~/workspace/atac_peaks.bed.csv")
1760716663455:# ---- Standardize column names ----
1760716663455:setnames(peaks, tolower(trimws(names(peaks))))
1760716663906:# ---- Filter: peaks on chr2 with start between 2–4 Mb ----
1760716663906:filtered <- peaks[chr == "chr2" & start >= 2e6 & start <= 4e6]
1760716683498:suppressPackageStartupMessages(library(data.table))
1760716683900:# ---- Load data ----
1760716683901:counts <- fread("~/workspace/bulk_counts_long.csv")
1760716684282:meta   <- fread("~/workspace/sample_metadata.csv")
1760716710621:# ---- Standardize column names ----
1760716710621:setnames(counts, tolower(trimws(names(counts))))
1760716710820:setnames(meta,   tolower(trimws(names(meta))))
1760716711001:# ---- Join metadata to counts ----
1760716711002:setkey(meta, sample_id)
1760716711166:dt <- meta[counts, on = "sample_id"]
1760716711331:# ---- Compute summary stats by gene and condition ----
1760716711332:# Q1 = 25th percentile, Q3 = 75th percentile
1760716711332:summ_stats <- dt[, .(
1760716711333:mean   = mean(count),
1760716711333:median = median(count),
1760716711334:q1     = quantile(count, 0.25),
1760716711335:q3     = quantile(count, 0.75)
1760716711335:), by = .(gene, condition)]
1760716738972:# ---- Load data ----
1760716738973:wide <- fread("~/workspace/bulk_counts_wide.csv")
1760716797619:suppressPackageStartupMessages(library(data.table))
1760716797977:# ---- Load data ----
1760716797978:peaks <- fread("~/workspace/atac_peaks.bed.csv")
1760716798371:genes <- fread("~/workspace/gene_annotation.bed.csv")
1760716871322:suppressPackageStartupMessages(library(data.table))
1760716871605:# ---- Load data ----
1760716871605:A <- fread("~/workspace/cohortA_samples.csv")
1760716871814:B <- fread("~/workspace/cohortB_samples.csv")
1760716872000:counts <- fread("~/workspace/bulk_counts_long.csv")
1760716872164:# ---- Standardize column names ----
1760716872164:setnames(A, tolower(trimws(names(A))))
1760716886665:?task1_filter_counts
1760785780061:# task4.R — Annotate counts with sample/patient info
1760785780061:suppressPackageStartupMessages(library(data.table))
1760785780511:# Load
1760785780511:meta  <- fread("~/workspace/sample_metadata.csv")
1760785780946:counts <- fread("~/workspace/bulk_counts_long.csv")
1760785781343:#--- data.table version ---
1760785781344:dt_meta <- copy(meta)
1760785781794:dt_counts <- copy(counts)
1760785782159:# Join sample metadata
1760785782159:setkey(dt_meta, sample_id)
1760785782660:joined <- dt_meta[dt_counts, on = "sample_id"]
1760785783037:# Per-patient total counts
1760785783038:patient_totals <- joined[, .(total_count = sum(count)), by = patient_id]
1760785794634:?task1_filter_counts
1760785818286:?task1_filter_counts
1760785866073:task1_filter_counts
1760785875477:?task1_filter_counts
1760785956353:?task1_filter_counts
1760785994550:?task5_classify_labs
1760786070394:getwd
1760786080171:getswd()
1760786085972:getwd()
1760786117449:devtools::document()
1760786151289:devtools::load_all()
1760786162352:?task1_filter_counts
1760786271496:devtools::load_all("path/to/functionshelp")
1760786302039:devtools::load_all("home/functionshelp")
1760786340615:devtools::load_all(~/functionshelp)
1760786367313:> devtools::load_all("~/functionshelp")
1760786375927:devtools::load_all(~/functionshelp)
1760786392295:devtools::load_all("~/functionshelp")
1760786423883:?task1_filter_counts
1760786478828:?task1_filter_counts
1760786509966:?task1_filter_counts
1760786586074:devtools::load_all()
1760803847937:?task1_filter_counts
1760803865026:devtools::load_all()
1760803876740:?task1_filter_counts
1760962481118:suppressPackageStartupMessages(library(data.table))
1760962481799:# ---- Load data ----
1760962481799:counts <- fread("~/bulk_counts_long.csv")
1760962493815:# ---- Load data ----
1760962493815:counts <- fread("~/workspace/bulk_counts_long.csv")
1760962494682:meta   <- fread("~/workspace/sample_metadata.csv")
1760962844164:suppressPackageStartupMessages(library(data.table))
1760962844859:# ---- Load data ----
1760962844859:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1760962845343:meta   <- as.data.frame(fread("~/workspace/sample_metadata.csv"))
1760962846026:# ---- Standardize column names ----
1760962846031:names(counts) <- tolower(trimws(names(counts)))
1760962846609:names(meta)   <- tolower(trimws(names(meta)))
1760962847843:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1760962847843:filtered <- subset(counts, grepl("^GENE_00", gene))
1760962848310:# Join to get condition info
1760962848311:filtered <- merge(filtered, meta, by = "sample_id", all.x = TRUE)
1760962848989:filtered <- subset(filtered, condition == "treated")
1760962849606:# ---- 2️⃣ Compute mean and median count by gene ----
1760962849606:summary_gene <- aggregate(count ~ gene, data = filtered,
1760962849607:FUN = function(x) c(mean = mean(x), median = median(x)))
1760962850406:summary_gene <- data.frame(gene = summary_gene$gene, summary_gene$count)
1760962850966:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene ----
1760962850967:merged <- merge(counts, meta, by = "sample_id", all.x = TRUE)
1760962851575:per_condition_summary <- aggregate(count ~ gene + condition, data = merged, mean)
1760962852458:names(per_condition_summary)[names(per_condition_summary) == "count"] <- "mean_count"
1760962852993:# ---- Output preview ----
1760962852994:cat("\n✅ Summary of treated GENE_00 genes:\n")
1760962854025:print(head(summary_gene))
1760962854426:cat("\n✅ Per-condition mean counts by gene:\n")
1760962919042:suppressPackageStartupMessages(library(data.table))
1760962919494:# ---- Load data ----
1760962919495:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1760962919904:# ---- Standardize column names ----
1760962919909:names(counts) <- tolower(trimws(names(counts)))
1760962920474:# ---- 1️⃣ Add log2(count) column ----
1760962920476:# Add a small offset (+1) to avoid log(0) errors
1760962920477:counts$log2_count <- log2(counts$count + 1)
1760962920958:# ---- 2️⃣ Add a binary flag 'high' if count > 100 ----
1760962920959:counts$high <- counts$count > 100
1760962921392:# ---- 3️⃣ Overwrite 'high' using a gene-wise threshold ----
1760962921394:# For each gene, compute its median count and flag if above median
1760962921394:gene_medians <- aggregate(count ~ gene, data = counts, median)
1760962921911:names(gene_medians)[2] <- "median_count"
1760962922427:# Merge back to main table
1760962922428:counts <- merge(counts, gene_medians, by = "gene", all.x = TRUE)
1760963214125:suppressPackageStartupMessages(library(data.table))
1760963214522:# ---- Load data ----
1760963214523:meta   <- as.data.frame(fread("~/workspace/sample_metadata.csv"))
1760963214957:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1760963215373:# ---- Standardize column names ----
1760963215374:names(meta)   <- tolower(trimws(names(meta)))
1760963215722:names(counts) <- tolower(trimws(names(counts)))
1760963216206:# ---- 1️⃣ Merge metadata with counts ----
1760963216206:joined <- merge(counts, meta, by = "sample_id", all.x = TRUE)
1760963507805:suppressPackageStartupMessages(library(data.table))
1760963508190:# ---- Load data ----
1760963508191:meta   <- as.data.frame(fread("~/workspace/sample_metadata.csv"))
1760963508470:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1760963508687:# ---- Standardize column names ----
1760963508688:names(meta)   <- tolower(trimws(names(meta)))
1760963508887:names(counts) <- tolower(trimws(names(counts)))
1760963509339:# ---- 1️⃣ Join sample metadata ----
1760963509339:joined <- merge(counts, meta, by = "sample_id", all.x = TRUE)
1760963509520:# ---- 2️⃣ Per-patient total counts ----
1760963509520:patient_totals <- aggregate(count ~ patient_id, data = joined, sum)
1760963509682:names(patient_totals)[2] <- "total_count"
1760963624722:suppressPackageStartupMessages(library(data.table))
1760963625103:# ---- Load data ----
1760963625105:labs   <- as.data.frame(fread("~/workspace/clinical_labs.csv"))
1760963625319:ranges <- as.data.frame(fread("~/workspace/lab_reference_ranges.csv"))
1760963625582:# ---- Standardize column names ----
1760963625583:names(labs)   <- tolower(trimws(names(labs)))
1760963626019:names(ranges) <- tolower(trimws(names(ranges)))
1760963814554:suppressPackageStartupMessages(library(data.table))
1760963814800:# ---- Load data ----
1760963814801:labs   <- as.data.frame(fread("~/workspace/clinical_labs.csv"))
1760963815032:vitals <- as.data.frame(fread("~/workspace/vitals_time_series.csv"))
1760963815233:# ---- Standardize column names ----
1760963815234:names(labs)   <- tolower(trimws(names(labs)))
1760963815450:names(vitals) <- tolower(trimws(names(vitals)))
1760963815984:# Rename time column if needed
1760963815985:if ("time_iso" %in% names(labs))   names(labs)[names(labs) == "time_iso"] <- "time"
1760963816234:if ("time_iso" %in% names(vitals)) names(vitals)[names(vitals) == "time_iso"] <- "time"
1760964038423:suppressPackageStartupMessages(library(data.table))
1760964039016:# ---- Load data ----
1760964039017:peaks <- as.data.frame(fread("~/workspace/atac_peaks.bed.csv"))
1760964039464:# ---- Standardize column names ----
1760964039465:names(peaks) <- tolower(trimws(names(peaks)))
1760964039733:# ---- 1️⃣ Filter peaks on chr2 with start between 2–4 Mb ----
1760964039734:filtered <- subset(peaks, chr == "chr2" & start >= 2e6 & start <= 4e6)
1760964040050:# ---- 2️⃣ Order by descending score and select top 50 ----
1760964040051:filtered <- filtered[order(-filtered$score), ]
1760964040567:top50 <- head(filtered, 50)
1760964261350:suppressPackageStartupMessages(library(data.table))
1760964261593:# ---- Load data ----
1760964261594:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1760964261759:meta   <- as.data.frame(fread("~/workspace/sample_metadata.csv"))
1760964261942:# ---- Standardize column names ----
1760964261943:names(counts) <- tolower(trimws(names(counts)))
1760964262092:names(meta)   <- tolower(trimws(names(meta)))
1760964262260:# ---- 1️⃣ Join metadata to counts ----
1760964262260:dt <- merge(counts, meta, by = "sample_id", all.x = TRUE)
1760964342615:suppressPackageStartupMessages(library(data.table))
1760964342880:# ---- Load data ----
1760964342880:wide <- as.data.frame(fread("~/workspace/bulk_counts_wide.csv"))
1760964343043:# ---- Standardize column names ----
1760964343044:names(wide) <- tolower(trimws(names(wide)))
1760964343225:# ---- 1️⃣ Convert wide → long ----
1760964343225:# Use base R reshape()
1760964343226:long <- reshape(
1760964343226:wide,
1760964343226:varying = names(wide)[-1],
1760964343227:v.names = "count",
1760964343227:timevar = "sample_id",
1760964343228:times = names(wide)[-1],
1760964343228:idvar = "gene",
1760964343228:direction = "long"
1760964343229:)
1760964343407:row.names(long) <- NULL
1760964343540:# ---- 2️⃣ Add per-sample totals ----
1760964343541:sample_totals <- aggregate(count ~ sample_id, data = long, sum)
1760964978387:suppressPackageStartupMessages(library(data.table))
1760964978642:# ---- Load data ----
1760964978644:peaks <- as.data.frame(fread("~/workspace/atac_peaks.bed.csv"))
1760964978842:genes <- as.data.frame(fread("~/workspace/gene_annotation.bed.csv"))
1760964978967:# ---- Standardize column names ----
1760964978967:names(peaks) <- tolower(trimws(names(peaks)))
1760964979135:names(genes) <- tolower(trimws(names(genes)))
1760967402016:suppressPackageStartupMessages(library(data.table))
1760967402647:# ---- Load data ----
1760967402648:counts <- fread("~/workspace/bulk_counts_long.csv")
1760967404644:meta   <- fread("~/workspace/sample_metadata.csv")
1760967405393:# ---- Standardize column names ----
1760967405395:setnames(counts, tolower(trimws(names(counts))))
1760967406160:setnames(meta,   tolower(trimws(names(meta))))
1760967406828:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1760967406829:filtered <- counts[grepl("^GENE_00", gene)]
1760967408993:# Join to get condition info
1760967408993:setkey(meta, sample_id)
1760967409541:filtered <- meta[filtered, on = "sample_id"]
1760967410208:filtered <- filtered[condition == "treated"]
1760967410994:# ---- 2️⃣ Compute mean and median count by gene ----
1760967410995:summary_gene <- filtered[, .(
1760967410995:mean_count   = mean(count),
1760967410996:median_count = median(count)
1760967410996:), by = gene]
1760967414745:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene (in one pipeline) ----
1760967414746:per_condition_summary <- meta[counts, on = "sample_id"
1760967414746:][, .(mean_count = mean(count)), by = .(gene, condition)]
1760967416808:# ---- Output preview
1760967417759:# ---- Output preview
1761038844871:devtools::load_all()
1761038869181:source("~/projectfunctions/R/tasks_df_functions.R")
1761038903543:source("~/projectfunctions/functiontask1.R")
1761038930370:source("~/projectfunctions/functiontask1")
1761038953916:result <- task1_df_filter_counts()
1761038966056:result <- task1_df_filter_counts()
1761038967914:View(result)
1761039544482:suppressPackageStartupMessages(library(data.table))
1761039545369:# ---- Load data ----
1761039545371:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1761039546000:nt_cluster  <- fread("~/workspace/nt_combined_clustering.output.csv")
1761039546586:# ---- Standardize column names ----
1761039546587:setnames(integration, tolower(trimws(names(integration))))
1761039547000:setnames(nt_cluster,  tolower(trimws(names(nt_cluster))))
1761039547234:# ---- Merge by cell ----
1761039547235:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1761039547484:# ---- Summarize counts per integration_cluster × sample_type × cell_type ----
1761039547485:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1761039547967:setnames(summary_counts, "N", "n_cells")
1761039548334:# ---- Optional: compute proportions per cluster ----
1761039548334:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1761039548752:# ---- Sort results ----
1761039548752:setorder(summary_counts, integration_cluster, -n_cells)
1761039549333:# ---- Output preview ----
1761039549334:cat("\n✅ Cluster–CellType associations:\n")
1761039564867:suppressPackageStartupMessages(library(data.table))
1761039565367:# ---- Load data ----
1761039565368:integration <- as.data.frame(fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761039565951:nt_cluster  <- as.data.frame(fread("~/workspace/nt_combined_clustering.output.csv"))
1761039566702:# ---- Standardize column names ----
1761039566703:names(integration) <- tolower(trimws(names(integration)))
1761039567250:names(nt_cluster)  <- tolower(trimws(names(nt_cluster)))
1761039567784:# ---- Merge by cell ----
1761039567785:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1761039568317:# ---- Summarize counts per integration_cluster × sample_type × cell_type ----
1761039568318:summary_counts <- aggregate(cell ~ integration_cluster + sample_type + cell_type,
1761039568318:data = merged, FUN = length)
1761039568751:names(summary_counts)[4] <- "n_cells"
1761039569250:# ---- Optional: compute proportions per cluster ----
1761039569251:cluster_totals <- aggregate(n_cells ~ integration_cluster, data = summary_counts, sum)
1761039569849:names(cluster_totals)[2] <- "cluster_total"
1761039570351:summary_counts <- merge(summary_counts, cluster_totals, by = "integration_cluster", all.x = TRUE)
1761039570951:summary_counts$prop <- summary_counts$n_cells / summary_counts$cluster_total
1761039571467:# ---- Sort results ----
1761039571468:summary_counts <- summary_counts[order(summary_counts$integration_cluster, -summary_counts$n_cells), ]
1761039571984:# ---- Output preview ----
1761039571984:cat("\n✅ Cluster–CellType associations:\n")
1761039969399:devtools::document()
1761040084570:devtools::load_all()
1761040119472:?final_task_dt
1761040135072:?final_task_df
1761128565913:#' Filter and summarize gene expression counts
1761128565914:#'
1761128565914:#' This function filters a bulk RNA-seq count table to keep only genes whose
1761128565914:#' names start with `"GENE_00"` and only samples labeled as `"treated"`.
1761128565915:#' It then computes per-gene summary statistics (mean and median count) and
1761128565915:#' returns both a treated-only summary and an overall per-condition summary.
1761128565916:#'
1761128565916:#' @param counts A `data.table` containing gene expression data with columns:
1761128565916:#'   \describe{
1761128565917:#'     \item{gene}{Character: gene identifier.}
1761128565917:#'     \item{sample_id}{Character: unique sample ID.}
1761128565917:#'     \item{count}{Numeric: expression count for that gene in that sample.}
1761128565918:#'   }
1761128565918:#' @param meta A `data.table` containing sample metadata with columns:
1761128565918:#'   \describe{
1761128565919:#'     \item{sample_id}{Character: sample identifier matching `counts`.}
1761128565919:#'     \item{condition}{Character: experimental condition (e.g., `"treated"`, `"control"`).}
1761128565920:#'   }
1761128565920:#'
1761128565920:#' @return A list with two elements:
1761128565921:#' \describe{
1761128565921:#'   \item{summary_gene}{A `data.table` with mean and median counts per gene (treated samples only).}
1761128565921:#'   \item{per_condition_summary}{A `data.table` with mean count per gene and condition.}
1761128565922:#' }
1761128565922:#'
1761128565922:#' @examples
1761128565922:#' library(data.table)
1761128565923:#' counts <- data.table(gene = c("GENE_001","GENE_001","GENE_002","GENE_002"),
1761128565923:#'                      sample_id = c("S1","S2","S3","S4"),
1761128565923:#'                      count = c(100, 120, 80, 200))
1761128565924:#' meta <- data.table(sample_id = c("S1","S2","S3","S4"),
1761128565924:#'                    condition = c("treated","control","treated","control"))
1761128565924:#' result <- task1_filter_counts(counts, meta)
1761128565925:#' result$summary_gene
1761128565925:#'
1761128565926:#' @export
1761128565926:task1_filter_counts <- function(counts, meta) {
1761128565926:# Ensure column names are standardized
1761128565927:setnames(counts, tolower(trimws(names(counts))))
1761128565927:setnames(meta,   tolower(trimws(names(meta))))
1761128565928:# Expect:
1761128565928:# counts: gene, sample_id, count
1761128565929:# meta:   sample_id, condition
1761128565929:# 1️⃣ Filter: genes starting with "GENE_00" and treated samples
1761128565930:filtered <- counts[grepl("^GENE_00", gene)]
1761128565930:setkey(meta, sample_id)
1761128565930:filtered <- meta[filtered, on = "sample_id"]
1761128565931:filtered <- filtered[condition == "treated"]
1761128565932:# 2️⃣ Mean and median per gene (treated only)
1761128565932:summary_gene <- filtered[, .(
1761128565932:mean_count   = mean(count),
1761128565933:median_count = median(count)
1761128565933:), by = gene]
1761128565934:# 3️⃣ Per-condition mean counts (all data)
1761128565934:per_condition_summary <- meta[counts, on = "sample_id"
1761128565934:][, .(mean_count = mean(count)), by = .(gene, condition)]
1761128565935:# Return both tables as a list
1761128565935:list(
1761128565935:summary_gene = summary_gene,
1761128565936:per_condition_summary = per_condition_summary
1761128565936:)
1761128565936:}
1761128568257:View(task1_filter_counts)
1761128569675:View(task1_filter_counts)
1761128569851:View(task1_filter_counts)
1761128598972:#' Add QC-style derived columns to count data
1761128598973:#'
1761128598975:#' This function takes a long-format count table and adds two useful
1761128598975:#' quality-control (QC) columns:
1761128598976:#' \itemize{
1761128598976:#'   \item \strong{log2_count}: the log2-transformed expression value (`log2(count + 1)`),
1761128598976:#'   \item \strong{high}: a logical flag (`TRUE`/`FALSE`) indicating whether a
1761128598977:#'     count is higher than the median value for that gene.
1761128598977:#' }
1761128598977:#' The log2 transformation compresses large values and avoids issues with zeros.
1761128598978:#' The \code{high} flag is recomputed per gene, making it a relative threshold.
1761128598978:#'
1761128598978:#' @param counts A `data.table` containing at least the columns:
1761128598979:#'   \describe{
1761128598979:#'     \item{gene}{Character: gene identifier.}
1761128598979:#'     \item{sample_id}{Character: unique sample ID.}
1761128598979:#'     \item{count}{Numeric: expression count for that gene in that sample.}
1761128598980:#'   }
1761128598980:#'
1761128598980:#' @return A modified `data.table` with two new columns:
1761128598981:#' \describe{
1761128598981:#'   \item{log2_count}{Numeric: log2-transformed counts.}
1761128598982:#'   \item{high}{Logical: `TRUE` if count > median(count) within the same gene.}
1761128598982:#' }
1761128598982:#'
1761128598982:#' @examples
1761128598983:#' library(data.table)
1761128598984:#' counts <- data.table(
1761128598984:#'   gene = c("GENE_001", "GENE_001", "GENE_002", "GENE_002"),
1761128598984:#'   sample_id = c("S1", "S2", "S3", "S4"),
1761128598985:#'   count = c(120, 80, 200, 50)
1761128598985:#' )
1761128598985:#' result <- task2_add_qc_flags(counts)
1761128598986:#' head(result)
1761128598986:#'
1761128598987:#' @export
1761128598987:task2_add_qc_flags <- function(counts) {
1761128598987:# Make sure columns are clean
1761128598987:setnames(counts, tolower(trimws(names(counts))))
1761128598988:# Expect: gene, sample_id, count
1761128598988:if (!all(c("gene", "sample_id", "count") %in% names(counts))) {
1761128598989:stop("Input data must contain columns: gene, sample_id, count")
1761128598989:}
1761128598990:# Add log2(count + 1)
1761128598990:counts[, log2_count := log2(count + 1)]
1761128598991:# Add QC flag: high if count > median(count) within each gene
1761128598991:counts[, high := count > median(count), by = gene]
1761128598991:return(counts[])
1761128598992:}
1761128600791:View(task2_add_qc_flags)
1761128601903:View(task2_add_qc_flags)
1761128614075:View(task1_filter_counts)
1761128631364:task1_filter_counts(counts,meta)
1761128709930:task1_filter_counts(bulk_counts_long.csv, sample_metadata.csv)
1761128939064:library(functionshelp)     # your package
1761129056805:devtools::install()
1761129080799:library(functionshelp)
1761129112527:library(microbenchmark)    # benchmarking
1761129135768:install.packages("microbenchmark")
1761129155175:library(functionshelp)     # your package
1761129155177:library(microbenchmark)    # benchmarking
1761129155215:library(ggplot2)           # plotting
1761129155311:library(data.table)
1761129187533:task_pairs <- list(
1761129187534:task1  = c("task1_filter_counts",       "task1_df_filter_counts"),
1761129187535:task2  = c("task2_add_qc_columns",      "task2_df_add_qc_columns"),
1761129187535:task3  = c("task3_join_metadata",       "task3_df_join_metadata"),
1761129187536:task4  = c("task4_annotate_counts",     "task4_df_annotate_counts"),
1761129187536:task5  = c("task5_classify_labs",       "task5_df_classify_labs"),
1761129187536:task6  = c("task6_nearest_vitals",      "task6_df_nearest_vitals"),
1761129187537:task7  = c("task7_slice_peaks",         "task7_df_slice_peaks"),
1761129187537:task8  = c("task8_summary_stats",       "task8_df_summary_stats"),
1761129187537:task9  = c("task9_reshape_counts",      "task9_df_reshape_counts"),
1761129187538:task10 = c("task10_map_peaks",          "task10_df_map_peaks"),
1761129187538:task11 = c("task11_map_snps",           "task11_df_map_snps"),
1761129187539:task12 = c("task12_combine_cohorts",    "task12_df_combine_cohorts"),
1761129187539:final  = c("final_task_dt",             "final_task_df")
1761129187539:)
1761129203971:benchmark_results <- list()
1761129203972:for (task_name in names(task_pairs)) {
1761129203973:cat("⏱️ Running", task_name, "...\n")
1761129203974:funcs <- task_pairs[[task_name]]
1761129203975:dt_fun <- match.fun(funcs[1])
1761129203975:df_fun <- match.fun(funcs[2])
1761129203976:mb <- microbenchmark(
1761129203976:data_table = dt_fun(),
1761129203977:data_frame = df_fun(),
1761129203977:times = 5L
1761129203978:)
1761129203978:benchmark_results[[task_name]] <- data.frame(
1761129203979:task = task_name,
1761129203979:method = c("data.table", "data.frame"),
1761129203979:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761129203980:)
1761129203981:}
1761129592581:devtools::load_all()
1761129603488:exists("task1_filter_counts")
1761129603489:exists("task1_df_filter_counts")
1761129799356:library(functionshelp)     # your package
1761129800296:library(microbenchmark)    # benchmarking
1761129801100:library(ggplot2)           # plotting
1761129802082:library(data.table)
1761129803132:task_pairs <- list(
1761129803133:task1  = c("task1_filter_counts",       "task1_df_filter_counts"),
1761129803134:task2  = c("task2_add_qc_columns",      "task2_df_add_qc_columns"),
1761129803134:task3  = c("task3_join_metadata",       "task3_df_join_metadata"),
1761129803135:task4  = c("task4_annotate_counts",     "task4_df_annotate_counts"),
1761129803135:task5  = c("task5_classify_labs",       "task5_df_classify_labs"),
1761129803135:task6  = c("task6_nearest_vitals",      "task6_df_nearest_vitals"),
1761129803136:task7  = c("task7_slice_peaks",         "task7_df_slice_peaks"),
1761129803136:task8  = c("task8_summary_stats",       "task8_df_summary_stats"),
1761129803137:task9  = c("task9_reshape_counts",      "task9_df_reshape_counts"),
1761129803137:task10 = c("task10_map_peaks",          "task10_df_map_peaks"),
1761129803138:task11 = c("task11_map_snps",           "task11_df_map_snps"),
1761129803138:task12 = c("task12_combine_cohorts",    "task12_df_combine_cohorts"),
1761129803138:final  = c("final_task_dt",             "final_task_df")
1761129803139:)
1761129805900:benchmark_results <- list()
1761129807333:for (task_name in names(task_pairs)) {
1761129807333:cat("⏱️ Running", task_name, "...\n")
1761129807334:funcs <- task_pairs[[task_name]]
1761129807334:dt_fun <- match.fun(funcs[1])
1761129807335:df_fun <- match.fun(funcs[2])
1761129807335:mb <- microbenchmark(
1761129807336:data_table = dt_fun(),
1761129807336:data_frame = df_fun(),
1761129807337:times = 5L
1761129807337:)
1761129807337:benchmark_results[[task_name]] <- data.frame(
1761129807338:task = task_name,
1761129807338:method = c("data.table", "data.frame"),
1761129807339:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761129807339:)
1761129807339:}
1761129831001:benchmark_summary <- do.call(rbind, benchmark_results)
1761129831863:row.names(benchmark_summary) <- NULL
1761129997715:library(functionshelp)     # your package
1761129998280:library(microbenchmark)    # benchmarking
1761129998664:library(ggplot2)           # plotting
1761129999098:library(data.table)
1761129999598:task_pairs <- list(
1761129999598:task1  = c("task1_filter_counts",       "task1_df_filter_counts"),
1761129999598:task2  = c("task2_add_qc_columns",      "task2_df_add_qc_columns"),
1761129999599:task3  = c("task3_join_metadata",       "task3_df_join_metadata"),
1761129999599:task4  = c("task4_annotate_counts",     "task4_df_annotate_counts"),
1761129999599:task5  = c("task5_classify_labs",       "task5_df_classify_labs"),
1761129999600:task6  = c("task6_nearest_vitals",      "task6_df_nearest_vitals"),
1761129999600:task7  = c("task7_slice_peaks",         "task7_df_slice_peaks"),
1761129999600:task8  = c("task8_summary_stats",       "task8_df_summary_stats"),
1761129999601:task9  = c("task9_reshape_counts",      "task9_df_reshape_counts"),
1761129999601:task10 = c("task10_map_peaks",          "task10_df_map_peaks"),
1761129999601:task11 = c("task11_map_snps",           "task11_df_map_snps"),
1761129999602:task12 = c("task12_combine_cohorts",    "task12_df_combine_cohorts"),
1761129999602:final  = c("final_task_dt",             "final_task_df")
1761129999603:)
1761130000665:benchmark_results <- list()
1761130001216:for (task_name in names(task_pairs)) {
1761130001216:cat("⏱️ Running", task_name, "...\n")
1761130001217:funcs <- task_pairs[[task_name]]
1761130001217:dt_fun <- match.fun(funcs[1])
1761130001218:df_fun <- match.fun(funcs[2])
1761130001218:if (task_name == "task1") {
1761130001219:counts <- fread("~/workspace/bulk_counts_long.csv")
1761130001219:meta   <- fread("~/workspace/sample_metadata.csv")
1761130001219:mb <- microbenchmark(
1761130001220:data_table = dt_fun(counts, meta),
1761130001220:data_frame = df_fun(counts, meta),
1761130001221:times = 5L
1761130001221:)
1761130001222:} else {
1761130001222:mb <- microbenchmark(
1761130001223:data_table = dt_fun(),
1761130001223:data_frame = df_fun(),
1761130001223:times = 5L
1761130001224:)
1761130001224:}
1761130001225:benchmark_results[[task_name]] <- data.frame(
1761130001225:task = task_name,
1761130001226:method = c("data.table", "data.frame"),
1761130001226:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761130001226:)
1761130001227:}
1761130361294:library(functionshelp)     # your package
1761130361295:library(microbenchmark)    # benchmarking
1761130361296:library(ggplot2)           # plotting
1761130361297:library(data.table)
1761130361297:task_pairs <- list(
1761130361298:task1  = c("task1_filter_counts",       "task1_df_filter_counts"),
1761130361298:task2  = c("task2_add_qc_columns",      "task2_df_add_qc_columns"),
1761130361298:task3  = c("task3_join_metadata",       "task3_df_join_metadata"),
1761130361299:task4  = c("task4_annotate_counts",     "task4_df_annotate_counts"),
1761130361299:task5  = c("task5_classify_labs",       "task5_df_classify_labs"),
1761130361299:task6  = c("task6_nearest_vitals",      "task6_df_nearest_vitals"),
1761130361300:task7  = c("task7_slice_peaks",         "task7_df_slice_peaks"),
1761130361300:task8  = c("task8_summary_stats",       "task8_df_summary_stats"),
1761130361300:task9  = c("task9_reshape_counts",      "task9_df_reshape_counts"),
1761130361301:task10 = c("task10_map_peaks",          "task10_df_map_peaks"),
1761130361302:task11 = c("task11_map_snps",           "task11_df_map_snps"),
1761130361302:task12 = c("task12_combine_cohorts",    "task12_df_combine_cohorts"),
1761130361303:final  = c("final_task_dt",             "final_task_df")
1761130361303:)
1761130361304:benchmark_results <- list()
1761130361305:for (task_name in names(task_pairs)) {
1761130361306:cat("⏱️ Running", task_name, "...\n")
1761130361307:funcs <- task_pairs[[task_name]]
1761130361307:dt_fun <- match.fun(funcs[1])
1761130361307:df_fun <- match.fun(funcs[2])
1761130361308:if (task_name == "task1") {
1761130361309:counts <- fread("~/workspace/bulk_counts_long.csv")
1761130361309:meta   <- fread("~/workspace/sample_metadata.csv")
1761130361309:mb <- microbenchmark(
1761130361310:data_table = dt_fun(counts, meta),
1761130361310:data_frame = df_fun(counts, meta),
1761130361310:times = 5L
1761130361311:)
1761130361311:} else {
1761130361312:mb <- microbenchmark(
1761130361312:data_table = dt_fun(),
1761130361312:data_frame = df_fun(),
1761130361313:times = 5L
1761130361313:)
1761130361313:}
1761130361314:benchmark_results[[task_name]] <- data.frame(
1761130361314:task = task_name,
1761130361315:method = c("data.table", "data.frame"),
1761130361315:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761130361315:)
1761130361316:}
1761131014625:suppressPackageStartupMessages({
1761131014625:library(data.table)
1761131014626:library(microbenchmark)
1761131014626:library(ggplot2)
1761131014626:})
1761131015455:# ---- 1) Pre-load all datasets once (fast + avoids I/O in loop) ----
1761131015456:# Adjust paths if needed; these match your ~/workspace layout.
1761131015457:ds <- new.env(parent = emptyenv())
1761131016121:safe_read <- function(path) {
1761131016122:if (!file.exists(path)) stop("Missing file: ", path)
1761131016122:fread(path)
1761131016122:}
1761131016870:ds$counts      <- safe_read("~/workspace/bulk_counts_long.csv")
1761131017405:ds$meta        <- safe_read("~/workspace/sample_metadata.csv")
1761131017839:ds$labs        <- safe_read("~/workspace/clinical_labs.csv")
1761131018272:ds$ranges      <- safe_read("~/workspace/lab_reference_ranges.csv")
1761131018721:ds$vitals      <- safe_read("~/workspace/vitals_time_series.csv")
1761131019123:ds$peaks       <- safe_read("~/workspace/atac_peaks.bed.csv")
1761131019553:ds$genes       <- safe_read("~/workspace/gene_annotation.bed.csv")
1761131020005:ds$wide        <- if (file.exists("~/workspace/bulk_counts_wide.csv")) safe_read("~/workspace/bulk_counts_wide.csv") else NULL
1761131020387:ds$variants    <- safe_read("~/workspace/variants.csv")
1761131020724:ds$A           <- if (file.exists("~/workspace/cohortA_samples.csv")) safe_read("~/workspace/cohortA_samples.csv") else NULL
1761131020983:ds$B           <- if (file.exists("~/workspace/cohortB_samples.csv")) safe_read("~/workspace/cohortB_samples.csv") else NULL
1761131021304:ds$integration <- if (file.exists("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761131021603:safe_read("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv") else NULL
1761131021971:ds$nt_cluster  <- if (file.exists("~/workspace/nt_combined_clustering.output.csv"))
1761131022321:safe_read("~/workspace/nt_combined_clustering.output.csv") else NULL
1761131022737:# ---- 2) Helper: call function with ONLY the args it defines ----
1761131022738:call_fun <- function(fun_name, arg_pool) {
1761131022738:f <- get(fun_name, mode = "function")
1761131022739:fmls <- names(formals(f))        # argument names the function expects
1761131022739:if (length(fmls) == 0) {
1761131022739:return(f())                    # self-contained function
1761131022740:} else {
1761131022740:# Build a named list from the pool, selecting only required names
1761131022740:to_pass <- arg_pool[intersect(fmls, names(arg_pool))]
1761131022741:return(do.call(f, to_pass))
1761131022741:}
1761131022741:}
1761131023570:# Build a big pool of possible arguments once
1761131023571:arg_pool <- list(
1761131023571:counts = ds$counts, meta = ds$meta,
1761131023572:labs = ds$labs, ranges = ds$ranges, vitals = ds$vitals,
1761131023572:peaks = ds$peaks, genes = ds$genes, wide = ds$wide,
1761131023573:variants = ds$variants, A = ds$A, B = ds$B,
1761131023573:integration = ds$integration, nt_cluster = ds$nt_cluster
1761131023573:)
1761131024285:# ---- 3) Define task pairs (your function NAMES as they exist) ----
1761131024285:# Use the data.table names you showed in your .Rd list (ignore *_df here)
1761131024286:task_pairs <- list(
1761131024286:task1  = c("task1_filter_counts",        "task1_df_filter_counts"),
1761131024286:task2  = c("task2_add_qc_flags",         "task2_df_add_qc_columns"),
1761131024287:task3  = c("task3_join_and_index",       "task3_df_join_metadata"),
1761131024287:task4  = c("task4_annotate_counts",      "task4_df_annotate_counts"),
1761131024288:task5  = c("task5_classify_labs",        "task5_df_classify_labs"),
1761131024288:task6  = c("task6_match_labs_vitals",    "task6_df_nearest_vitals"),
1761131024288:task7  = c("task7_filter_genomic_peaks", "task7_df_slice_peaks"),
1761131024289:task8  = c("task8_summarize_gene_stats", "task8_df_summary_stats"),
1761131024289:task9  = c("task9_reshape_counts",       "task9_df_reshape_counts"),
1761131024290:task10 = c("task10_map_peaks_to_genes",  "task10_df_map_peaks"),
1761131024290:task11 = c("task11_map_variants_to_genes","task11_df_map_snps"),
1761131024291:task12 = c("task12_combine_cohorts",     "task12_df_combine_cohorts"),
1761131024291:final  = c("final_task_dt",              "final_task_df")
1761131024291:)
1761131025171:# ---- 4) Benchmark loop (robust to different signatures) ----
1761131025171:benchmark_results <- list()
1761131025744:for (task_name in names(task_pairs)) {
1761131025746:cat("⏱️ Running", task_name, "...\n")
1761131025747:dt_name <- task_pairs[[task_name]][1]
1761131025748:df_name <- task_pairs[[task_name]][2]
1761131025749:# microbenchmark takes expressions; wrap calls in anonymous functions
1761131025749:mb <- microbenchmark(
1761131025749:data_table = call_fun(dt_name, arg_pool),
1761131025750:data_frame = call_fun(df_name, arg_pool),
1761131025750:times = 5L
1761131025750:)
1761131025751:benchmark_results[[task_name]] <- data.frame(
1761131025751:task   = task_name,
1761131025751:method = c("data.table", "data.frame"),
1761131025752:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761131025752:)
1761131025752:}
1761139350518:suppressPackageStartupMessages({
1761139350519:library(data.table)
1761139350519:library(microbenchmark)
1761139350520:library(ggplot2)
1761139350521:})
1761139351198:# ---- 1) Pre-load all datasets once (fast + avoids I/O in loop) ----
1761139351199:# Adjust paths if needed; these match your ~/workspace layout.
1761139351199:ds <- new.env(parent = emptyenv())
1761139351829:safe_read <- function(path) {
1761139351829:if (!file.exists(path)) stop("Missing file: ", path)
1761139351829:fread(path)
1761139351830:}
1761139353213:normalize_names <- function(dt) {
1761139353214:setnames(dt, tolower(trimws(names(dt))))
1761139353214:return(dt)
1761139353215:}
1761139354380:ds$counts      <- safe_read("~/workspace/bulk_counts_long.csv")
1761139354810:ds$meta        <- safe_read("~/workspace/sample_metadata.csv")
1761139355012:ds$labs        <- safe_read("~/workspace/clinical_labs.csv")
1761139355229:ds$ranges      <- safe_read("~/workspace/lab_reference_ranges.csv")
1761139355462:ds$vitals      <- safe_read("~/workspace/vitals_time_series.csv")
1761139355712:ds$peaks       <- safe_read("~/workspace/atac_peaks.bed.csv")
1761139355927:ds$genes       <- safe_read("~/workspace/gene_annotation.bed.csv")
1761139356145:ds$wide        <- if (file.exists("~/workspace/bulk_counts_wide.csv")) safe_read("~/workspace/bulk_counts_wide.csv") else NULL
1761139356362:ds$variants    <- safe_read("~/workspace/variants.csv")
1761139356612:ds$A           <- if (file.exists("~/workspace/cohortA_samples.csv")) safe_read("~/workspace/cohortA_samples.csv") else NULL
1761139356810:ds$B           <- if (file.exists("~/workspace/cohortB_samples.csv")) safe_read("~/workspace/cohortB_samples.csv") else NULL
1761139357063:ds$integration <- if (file.exists("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761139357328:safe_read("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv") else NULL
1761139357724:ds$nt_cluster  <- if (file.exists("~/workspace/nt_combined_clustering.output.csv"))
1761139357987:safe_read("~/workspace/nt_combined_clustering.output.csv") else NULL
1761139358257:# ---- 2) Helper: call function with ONLY the args it defines ----
1761139358257:call_fun <- function(fun_name, arg_pool) {
1761139358257:f <- get(fun_name, mode = "function")
1761139358258:fmls <- names(formals(f))        # argument names the function expects
1761139358258:if (length(fmls) == 0) {
1761139358258:return(f())                    # self-contained function
1761139358258:} else {
1761139358259:# Build a named list from the pool, selecting only required names
1761139358259:to_pass <- arg_pool[intersect(fmls, names(arg_pool))]
1761139358259:return(do.call(f, to_pass))
1761139358260:}
1761139358260:}
1761139359179:# Build a big pool of possible arguments once
1761139359180:arg_pool <- list(
1761139359180:counts = ds$counts, meta = ds$meta,
1761139359180:labs = ds$labs, ranges = ds$ranges, vitals = ds$vitals,
1761139359181:peaks = ds$peaks, genes = ds$genes, wide = ds$wide,
1761139359181:variants = ds$variants, A = ds$A, B = ds$B,
1761139359181:integration = ds$integration, nt_cluster = ds$nt_cluster
1761139359182:)
1761139359878:# ---- 3) Define task pairs (your function NAMES as they exist) ----
1761139359879:# Use the data.table names you showed in your .Rd list (ignore *_df here)
1761139359879:task_pairs <- list(
1761139359880:task1  = c("task1_filter_counts",        "task1_df_filter_counts"),
1761139359880:task2  = c("task2_add_qc_flags",         "task2_df_add_qc_columns"),
1761139359880:task3  = c("task3_join_and_index",       "task3_df_join_metadata"),
1761139359881:task4  = c("task4_annotate_counts",      "task4_df_annotate_counts"),
1761139359881:task5  = c("task5_classify_labs",        "task5_df_classify_labs"),
1761139359881:task6  = c("task6_match_labs_vitals",    "task6_df_nearest_vitals"),
1761139359881:task7  = c("task7_filter_genomic_peaks", "task7_df_slice_peaks"),
1761139359882:task8  = c("task8_summarize_gene_stats", "task8_df_summary_stats"),
1761139359882:task9  = c("task9_reshape_counts",       "task9_df_reshape_counts"),
1761139359882:task10 = c("task10_map_peaks_to_genes",  "task10_df_map_peaks"),
1761139359883:task11 = c("task11_map_variants_to_genes","task11_df_map_snps"),
1761139359883:task12 = c("task12_combine_cohorts",     "task12_df_combine_cohorts"),
1761139359883:final  = c("final_task_dt",              "final_task_df")
1761139359884:)
1761139360694:# ---- 4) Benchmark loop (robust to different signatures) ----
1761139360695:benchmark_results <- list()
1761139361441:for (task_name in names(task_pairs)) {
1761139361441:cat("⏱️ Running", task_name, "...\n")
1761139361442:dt_name <- task_pairs[[task_name]][1]
1761139361442:df_name <- task_pairs[[task_name]][2]
1761139361442:# microbenchmark takes expressions; wrap calls in anonymous functions
1761139361443:mb <- microbenchmark(
1761139361443:data_table = call_fun(dt_name, arg_pool),
1761139361443:data_frame = call_fun(df_name, arg_pool),
1761139361443:times = 5L
1761139361443:)
1761139361444:benchmark_results[[task_name]] <- data.frame(
1761139361444:task   = task_name,
1761139361444:method = c("data.table", "data.frame"),
1761139361445:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761139361445:)
1761139361445:}
1761140333983:exists("task1_df_filter_counts")
1761140376328:setwd("~/functionshelp")     # your project folder
1761140376329:devtools::load_all()
1761140441485:devtools::load_all()
1761140486588:devtools::load_all()
1761140500604:suppressPackageStartupMessages({
1761140500605:library(data.table)
1761140500605:library(microbenchmark)
1761140500605:library(ggplot2)
1761140500606:})
1761140501103:# ---- 1) Pre-load all datasets once (fast + avoids I/O in loop) ----
1761140501104:# Adjust paths if needed; these match your ~/workspace layout.
1761140501104:ds <- new.env(parent = emptyenv())
1761140501337:safe_read <- function(path) {
1761140501337:if (!file.exists(path)) stop("Missing file: ", path)
1761140501338:fread(path)
1761140501338:}
1761140501533:normalize_names <- function(dt) {
1761140501533:setnames(dt, tolower(trimws(names(dt))))
1761140501534:return(dt)
1761140501534:}
1761140501803:ds$counts      <- safe_read("~/workspace/bulk_counts_long.csv")
1761140502086:ds$meta        <- safe_read("~/workspace/sample_metadata.csv")
1761140502318:ds$labs        <- safe_read("~/workspace/clinical_labs.csv")
1761140502516:ds$ranges      <- safe_read("~/workspace/lab_reference_ranges.csv")
1761140502680:ds$vitals      <- safe_read("~/workspace/vitals_time_series.csv")
1761140502866:ds$peaks       <- safe_read("~/workspace/atac_peaks.bed.csv")
1761140503034:ds$genes       <- safe_read("~/workspace/gene_annotation.bed.csv")
1761140503219:ds$wide        <- if (file.exists("~/workspace/bulk_counts_wide.csv")) safe_read("~/workspace/bulk_counts_wide.csv") else NULL
1761140503453:ds$variants    <- safe_read("~/workspace/variants.csv")
1761140503653:ds$A           <- if (file.exists("~/workspace/cohortA_samples.csv")) safe_read("~/workspace/cohortA_samples.csv") else NULL
1761140503853:ds$B           <- if (file.exists("~/workspace/cohortB_samples.csv")) safe_read("~/workspace/cohortB_samples.csv") else NULL
1761140504069:ds$integration <- if (file.exists("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761140504285:safe_read("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv") else NULL
1761140504537:ds$nt_cluster  <- if (file.exists("~/workspace/nt_combined_clustering.output.csv"))
1761140504753:safe_read("~/workspace/nt_combined_clustering.output.csv") else NULL
1761140504989:# ---- 2) Helper: call function with ONLY the args it defines ----
1761140504990:call_fun <- function(fun_name, arg_pool) {
1761140504990:f <- get(fun_name, mode = "function")
1761140504990:fmls <- names(formals(f))        # argument names the function expects
1761140504991:if (length(fmls) == 0) {
1761140504991:return(f())                    # self-contained function
1761140504991:} else {
1761140504992:# Build a named list from the pool, selecting only required names
1761140504992:to_pass <- arg_pool[intersect(fmls, names(arg_pool))]
1761140504992:return(do.call(f, to_pass))
1761140504993:}
1761140504993:}
1761140505220:# Build a big pool of possible arguments once
1761140505221:arg_pool <- list(
1761140505221:counts = ds$counts, meta = ds$meta,
1761140505221:labs = ds$labs, ranges = ds$ranges, vitals = ds$vitals,
1761140505222:peaks = ds$peaks, genes = ds$genes, wide = ds$wide,
1761140505222:variants = ds$variants, A = ds$A, B = ds$B,
1761140505222:integration = ds$integration, nt_cluster = ds$nt_cluster
1761140505223:)
1761140505604:# ---- 3) Define task pairs (your function NAMES as they exist) ----
1761140505606:# Use the data.table names you showed in your .Rd list (ignore *_df here)
1761140505607:task_pairs <- list(
1761140505607:task1  = c("task1_filter_counts",        "task1_df_filter_counts"),
1761140505608:task2  = c("task2_add_qc_flags",         "task2_df_add_qc_columns"),
1761140505608:task3  = c("task3_join_and_index",       "task3_df_join_metadata"),
1761140505609:task4  = c("task4_annotate_counts",      "task4_df_annotate_counts"),
1761140505609:task5  = c("task5_classify_labs",        "task5_df_classify_labs"),
1761140505609:task6  = c("task6_match_labs_vitals",    "task6_df_nearest_vitals"),
1761140505610:task7  = c("task7_filter_genomic_peaks", "task7_df_slice_peaks"),
1761140505610:task8  = c("task8_summarize_gene_stats", "task8_df_summary_stats"),
1761140505610:task9  = c("task9_reshape_counts",       "task9_df_reshape_counts"),
1761140505611:task10 = c("task10_map_peaks_to_genes",  "task10_df_map_peaks"),
1761140505611:task11 = c("task11_map_variants_to_genes","task11_df_map_snps"),
1761140505611:task12 = c("task12_combine_cohorts",     "task12_df_combine_cohorts"),
1761140505612:final  = c("final_task_dt",              "final_task_df")
1761140505612:)
1761140506037:# ---- 4) Benchmark loop (robust to different signatures) ----
1761140506037:benchmark_results <- list()
1761140506470:for (task_name in names(task_pairs)) {
1761140506471:cat("⏱️ Running", task_name, "...\n")
1761140506471:dt_name <- task_pairs[[task_name]][1]
1761140506471:df_name <- task_pairs[[task_name]][2]
1761140506472:# microbenchmark takes expressions; wrap calls in anonymous functions
1761140506472:mb <- microbenchmark(
1761140506473:data_table = call_fun(dt_name, arg_pool),
1761140506473:data_frame = call_fun(df_name, arg_pool),
1761140506473:times = 5L
1761140506474:)
1761140506475:benchmark_results[[task_name]] <- data.frame(
1761140506475:task   = task_name,
1761140506475:method = c("data.table", "data.frame"),
1761140506476:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761140506476:)
1761140506476:}
1761140507203:row.names(benchmark_summary) <- NULL
1761140507603:print(benchmark_summary)
1761140508174:# ---- 6) Optional: bar plot + speedup table ----
1761140508174:if (requireNamespace("ggplot2", quietly = TRUE)) {
1761140508175:p <- ggplot(benchmark_summary, aes(x = task, y = mean_ms, fill = method)) +
1761140508175:geom_bar(stat = "identity", position = "dodge") +
1761140508175:theme_minimal(base_size = 12) +
1761140508176:labs(title = "Performance: data.table vs data.frame",
1761140508176:x = "Task", y = "Mean execution time (ms)", fill = "Method") +
1761140508176:theme(axis.text.x = element_text(angle = 45, hjust = 1))
1761140508177:print(p)
1761140508177:}
1761140822716:suppressPackageStartupMessages({
1761140822717:library(data.table)
1761140822718:library(microbenchmark)
1761140822718:library(ggplot2)
1761140822719:})
1761140823549:normalize_names <- function(dt) {
1761140823550:if (!is.null(dt)) {
1761140823551:setnames(dt, tolower(trimws(names(dt))))
1761140823551:}
1761140823552:return(dt)
1761140823552:}
1761140824284:safe_read <- function(path) {
1761140824285:if (!file.exists(path)) stop("Missing file: ", path)
1761140824285:fread(path)
1761140824286:}
1761140825114:ds$counts      <- safe_read("~/workspace/bulk_counts_long.csv")
1761140825599:ds$meta        <- safe_read("~/workspace/sample_metadata.csv")
1761140825849:ds$labs        <- safe_read("~/workspace/clinical_labs.csv")
1761140826050:ds$ranges      <- safe_read("~/workspace/lab_reference_ranges.csv")
1761140826283:ds$vitals      <- safe_read("~/workspace/vitals_time_series.csv")
1761140826502:ds$peaks       <- safe_read("~/workspace/atac_peaks.bed.csv")
1761140826717:ds$genes       <- safe_read("~/workspace/gene_annotation.bed.csv")
1761140826933:ds$wide        <- if (file.exists("~/workspace/bulk_counts_wide.csv")) safe_read("~/workspace/bulk_counts_wide.csv") else NULL
1761140827150:ds$variants    <- safe_read("~/workspace/variants.csv")
1761140827386:ds$A           <- if (file.exists("~/workspace/cohortA_samples.csv")) safe_read("~/workspace/cohortA_samples.csv") else NULL
1761140827767:ds$B           <- if (file.exists("~/workspace/cohortB_samples.csv")) safe_read("~/workspace/cohortB_samples.csv") else NULL
1761140828067:ds$integration <- if (file.exists("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761140828333:safe_read("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv") else NULL
1761140828745:ds$nt_cluster  <- if (file.exists("~/workspace/nt_combined_clustering.output.csv"))
1761140829233:safe_read("~/workspace/nt_combined_clustering.output.csv") else NULL
1761140852908:names(ds$counts)
1761141146369:suppressPackageStartupMessages({
1761141146370:library(data.table)
1761141146370:library(microbenchmark)
1761141146370:library(ggplot2)
1761141146371:})
1761141146814:normalize_names <- function(dt) {
1761141146815:if (!is.null(dt)) {
1761141146815:setnames(dt, tolower(trimws(names(dt))))
1761141146816:}
1761141146816:return(dt)
1761141146816:}
1761141147477:safe_read <- function(path) {
1761141147478:if (!file.exists(path)) stop("Missing file: ", path)
1761141147483:fread(path)
1761141147484:}
1761141147929:ds$counts      <- safe_read("~/workspace/bulk_counts_long.csv")
1761141148164:ds$meta        <- safe_read("~/workspace/sample_metadata.csv")
1761141148351:ds$labs        <- safe_read("~/workspace/clinical_labs.csv")
1761141148528:ds$ranges      <- safe_read("~/workspace/lab_reference_ranges.csv")
1761141148695:ds$vitals      <- safe_read("~/workspace/vitals_time_series.csv")
1761141148881:ds$peaks       <- safe_read("~/workspace/atac_peaks.bed.csv")
1761141149031:ds$genes       <- safe_read("~/workspace/gene_annotation.bed.csv")
1761141149211:ds$wide        <- if (file.exists("~/workspace/bulk_counts_wide.csv")) safe_read("~/workspace/bulk_counts_wide.csv") else NULL
1761141149415:ds$variants    <- safe_read("~/workspace/variants.csv")
1761141149597:ds$A           <- if (file.exists("~/workspace/cohortA_samples.csv")) safe_read("~/workspace/cohortA_samples.csv") else NULL
1761141149797:ds$B           <- if (file.exists("~/workspace/cohortB_samples.csv")) safe_read("~/workspace/cohortB_samples.csv") else NULL
1761141150015:ds$integration <- if (file.exists("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761141150179:safe_read("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv") else NULL
1761141150400:ds$nt_cluster  <- if (file.exists("~/workspace/nt_combined_clustering.output.csv"))
1761141150631:safe_read("~/workspace/nt_combined_clustering.output.csv") else NULL
1761141150848:# ---- 2) Helper: call function with ONLY the args it defines ----
1761141150850:call_fun <- function(fun_name, arg_pool) {
1761141150850:f <- get(fun_name, mode = "function")
1761141150851:fmls <- names(formals(f))        # argument names the function expects
1761141150851:if (length(fmls) == 0) {
1761141150851:return(f())                    # self-contained function
1761141150852:} else {
1761141150852:# Build a named list from the pool, selecting only required names
1761141150853:to_pass <- arg_pool[intersect(fmls, names(arg_pool))]
1761141150853:return(do.call(f, to_pass))
1761141150854:}
1761141150854:}
1761141151062:# Build a big pool of possible arguments once
1761141151063:arg_pool <- list(
1761141151063:counts = ds$counts, meta = ds$meta,
1761141151064:labs = ds$labs, ranges = ds$ranges, vitals = ds$vitals,
1761141151064:peaks = ds$peaks, genes = ds$genes, wide = ds$wide,
1761141151064:variants = ds$variants, A = ds$A, B = ds$B,
1761141151065:integration = ds$integration, nt_cluster = ds$nt_cluster
1761141151065:)
1761141151449:# ---- 3) Define task pairs (your function NAMES as they exist) ----
1761141151449:# Use the data.table names you showed in your .Rd list (ignore *_df here)
1761141151450:task_pairs <- list(
1761141151450:task1  = c("task1_filter_counts",        "task1_df_filter_counts"),
1761141151451:task2  = c("task2_add_qc_flags",         "task2_df_add_qc_columns"),
1761141151451:task3  = c("task3_join_and_index",       "task3_df_join_metadata"),
1761141151451:task4  = c("task4_annotate_counts",      "task4_df_annotate_counts"),
1761141151452:task5  = c("task5_classify_labs",        "task5_df_classify_labs"),
1761141151452:task6  = c("task6_match_labs_vitals",    "task6_df_nearest_vitals"),
1761141151453:task7  = c("task7_filter_genomic_peaks", "task7_df_slice_peaks"),
1761141151453:task8  = c("task8_summarize_gene_stats", "task8_df_summary_stats"),
1761141151453:task9  = c("task9_reshape_counts",       "task9_df_reshape_counts"),
1761141151454:task10 = c("task10_map_peaks_to_genes",  "task10_df_map_peaks"),
1761141151454:task11 = c("task11_map_variants_to_genes","task11_df_map_snps"),
1761141151454:task12 = c("task12_combine_cohorts",     "task12_df_combine_cohorts"),
1761141151455:final  = c("final_task_dt",              "final_task_df")
1761141151455:)
1761141151948:# ---- 4) Benchmark loop (robust to different signatures) ----
1761141151949:benchmark_results <- list()
1761141152778:for (task_name in names(task_pairs)) {
1761141152778:cat("⏱️ Running", task_name, "...\n")
1761141152779:dt_name <- task_pairs[[task_name]][1]
1761141152779:df_name <- task_pairs[[task_name]][2]
1761141152780:# microbenchmark takes expressions; wrap calls in anonymous functions
1761141152780:mb <- microbenchmark(
1761141152780:data_table = call_fun(dt_name, arg_pool),
1761141152781:data_frame = call_fun(df_name, arg_pool),
1761141152781:times = 5L
1761141152782:)
1761141152782:benchmark_results[[task_name]] <- data.frame(
1761141152783:task   = task_name,
1761141152783:method = c("data.table", "data.frame"),
1761141152788:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761141152792:)
1761141152793:}
1761141228234:for (task_name in names(task_pairs)) {
1761141228234:cat("⏱️ Running", task_name, "...\n")
1761141228235:dt_name <- task_pairs[[task_name]][1]
1761141228235:df_name <- task_pairs[[task_name]][2]
1761141228236:# microbenchmark takes expressions; wrap calls in anonymous functions
1761141228236:mb <- microbenchmark(
1761141228237:data_table = call_fun(dt_name, arg_pool),
1761141228237:data_frame = call_fun(df_name, arg_pool),
1761141228238:times = 5L
1761141228238:)
1761141228240:benchmark_results[[task_name]] <- data.frame(
1761141228241:task   = task_name,
1761141228243:method = c("data.table", "data.frame"),
1761141228243:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761141228244:)
1761141228244:}
1761141357118:suppressPackageStartupMessages({
1761141357119:library(data.table)
1761141357119:library(microbenchmark)
1761141357120:library(ggplot2)
1761141357120:})
1761141357346:normalize_names <- function(dt) {
1761141357347:if (!is.null(dt)) {
1761141357347:setnames(dt, tolower(trimws(names(dt))))
1761141357348:}
1761141357349:return(dt)
1761141357349:}
1761141357916:safe_read <- function(path) {
1761141357916:if (!file.exists(path)) stop("Missing file: ", path)
1761141357917:fread(path)
1761141357917:}
1761141358111:ds$counts      <- safe_read("~/workspace/bulk_counts_long.csv")
1761141358379:ds$meta        <- safe_read("~/workspace/sample_metadata.csv")
1761141359978:ds$labs        <- safe_read("~/workspace/clinical_labs.csv")
1761141360162:ds$ranges      <- safe_read("~/workspace/lab_reference_ranges.csv")
1761141360377:ds$vitals      <- safe_read("~/workspace/vitals_time_series.csv")
1761141360596:ds$peaks       <- safe_read("~/workspace/atac_peaks.bed.csv")
1761141360829:ds$genes       <- safe_read("~/workspace/gene_annotation.bed.csv")
1761141361045:ds$wide        <- if (file.exists("~/workspace/bulk_counts_wide.csv")) safe_read("~/workspace/bulk_counts_wide.csv") else NULL
1761141361247:ds$variants    <- safe_read("~/workspace/variants.csv")
1761141361429:ds$A           <- if (file.exists("~/workspace/cohortA_samples.csv")) safe_read("~/workspace/cohortA_samples.csv") else NULL
1761141361645:ds$B           <- if (file.exists("~/workspace/cohortB_samples.csv")) safe_read("~/workspace/cohortB_samples.csv") else NULL
1761141361845:ds$integration <- if (file.exists("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761141362079:safe_read("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv") else NULL
1761141362312:ds$nt_cluster  <- if (file.exists("~/workspace/nt_combined_clustering.output.csv"))
1761141362565:safe_read("~/workspace/nt_combined_clustering.output.csv") else NULL
1761141362778:# ---- 2) Helper: call function with ONLY the args it defines ----
1761141362779:call_fun <- function(fun_name, arg_pool) {
1761141362779:f <- get(fun_name, mode = "function")
1761141362780:fmls <- names(formals(f))        # argument names the function expects
1761141362780:if (length(fmls) == 0) {
1761141362781:return(f())                    # self-contained function
1761141362781:} else {
1761141362782:# Build a named list from the pool, selecting only required names
1761141362782:to_pass <- arg_pool[intersect(fmls, names(arg_pool))]
1761141362783:return(do.call(f, to_pass))
1761141362783:}
1761141362784:}
1761141362991:# Build a big pool of possible arguments once
1761141362991:arg_pool <- list(
1761141362992:counts = ds$counts, meta = ds$meta,
1761141362992:labs = ds$labs, ranges = ds$ranges, vitals = ds$vitals,
1761141362992:peaks = ds$peaks, genes = ds$genes, wide = ds$wide,
1761141362992:variants = ds$variants, A = ds$A, B = ds$B,
1761141362993:integration = ds$integration, nt_cluster = ds$nt_cluster
1761141362993:)
1761141363213:# ---- 3) Define task pairs (your function NAMES as they exist) ----
1761141363214:# Use the data.table names you showed in your .Rd list (ignore *_df here)
1761141363214:task_pairs <- list(
1761141363214:task1  = c("task1_filter_counts",        "task1_df_filter_counts"),
1761141363215:task2  = c("task2_add_qc_flags",         "task2_df_add_qc_columns"),
1761141363215:task3  = c("task3_join_and_index",       "task3_df_join_metadata"),
1761141363215:task4  = c("task4_annotate_counts",      "task4_df_annotate_counts"),
1761141363215:task5  = c("task5_classify_labs",        "task5_df_classify_labs"),
1761141363216:task6  = c("task6_match_labs_vitals",    "task6_df_nearest_vitals"),
1761141363216:task7  = c("task7_filter_genomic_peaks", "task7_df_slice_peaks"),
1761141363216:task8  = c("task8_summarize_gene_stats", "task8_df_summary_stats"),
1761141363217:task9  = c("task9_reshape_counts",       "task9_df_reshape_counts"),
1761141363217:task10 = c("task10_map_peaks_to_genes",  "task10_df_map_peaks"),
1761141363217:task11 = c("task11_map_variants_to_genes","task11_df_map_snps"),
1761141363218:task12 = c("task12_combine_cohorts",     "task12_df_combine_cohorts"),
1761141363218:final  = c("final_task_dt",              "final_task_df")
1761141363219:)
1761141363429:# ---- 4) Benchmark loop (robust to different signatures) ----
1761141363429:benchmark_results <- list()
1761141363779:for (task_name in names(task_pairs)) {
1761141363780:cat("⏱️ Running", task_name, "...\n")
1761141363780:dt_name <- task_pairs[[task_name]][1]
1761141363781:df_name <- task_pairs[[task_name]][2]
1761141363781:# microbenchmark takes expressions; wrap calls in anonymous functions
1761141363782:mb <- microbenchmark(
1761141363782:data_table = call_fun(dt_name, arg_pool),
1761141363783:data_frame = call_fun(df_name, arg_pool),
1761141363783:times = 5L
1761141363783:)
1761141363784:benchmark_results[[task_name]] <- data.frame(
1761141363785:task   = task_name,
1761141363785:method = c("data.table", "data.frame"),
1761141363786:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761141363786:)
1761141363786:}
1761141364088:# ---- 5) Combine + show results ----
1761141364089:benchmark_summary <- do.call(rbind, benchmark_results)
1761141385176:devtools::loadall()
1761141399488:devtools::load_all()
1761141404323:suppressPackageStartupMessages({
1761141404324:library(data.table)
1761141404324:library(microbenchmark)
1761141404324:library(ggplot2)
1761141404325:})
1761141404528:normalize_names <- function(dt) {
1761141404529:if (!is.null(dt)) {
1761141404529:setnames(dt, tolower(trimws(names(dt))))
1761141404529:}
1761141404530:return(dt)
1761141404530:}
1761141404709:safe_read <- function(path) {
1761141404710:if (!file.exists(path)) stop("Missing file: ", path)
1761141404710:fread(path)
1761141404711:}
1761141404911:ds$counts      <- safe_read("~/workspace/bulk_counts_long.csv")
1761141405095:ds$meta        <- safe_read("~/workspace/sample_metadata.csv")
1761141405278:ds$labs        <- safe_read("~/workspace/clinical_labs.csv")
1761141405478:ds$ranges      <- safe_read("~/workspace/lab_reference_ranges.csv")
1761141405661:ds$vitals      <- safe_read("~/workspace/vitals_time_series.csv")
1761141405861:ds$peaks       <- safe_read("~/workspace/atac_peaks.bed.csv")
1761141406007:ds$genes       <- safe_read("~/workspace/gene_annotation.bed.csv")
1761141406195:ds$wide        <- if (file.exists("~/workspace/bulk_counts_wide.csv")) safe_read("~/workspace/bulk_counts_wide.csv") else NULL
1761141406394:ds$variants    <- safe_read("~/workspace/variants.csv")
1761141406613:ds$A           <- if (file.exists("~/workspace/cohortA_samples.csv")) safe_read("~/workspace/cohortA_samples.csv") else NULL
1761141406832:ds$B           <- if (file.exists("~/workspace/cohortB_samples.csv")) safe_read("~/workspace/cohortB_samples.csv") else NULL
1761141407030:ds$integration <- if (file.exists("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761141407229:safe_read("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv") else NULL
1761141407390:ds$nt_cluster  <- if (file.exists("~/workspace/nt_combined_clustering.output.csv"))
1761141407595:safe_read("~/workspace/nt_combined_clustering.output.csv") else NULL
1761141407812:# ---- 2) Helper: call function with ONLY the args it defines ----
1761141407813:call_fun <- function(fun_name, arg_pool) {
1761141407813:f <- get(fun_name, mode = "function")
1761141407814:fmls <- names(formals(f))        # argument names the function expects
1761141407814:if (length(fmls) == 0) {
1761141407815:return(f())                    # self-contained function
1761141407815:} else {
1761141407816:# Build a named list from the pool, selecting only required names
1761141407816:to_pass <- arg_pool[intersect(fmls, names(arg_pool))]
1761141407816:return(do.call(f, to_pass))
1761141407817:}
1761141407817:}
1761141408012:# Build a big pool of possible arguments once
1761141408013:arg_pool <- list(
1761141408013:counts = ds$counts, meta = ds$meta,
1761141408013:labs = ds$labs, ranges = ds$ranges, vitals = ds$vitals,
1761141408014:peaks = ds$peaks, genes = ds$genes, wide = ds$wide,
1761141408014:variants = ds$variants, A = ds$A, B = ds$B,
1761141408015:integration = ds$integration, nt_cluster = ds$nt_cluster
1761141408015:)
1761141408191:# ---- 3) Define task pairs (your function NAMES as they exist) ----
1761141408192:# Use the data.table names you showed in your .Rd list (ignore *_df here)
1761141408192:task_pairs <- list(
1761141408193:task1  = c("task1_filter_counts",        "task1_df_filter_counts"),
1761141408193:task2  = c("task2_add_qc_flags",         "task2_df_add_qc_columns"),
1761141408194:task3  = c("task3_join_and_index",       "task3_df_join_metadata"),
1761141408194:task4  = c("task4_annotate_counts",      "task4_df_annotate_counts"),
1761141408194:task5  = c("task5_classify_labs",        "task5_df_classify_labs"),
1761141408195:task6  = c("task6_match_labs_vitals",    "task6_df_nearest_vitals"),
1761141408195:task7  = c("task7_filter_genomic_peaks", "task7_df_slice_peaks"),
1761141408196:task8  = c("task8_summarize_gene_stats", "task8_df_summary_stats"),
1761141408196:task9  = c("task9_reshape_counts",       "task9_df_reshape_counts"),
1761141408196:task10 = c("task10_map_peaks_to_genes",  "task10_df_map_peaks"),
1761141408197:task11 = c("task11_map_variants_to_genes","task11_df_map_snps"),
1761141408197:task12 = c("task12_combine_cohorts",     "task12_df_combine_cohorts"),
1761141408197:final  = c("final_task_dt",              "final_task_df")
1761141408198:)
1761141408446:# ---- 4) Benchmark loop (robust to different signatures) ----
1761141408448:benchmark_results <- list()
1761141408913:for (task_name in names(task_pairs)) {
1761141408914:cat("⏱️ Running", task_name, "...\n")
1761141408915:dt_name <- task_pairs[[task_name]][1]
1761141408915:df_name <- task_pairs[[task_name]][2]
1761141408916:# microbenchmark takes expressions; wrap calls in anonymous functions
1761141408916:mb <- microbenchmark(
1761141408917:data_table = call_fun(dt_name, arg_pool),
1761141408917:data_frame = call_fun(df_name, arg_pool),
1761141408917:times = 5L
1761141408918:)
1761141408919:benchmark_results[[task_name]] <- data.frame(
1761141408919:task   = task_name,
1761141408919:method = c("data.table", "data.frame"),
1761141408920:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761141408920:)
1761141408921:}
1761141409345:# ---- 5) Combine + show results ----
1761141409346:benchmark_summary <- do.call(rbind, benchmark_results)
1761141419080:row.names(benchmark_summary) <- NULL
1761141419578:print(benchmark_summary)
1761141420045:# ---- 6) Optional: bar plot + speedup table ----
1761141420045:if (requireNamespace("ggplot2", quietly = TRUE)) {
1761141420046:p <- ggplot(benchmark_summary, aes(x = task, y = mean_ms, fill = method)) +
1761141420046:geom_bar(stat = "identity", position = "dodge") +
1761141420047:theme_minimal(base_size = 12) +
1761141420047:labs(title = "Performance: data.table vs data.frame",
1761141420047:x = "Task", y = "Mean execution time (ms)", fill = "Method") +
1761141420048:theme(axis.text.x = element_text(angle = 45, hjust = 1))
1761141420048:print(p)
1761141420048:}
1761141919941:devtools::document()
1761141992774:devtools::document()
1761142007330:devtools::load_all()
1761142021510:?task1_filter_counts
1761142270505:suppressPackageStartupMessages({
1761142270505:library(microbenchmark)
1761142270505:library(dplyr)
1761142270506:library(functionshelp)  # your package
1761142270506:})
1761142274288:suppressPackageStartupMessages({
1761142274289:library(microbenchmark)
1761142274289:library(dplyr)
1761142274289:library(functionshelp)  # your package
1761142274290:})
1761142275186:# ---- 1️⃣ Source both function sets ----
1761142275187:source("Functionsdatatable.R")
1761142302716:devtools::document()
1761142339099:devtools::document()
1761142346094:devtools:load_all()
1761142361432:devtools::load_all()
1761142382496:suppressPackageStartupMessages({
1761142382497:library(microbenchmark)
1761142382497:library(dplyr)
1761142382497:library(functionshelp)  # your package
1761142382498:})
1761142382840:# ---- 1️⃣ Source both function sets ----
1761142382841:source("Functionsdatatable.R")
1761142647091:devtools::load_all()
1761142671223:devtools::load_all()
1761142873898:devtools::load_all()
1761142901913:source("benchmark_task.R")
1761143027565:source("benchmark_tasks.R")
1761143094771:source("benchmark_tasks.R")
1761143165674:getwd()
1761143183805:list.files()
1761143192910:getwd()
1761143199582:list.files()
1761143250751:list.files(recursive = TRUE, pattern = "benchmark", full.names = TRUE)
1761143292968:source("./R/benchmark_tasks.R")
1761143456496:setwd("/home/rstudio/functionshelp")
1761143456498:devtools::load_all()
1761143456730:source("benchmark_tasks.R")
1761143520251:suppressPackageStartupMessages({
1761143520253:library(microbenchmark)
1761143520253:library(dplyr)
1761143520254:library(functionshelp)  # your package
1761143520254:})
1761143521131:# ---- 1️⃣ Source both function sets ----
1761143521131:source("R/Functionsdatatable.R")
1761143522030:source("R/Functionsdataframe.R")
1761143523397:# ---- 2️⃣ Define the task names to benchmark ----
1761143523397:tasks <- paste0("task", 1:12)
1761143523997:# ---- 3️⃣ Prepare a results list ----
1761143523998:benchmark_results <- list()
1761143524446:# ---- 4️⃣ Loop over all tasks ----
1761143524446:for (task in tasks) {
1761143524447:dt_fun_name <- task                      # e.g. "task1_filter_counts"
1761143524447:df_fun_name <- paste0(task, "_df")       # e.g. "task1_df_filter_counts"
1761143524448:cat("⏱️ Running", task, "...\n")
1761143524448:# Try to get both functions safely
1761143524449:if (!exists(dt_fun_name, mode = "function") ||
1761143524449:!exists(df_fun_name, mode = "function")) {
1761143524449:cat("⚠️ Skipping", task, "— one of the functions not found.\n")
1761143524450:next
1761143524450:}
1761143524451:dt_fun <- get(dt_fun_name, mode = "function")
1761143524451:df_fun <- get(df_fun_name, mode = "function")
1761143524452:# ---- 5️⃣ Run microbenchmark (each 5 times) ----
1761143524452:mb <- microbenchmark(
1761143524453:data.table = dt_fun(),
1761143524453:data.frame = df_fun(),
1761143524453:times = 5L
1761143524454:)
1761143524455:# ---- 6️⃣ Store mean execution time ----
1761143524455:benchmark_results[[task]] <- data.frame(
1761143524455:task = task,
1761143524456:method = c("data.table", "data.frame"),
1761143524456:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761143524457:)
1761143524458:}
1761143706922:ls(pattern = "task")
1761143736554:source("Functionsdatatable.R")
1761143748874:source("Functionsdatatable.R")
1761143767805:devtools::document()
1761143795797:devtools::load_all()
1761143839446:devtools::document()
1761143890898:rm(list = c("task1_filter_counts", "task10_map_peaks_to_genes",
1761143890898:"task11_map_variants_to_genes", "task12_combine_cohorts", "task2_add_qc_flags",
1761143890899:"task3_join_and_index", "task4_annotate_counts", "task5_classify_labs",
1761143890900:"task6_match_labs_vitals", "task7_filter_genomic_peaks", "task8_summarize_gene_stats",
1761143890900:"task9_reshape_counts"))
1761143904780:devtools::load_all()
1761143918162:suppressPackageStartupMessages({
1761143918162:library(microbenchmark)
1761143918163:library(dplyr)
1761143918163:library(functionshelp)  # your package
1761143918163:})
1761143918642:# ---- 1️⃣ Source both function sets ----
1761143918642:source("R/Functionsdatatable.R")
1761143919060:source("R/Functionsdataframe.R")
1761143919491:# ---- 2️⃣ Define the task names to benchmark ----
1761143919492:tasks <- paste0("task", 1:12)
1761143919938:# ---- 3️⃣ Prepare a results list ----
1761143919939:benchmark_results <- list()
1761143920509:# ---- 4️⃣ Loop over all tasks ----
1761143920510:for (task in tasks) {
1761143920510:dt_fun_name <- task                      # e.g. "task1_filter_counts"
1761143920510:df_fun_name <- paste0(task, "_df")       # e.g. "task1_df_filter_counts"
1761143920511:cat("⏱️ Running", task, "...\n")
1761143920512:# Try to get both functions safely
1761143920512:if (!exists(dt_fun_name, mode = "function") ||
1761143920513:!exists(df_fun_name, mode = "function")) {
1761143920513:cat("⚠️ Skipping", task, "— one of the functions not found.\n")
1761143920514:next
1761143920514:}
1761143920515:dt_fun <- get(dt_fun_name, mode = "function")
1761143920516:df_fun <- get(df_fun_name, mode = "function")
1761143920519:# ---- 5️⃣ Run microbenchmark (each 5 times) ----
1761143920525:mb <- microbenchmark(
1761143920539:data.table = dt_fun(),
1761143920540:data.frame = df_fun(),
1761143920540:times = 5L
1761143920541:)
1761143920541:# ---- 6️⃣ Store mean execution time ----
1761143920542:benchmark_results[[task]] <- data.frame(
1761143920542:task = task,
1761143920542:method = c("data.table", "data.frame"),
1761143920542:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761143920543:)
1761143920543:}
1761143946279:source("Functionsdatatable.R")
1761144027516:devtools::documents()
1761144040178:devtools::document()
1761144111641:rm(list = c(
1761144111643:"task1_filter_counts", "task2_add_qc_flags", "task3_join_and_index",
1761144111643:"task4_annotate_counts", "task5_classify_labs", "task6_match_labs_vitals",
1761144111644:"task7_filter_genomic_peaks", "task8_summarize_gene_stats",
1761144111644:"task9_reshape_counts", "task10_map_peaks_to_genes",
1761144111645:"task11_map_variants_to_genes", "task12_combine_cohorts"
1761144111645:))
1761144120360:devtools::load_all()
1761144139362:search()
1761144155249:ls(pattern = "task")
1761144224291:file.exists("benchmark_tasks.R")
1761144238445:source("benchmark_tasks.R")
1761145513695:ls(pattern = "task")
1761145808613:ls(pattern = "task")
1761145822199:devtools::load_all()
1761145837215:rm(list = c("task1_filter_counts", "task10_map_peaks_to_genes",
1761145837215:"task12_combine_cohorts", "task2_add_qc_flags", "task3_join_and_index",
1761145837215:"task4_annotate_counts", "task5_classify_labs", "task6_match_labs_vitals",
1761145837216:"task7_filter_genomic_peaks", "task8_summarize_gene_stats", "task9_reshape_counts"))` to
1761145837216:remove the conflicts
1761145889082:devtool::load_all()
1761145904109:devtools::load_all()
1761145978664:devtools::load_all()
1761145991362:#' final_task_df — Associate cell types to integration clusters (data.frame)
1761145991362:#'
1761145991363:#' This function merges Seurat integration results with cell type annotations
1761145991363:#' and summarizes the number and proportion of cells of each type
1761145991363:#' per integration cluster and tissue type (Normal/Tumor).
1761145991364:#'
1761145991364:#' @return data.frame with columns:
1761145991365:#' integration_cluster, sample_type, cell_type, n_cells, prop
1761145991365:#' @export
1761145991366:final_task_df <- function() {
1761145991366:suppressPackageStartupMessages(library(data.table))
1761145991367:# ---- Load data ----
1761145991368:integration <- as.data.frame(fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1761145991368:nt_cluster  <- as.data.frame(fread("~/workspace/nt_combined_clustering.output.csv"))
1761145991370:# ---- Standardize column names ----
1761145991371:names(integration) <- tolower(trimws(names(integration)))
1761145991385:names(nt_cluster)  <- tolower(trimws(names(nt_cluster)))
1761145991386:# ---- Merge ----
1761145991387:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1761145991388:# ---- Summarize counts ----
1761145991388:summary_counts <- aggregate(cell ~ integration_cluster + sample_type + cell_type,
1761145991388:data = merged, FUN = length)
1761145991388:names(summary_counts)[4] <- "n_cells"
1761145991389:# ---- Compute proportions per cluster ----
1761145991389:cluster_totals <- aggregate(n_cells ~ integration_cluster, data = summary_counts, sum)
1761145991389:names(cluster_totals)[2] <- "cluster_total"
1761145991390:summary_counts <- merge(summary_counts, cluster_totals, by = "integration_cluster", all.x = TRUE)
1761145991390:summary_counts$prop <- summary_counts$n_cells / summary_counts$cluster_total
1761145991390:# ---- Sort for readability ----
1761145991391:summary_counts <- summary_counts[order(summary_counts$integration_cluster, -summary_counts$n_cells), ]
1761145991391:return(summary_counts)
1761145991391:}
1761146237607:ls(pattern = "task")
1761146295959:ls(pattern = "task")
1761146305459:devtools::load_all()
1761146330320:devtools::document()
1761146343554:devtools::load_all()
1761146355320:ls(pattern = "task")
1761146427778:list.files(recursive = TRUE, pattern = "Functions", full.names = TRUE)
1761146453127:source("R/Functionsdatatable.R")
1761146453142:source("R/Functionsdataframe.R")
1761146480346:ls(pattern = "task")
1761146497054:source("benchmark_tasks.R")
1761214448106:devtools::document()
1761214456094:devtools::load_all()
1761214476990:source("benchmark_tasks.R")
1761214548169:ls(pattern = "task")
1761214601182:source("benchmark_tasks.R")
1761214636996:source("benchmark_tasks.R")
1761214650707:devtools::ddocument()
1761214658252:devtools::document()
1761214679246:devtools::load_all()
1761214721076:suppressPackageStartupMessages({
1761214721076:library(microbenchmark)
1761214721077:library(dplyr)
1761214721077:library(functionshelp)  # your package
1761214721078:})
1761214722022:# ---- 1️⃣ Source both function sets ----
1761214722023:source("R/Functionsdatatable.R")
1761214723054:source("R/Functionsdataframe.R")
1761214723904:# ---- 2️⃣ Define the task names to benchmark ----
1761214723905:tasks <- paste0("task", 1:12)
1761214725722:# ---- 3️⃣ Prepare a results list ----
1761214725722:benchmark_results <- list()
1761214726356:# ---- 4️⃣ Loop over all tasks ----
1761214726357:for (task in tasks) {
1761214726357:dt_fun_name <- task                      # e.g. "task1_filter_counts"
1761214726358:df_fun_name <- paste0(task, "_df")       # e.g. "task1_df_filter_counts"
1761214726358:cat("⏱️ Running", task, "...\n")
1761214726359:# Try to get both functions safely
1761214726360:if (!exists(dt_fun_name, mode = "function") ||
1761214726360:!exists(df_fun_name, mode = "function")) {
1761214726360:cat("⚠️ Skipping", task, "— one of the functions not found.\n")
1761214726361:next
1761214726361:}
1761214726362:dt_fun <- get(dt_fun_name, mode = "function")
1761214726362:df_fun <- get(df_fun_name, mode = "function")
1761214726363:# ---- 5️⃣ Run microbenchmark (each 5 times) ----
1761214726364:mb <- microbenchmark(
1761214726364:data.table = dt_fun(),
1761214726364:data.frame = df_fun(),
1761214726365:times = 5L
1761214726365:)
1761214726366:# ---- 6️⃣ Store mean execution time ----
1761214726366:benchmark_results[[task]] <- data.frame(
1761214726367:task = task,
1761214726367:method = c("data.table", "data.frame"),
1761214726368:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761214726368:)
1761214726369:}
1761214758241:list.files(recursive = TRUE, pattern = "Functions", full.names = TRUE)
1761215323476:source("R/Functionsdatatable.R")
1761215323483:source("R/Functionsdataframe.R")
1761215343532:source("benchmark_tasks.R")
1761215352062:source("R/benchmark_tasks.R")
1761215393866:source("~/benchmark_tasks.R")
1761215539368:source("R/Functionsdatatable.R")
1761215539375:source("R/Functionsdataframe.R")
1761215539381:source("R/benchmark_tasks.R")
1761215561730:source("R/Functionsdatatable.R")
1761215561737:source("R/Functionsdataframe.R")
1761215561745:source("~/benchmark_tasks.R")
1761215658356:# Restart R session to clear conflicts
1761215658357:.rs.restartR()
1761215658359:# Load functions manually
1761215658359:source("R/Functionsdatatable.R")
1761215658370:source("R/Functionsdataframe.R")
1761215658377:# Now benchmark
1761215658377:source("~/benchmark_tasks.R")
1761215760424:devtools::load_all()
1761215787450:source("~/benchmar_tasks.R")
1761215805814:source("~/benchmark_tasks.R")
1761215861882:ls(pattern = "task")
1761215872862:source("R/Functionsdatatable.R")
1761215872873:source("R/Functionsdataframe.R")
1761215892665:source("~/benchmark_tasks.R")
1761216026013:ls(pattern = "task2")
1761216026015:ls(pattern = "task3")
1761216148725:ls(pattern = "task2")
1761216148726:ls(pattern = "task3")
1761216157493:devtools::load_all()
1761216172772:View(task2_df_add_qc_columns)
1761216179257:View(task2_add_qc_flags)
1761216307548:source(R/Functionsdataframe.R)
1761216323785:source("R/Functionsdatatable.R")
1761216323790:source("R/Functionsdataframe.R")
1761216361253:source("~/benchmark_tasks.R")
1761216495056:View(benchmark_results)
1761216856384:print("benchmark_summary")
1761216870660:library(ggplot2)
1761216870781:ggplot(benchmark_summary, aes(x = reorder(task, speed_ratio), y = speed_ratio)) +
1761216870781:geom_col(fill = "steelblue") +
1761216870782:coord_flip() +
1761216870782:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1761216870782:labs(
1761216870782:title = "Speed Comparison: data.frame vs data.table",
1761216870783:x = "Task",
1761216870783:y = "Speed ratio (data.frame / data.table)"
1761216870783:) +
1761216870783:theme_minimal(base_size = 13)
1761216957651:library(ggplot2)
1761216957653:ggplot(benchmark_summary, aes(x = reorder(task, ratio), y = ratio)) +
1761216957653:geom_col(fill = "steelblue") +
1761216957654:coord_flip() +
1761216957654:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1761216957654:labs(
1761216957655:title = "Speed Comparison: data.frame vs data.table",
1761216957655:x = "Task",
1761216957656:y = "Speed ratio (data.frame / data.table)"
1761216957656:) +
1761216957656:theme_minimal(base_size = 13)
1761216986352:str(benchmark_summary)
1761216995029:head(benchmark_summary)
1761217052821:library(dplyr)
1761217052823:benchmark_summary <- benchmark_summary |>
1761217052823:tidyr::pivot_wider(names_from = method, values_from = mean_ms) |>
1761217052824:mutate(speed_ratio = data.frame / data.table)
1761217064165:head(benchmark_summary)
1761217077542:library(ggplot2)
1761217077543:ggplot(benchmark_summary, aes(x = reorder(task, speed_ratio), y = speed_ratio)) +
1761217077544:geom_col(fill = "steelblue") +
1761217077544:coord_flip() +
1761217077544:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1761217077545:labs(
1761217077545:title = "Speed Comparison: data.frame vs data.table",
1761217077545:x = "Task",
1761217077546:y = "Speed ratio (data.frame / data.table)"
1761217077546:) +
1761217077546:theme_minimal(base_size = 13)
1761230432246:source("~/benchmark_tasks.R")
1761230490974:source(R/Functionsdataframe.R)
1761230510686:devtools::load_all()
1761230532133:source(R/Functionsdatatable.R)
1761230546495:source(~/functionshelp/R)
1761230584058:source(~/benchmark_tasks.R)
1761230624880:source("~/benchmark_tasks.R")
1761230929201:devtools::load_all()
1761230937519:source("R/Functionsdatatable.R")
1761230937524:source("R/Functionsdataframe.R")
1761230937528:source("R/benchmark_tasks.R")
1761230974767:source("~/benchmark_tasks.R")
1761231013285:suppressPackageStartupMessages({
1761231013287:library(microbenchmark)
1761231013287:library(dplyr)
1761231013288:library(tidyr)
1761231013288:})
1761231014560:# --- Auto-load all functions if not already available ---
1761231014561:if (!exists("task1_filter_counts")) {
1761231014561:if (file.exists("R/Functionsdatatable.R")) source("R/Functionsdatatable.R")
1761231014561:}
1761231015410:if (!exists("task1_df_filter_counts")) {
1761231015411:if (file.exists("R/Functionsdataframe.R")) source("R/Functionsdataframe.R")
1761231015411:}
1761231016146:# --- Helper: list available function names ---
1761231016146:dt_funcs <- ls(pattern = "^task[0-9]+_", envir = .GlobalEnv)
1761231017978:df_funcs <- grep("_df_", dt_funcs, value = TRUE)
1761231018843:# Match df and dt functions by task number
1761231018846:task_pairs <- tibble(
1761231018847:task_num = gsub("^task([0-9]+).*", "\\1", df_funcs),
1761231018847:df_fun = df_funcs
1761231018847:) %>%
1761231018848:mutate(dt_fun = paste0("task", task_num, "_",
1761231018848:gsub("task[0-9]+_df_", "", df_fun)))
1761231019826:# --- Run benchmark for each pair ---
1761231019827:benchmark_results <- list()
1761231020692:for (i in seq_len(nrow(task_pairs))) {
1761231020692:task_name <- paste0("task", task_pairs$task_num[i])
1761231020693:dt_fun_name <- task_pairs$dt_fun[i]
1761231020693:df_fun_name <- task_pairs$df_fun[i]
1761231020694:cat("\n⏱️ Running", task_name, "...\n")
1761231020694:if (!exists(dt_fun_name, mode = "function") ||
1761231020695:!exists(df_fun_name, mode = "function")) {
1761231020695:warning("⚠️ Skipping ", task_name, " — one of the functions not found.")
1761231020695:next
1761231020696:}
1761231020696:dt_fun <- get(dt_fun_name, mode = "function")
1761231020696:df_fun <- get(df_fun_name, mode = "function")
1761231020697:mb <- microbenchmark(
1761231020697:data.table = { suppressMessages(dt_fun()) },
1761231020698:data.frame = { suppressMessages(df_fun()) },
1761231020698:times = 3L
1761231020698:)
1761231020699:benchmark_results[[task_name]] <- data.frame(
1761231020699:task   = task_name,
1761231020700:method = c("data.table", "data.frame"),
1761231020700:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761231020700:)
1761231020701:}
1761231025799:# --- Combine all results ---
1761231025800:cat("\n⚠️ No benchmarks could be run — check that your functions are defined.\n")
1761231025800:} else {
1761231089845:suppressPackageStartupMessages({
1761231089846:library(microbenchmark)
1761231089846:library(dplyr)
1761231089846:library(tidyr)
1761231089847:})
1761231090441:# --- Auto-load all functions if not already available ---
1761231090442:if (!exists("task1_filter_counts")) {
1761231090443:if (file.exists("R/Functionsdatatable.R")) source("R/Functionsdatatable.R")
1761231090443:}
1761231090942:if (!exists("task1_df_filter_counts")) {
1761231090943:if (file.exists("R/Functionsdataframe.R")) source("R/Functionsdataframe.R")
1761231090943:}
1761231091408:# --- Helper: list available function names ---
1761231091408:dt_funcs <- ls(pattern = "^task[0-9]+_", envir = .GlobalEnv)
1761231092043:df_funcs <- grep("_df_", dt_funcs, value = TRUE)
1761231092510:# Match df and dt functions by task number
1761231092511:task_pairs <- tibble(
1761231092511:task_num = gsub("^task([0-9]+).*", "\\1", df_funcs),
1761231092511:df_fun = df_funcs
1761231092512:) %>%
1761231092512:mutate(dt_fun = paste0("task", task_num, "_",
1761231092512:gsub("task[0-9]+_df_", "", df_fun)))
1761231093158:# --- Run benchmark for each pair ---
1761231093159:benchmark_results <- list()
1761231093726:for (i in seq_len(nrow(task_pairs))) {
1761231093727:task_name <- paste0("task", task_pairs$task_num[i])
1761231093727:dt_fun_name <- task_pairs$dt_fun[i]
1761231093728:df_fun_name <- task_pairs$df_fun[i]
1761231093728:cat("\n⏱️ Running", task_name, "...\n")
1761231093729:if (!exists(dt_fun_name, mode = "function") ||
1761231093730:!exists(df_fun_name, mode = "function")) {
1761231093730:warning("⚠️ Skipping ", task_name, " — one of the functions not found.")
1761231093730:next
1761231093731:}
1761231093732:dt_fun <- get(dt_fun_name, mode = "function")
1761231093732:df_fun <- get(df_fun_name, mode = "function")
1761231093733:mb <- microbenchmark(
1761231093733:data.table = { suppressMessages(dt_fun()) },
1761231093734:data.frame = { suppressMessages(df_fun()) },
1761231093734:times = 3L
1761231093734:)
1761231093735:benchmark_results[[task_name]] <- data.frame(
1761231093735:task   = task_name,
1761231093736:method = c("data.table", "data.frame"),
1761231093737:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761231093737:)
1761231093738:}
1761231101577:# --- Combine all results ---
1761231101578:if (length(benchmark_results) == 0) {
1761231101578:cat("\n⚠️ No benchmarks could be run — check that your functions are defined.\n")
1761231101578:} else
1761231104896:# ---- Combine results ----
1761231104897:benchmark_summary <- do.call(rbind, benchmark_results)
1761231106894:row.names(benchmark_summary) <- NULL
1761231108260:# ---- Compute speed ratio ----
1761231108261:library(dplyr)
1761231109810:library(tidyr)
1761231111127:# Pivot wide to have both methods in separate columns
1761231111128:benchmark_summary <- benchmark_summary |>
1761231111128:tidyr::pivot_wider(names_from = method, values_from = mean_ms) |>
1761231111129:dplyr::mutate(speed_ratio = data.frame / data.table)
1761231112876:# ---- Print summary ----
1761231112877:cat("\n✅ Benchmark Summary (mean time in ms):\n")
1761231114158:print(benchmark_summary[, c("task", "data.table", "data.frame", "speed_ratio")])
1761231115627:# ---- Optional: Plot automatically ----
1761231115627:library(ggplot2)
1761231116727:ggplot(benchmark_summary, aes(x = reorder(task, speed_ratio), y = speed_ratio)) +
1761231116727:geom_col(fill = "steelblue") +
1761231116728:coord_flip() +
1761231116728:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1761231116728:labs(
1761231116729:title = "Speed Comparison: data.frame vs data.table",
1761231116729:x = "Task",
1761231116730:y = "Speed ratio (data.frame / data.table)"
1761231116730:) +
1761231116730:theme_minimal(base_size = 13)
1761297214945:View(benchmark_results)
1761301746863:View(benchmark_results)
1761301929103:devtools::load_all()
1761301946685:rm(list = c("task1_filter_counts", "task10_map_peaks_to_genes", "task11_map_snps",
1761301946686:"task12_combine_cohorts", "task2_add_qc_flags", "task3_join_and_index",
1761301946686:"task4_annotate_counts", "task5_classify_labs", "task6_match_labs_vitals",
1761301946686:"task7_filter_genomic_peaks", "task8_summarize_gene_stats", "task9_reshape_counts"))` to
1761301946687:remove the conflicts
1761302220356:```r
1761302235511:getwd()
1761302235513:list.files("R")
1761308057240:############################################################
1761308057240:# task1.R — Filter, summarize, and group bulk counts
1761308057241:# Data: bulk_counts_long.csv, sample_metadata.CSV
1761308057241:############################################################
1761308057242:suppressPackageStartupMessages(library(data.table))
1761308057319:# ---- Load data ----
1761308057319:counts <- fread("~/workspace/bulk_counts_long.csv")
1761308057323:meta   <- fread("~/workspace/sample_metadata.csv")
1761308057324:# ---- Standardize column names ----
1761308057324:setnames(counts, tolower(trimws(names(counts))))
1761308057325:setnames(meta,   tolower(trimws(names(meta))))
1761308057326:# Expect:
1761308057326:# counts: gene, sample_id, count
1761308057326:# meta:   sample_id, condition
1761308057327:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1761308057327:filtered <- counts[grepl("^GENE_00", gene)]
1761308057336:# Join to get condition info
1761308057336:setkey(meta, sample_id)
1761308057337:filtered <- meta[filtered, on = "sample_id"]
1761308057340:filtered <- filtered[condition == "treated"]
1761308057343:# ---- 2️⃣ Compute mean and median count by gene ----
1761308057343:summary_gene <- filtered[, .(
1761308057344:mean_count   = mean(count),
1761308057344:median_count = median(count)
1761308057344:), by = gene]
1761308057346:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene (in one pipeline) ----
1761308057346:per_condition_summary <- meta[counts, on = "sample_id"
1761308057346:][, .(mean_count = mean(count)), by = .(gene, condition)]
1761308057351:# ---- Output preview
1761308075240:############################################################
1761308075241:# task1_df.R — Filter, summarize, and group bulk counts
1761308075241:# Data: bulk_counts_long.csv, sample_metadata.csv
1761308075241:# Base R (data.frame) version — still using fread() for input
1761308075242:############################################################
1761308075242:suppressPackageStartupMessages(library(data.table))
1761308075244:# ---- Load data ----
1761308075244:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1761308075248:meta   <- as.data.frame(fread("~/workspace/sample_metadata.csv"))
1761308075249:# ---- Standardize column names ----
1761308075250:names(counts) <- tolower(trimws(names(counts)))
1761308075250:names(meta)   <- tolower(trimws(names(meta)))
1761308075251:# Expect:
1761308075251:# counts: gene, sample_id, count
1761308075251:# meta:   sample_id, condition
1761308075252:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1761308075253:filtered <- subset(counts, grepl("^GENE_00", gene))
1761308075259:# Join to get condition info
1761308075259:filtered <- merge(filtered, meta, by = "sample_id", all.x = TRUE)
1761308075267:filtered <- subset(filtered, condition == "treated")
1761308075268:# ---- 2️⃣ Compute mean and median count by gene ----
1761308075268:summary_gene <- aggregate(count ~ gene, data = filtered,
1761308075269:FUN = function(x) c(mean = mean(x), median = median(x)))
1761308075278:summary_gene <- data.frame(gene = summary_gene$gene, summary_gene$count)
1761308075279:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene ----
1761308075279:merged <- merge(counts, meta, by = "sample_id", all.x = TRUE)
1761308075306:per_condition_summary <- aggregate(count ~ gene + condition, data = merged, mean)
1761308075327:names(per_condition_summary)[names(per_condition_summary) == "count"] <- "mean_count"
1761308075328:# ---- Output preview ----
1761308075328:cat("\n✅ Summary of treated GENE_00 genes:\n")
1761308075328:print(head(summary_gene))
1761308075331:cat("\n✅ Per-condition mean counts by gene:\n")
1761308075331:print(head(per_condition_summary))
1761572114546:usethis::use_vignette("using_functionshelp")
1761572599878:devtools::load_all()
1761572825672:devtools::build_vignettes()
1761572875843:devtools::build_vignettes()
1761574012502:devtools::load_all()
1761574115937:source("R/Functionsdataframe.R")
1761574127728:dt <- task1_filter_counts()
1761574166529:source("R/Functionsdatatable.R")
1761574177635:dt <- task1_filter_counts()
1761574177675:df <- task1_df_filter_counts()
1761574177743:head(dt$summary_gene)
1761574177744:head(df$summary_gene)
1761574186243:View(df)
1761574195184:View(dt)
1761574636764:devtools::load_all()
1761574677256:source("R/Functionsdatatable.R")
1761574677268:source("R/Functionsdataframe.R")
1761574677275:dt <- task1_filter_counts()
1761574677324:df <- task1_df_filter_counts()
1761574677436:head(dt$summary_gene)
1761574677437:head(df$summary_gene)
1761575184154:devtools::loaded_all()
1761575191131:devtools::load_all()
1761575255279:devtools::load_all()
1761575279190:#' Task 1 (data.frame): Filter, summarize, and group bulk counts
1761575279190:#' @return A list with per-gene and per-condition summaries.
1761575279191:task1_df_filter_counts <- function() {
1761575279191:suppressPackageStartupMessages(library(data.table))
1761575279192:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1761575279192:meta   <- as.data.frame(fread("~/workspace/sample_metadata.csv"))
1761575279193:names(counts) <- tolower(trimws(names(counts)))
1761575279193:names(meta)   <- tolower(trimws(names(meta)))
1761575279194:# Filter and join (same as data.table logic)
1761575279194:filtered <- subset(counts, grepl("^GENE_00", gene))
1761575279194:filtered <- merge(meta, filtered, by = "sample_id", all.y = TRUE)
1761575279195:filtered <- subset(filtered, condition == "treated")
1761575279195:# Mean + median by gene
1761575279196:summary_gene <- aggregate(filtered$count,
1761575279196:by = list(gene = filtered$gene),
1761575279196:FUN = function(x) c(mean = mean(x), median = median(x)))
1761575279197:summary_gene <- data.frame(
1761575279197:gene = summary_gene$gene,
1761575279197:mean_count = summary_gene$x[, "mean"],
1761575279197:median_count = summary_gene$x[, "median"]
1761575279198:)
1761575279198:# Per-condition mean by gene
1761575279198:merged <- merge(filtered, meta, by = "sample_id", all.x = TRUE)
1761575279199:per_condition_summary <- aggregate(merged$count,
1761575279199:by = list(gene = merged$gene, condition = merged$condition),
1761575279200:FUN = mean)
1761575279201:names(per_condition_summary)[3] <- "mean_count"
1761575279202:# Return both outputs
1761575279202:list(
1761575279203:summary_gene = summary_gene,
1761575279203:per_condition_summary = per_condition_summary
1761575279204:)
1761575279204:}
1761575283071:View(task1_df_filter_counts)
1761575306059:source("R/Functionsdataframe.R")
1761575306069:source("R/Functionsdatatable.R")
1761575306074:dt <- task1_filter_counts()
1761575306124:df <- task1_df_filter_counts()
1761575395728:source("R/Functionsdataframe.R")
1761575395737:source("R/Functionsdatatable.R")
1761575395750:dt <- task1_filter_counts()
1761575395777:df <- task1_df_filter_counts()
1761575395850:head(dt$summary_gene)
1761575395853:head(df$summary_gene)
1761642114636:devtools::load_all()
1761642393156:suppressPackageStartupMessages({
1761642393157:library(microbenchmark)
1761642393158:library(dplyr)
1761642393158:library(tidyr)
1761642393159:})
1761642395850:# --- Auto-load all functions if not already available ---
1761642395851:if (!exists("task1_filter_counts")) {
1761642395851:if (file.exists("R/Functionsdatatable.R")) source("R/Functionsdatatable.R")
1761642395851:}
1761642396435:if (!exists("task1_df_filter_counts")) {
1761642396435:if (file.exists("R/Functionsdataframe.R")) source("R/Functionsdataframe.R")
1761642396436:}
1761642397015:# --- Helper: list available function names ---
1761642397016:dt_funcs <- ls(pattern = "^task[0-9]+_", envir = .GlobalEnv)
1761642397552:df_funcs <- grep("_df_", dt_funcs, value = TRUE)
1761642398125:# Match df and dt functions by task number
1761642398125:task_pairs <- tibble(
1761642398125:task_num = gsub("^task([0-9]+).*", "\\1", df_funcs),
1761642398126:df_fun = df_funcs
1761642398126:) %>%
1761642398127:mutate(dt_fun = paste0("task", task_num, "_",
1761642398127:gsub("task[0-9]+_df_", "", df_fun)))
1761642398830:# --- Run benchmark for each pair ---
1761642398831:benchmark_results <- list()
1761642399341:for (i in seq_len(nrow(task_pairs))) {
1761642399342:task_name <- paste0("task", task_pairs$task_num[i])
1761642399342:dt_fun_name <- task_pairs$dt_fun[i]
1761642399342:df_fun_name <- task_pairs$df_fun[i]
1761642399343:cat("\n⏱️ Running", task_name, "...\n")
1761642399344:if (!exists(dt_fun_name, mode = "function") ||
1761642399344:!exists(df_fun_name, mode = "function")) {
1761642399344:warning("⚠️ Skipping ", task_name, " — one of the functions not found.")
1761642399345:next
1761642399345:}
1761642399346:dt_fun <- get(dt_fun_name, mode = "function")
1761642399346:df_fun <- get(df_fun_name, mode = "function")
1761642399347:mb <- microbenchmark(
1761642399347:data.table = { suppressMessages(dt_fun()) },
1761642399348:data.frame = { suppressMessages(df_fun()) },
1761642399348:times = 3L
1761642399349:)
1761642399350:benchmark_results[[task_name]] <- data.frame(
1761642399350:task   = task_name,
1761642399351:method = c("data.table", "data.frame"),
1761642399351:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761642399352:)
1761642399352:}
1761642400527:# --- Combine all results ---
1761642400527:if (length(benchmark_results) == 0) {
1761642400528:cat("\n⚠️ No benchmarks could be run — check that your functions are defined.\n")
1761642400528:} else
1761642401179:# ---- Combine results ----
1761642401179:benchmark_summary <- do.call(rbind, benchmark_results)
1761642401915:row.names(benchmark_summary) <- NULL
1761642437179:############################################################
1761642437180:# benchmark_tasks.R
1761642437180:# Compare data.table vs data.frame functions (Tasks 1–12)
1761642437181:############################################################
1761642437181:############################################################
1761642437182:# Works automatically whether functions are in package or global env
1761642437182:############################################################
1761642437183:suppressPackageStartupMessages({
1761642437183:library(microbenchmark)
1761642437184:library(dplyr)
1761642437184:library(tidyr)
1761642437185:})
1761642437186:# --- Auto-load all functions if not already available ---
1761642437186:if (!exists("task1_filter_counts")) {
1761642437187:if (file.exists("R/Functionsdatatable.R")) source("R/Functionsdatatable.R")
1761642437187:}
1761642437187:if (!exists("task1_df_filter_counts")) {
1761642437188:if (file.exists("R/Functionsdataframe.R")) source("R/Functionsdataframe.R")
1761642437188:}
1761642437189:# --- Helper: list available function names ---
1761642437189:dt_funcs <- ls(pattern = "^task[0-9]+_", envir = .GlobalEnv)
1761642437190:df_funcs <- grep("_df_", dt_funcs, value = TRUE)
1761642437191:# Match df and dt functions by task number
1761642437191:task_pairs <- tibble(
1761642437191:task_num = gsub("^task([0-9]+).*", "\\1", df_funcs),
1761642437192:df_fun = df_funcs
1761642437192:) %>%
1761642437193:mutate(dt_fun = paste0("task", task_num, "_",
1761642437193:gsub("task[0-9]+_df_", "", df_fun)))
1761642437197:# --- Run benchmark for each pair ---
1761642437198:benchmark_results <- list()
1761642437198:for (i in seq_len(nrow(task_pairs))) {
1761642437199:task_name <- paste0("task", task_pairs$task_num[i])
1761642437199:dt_fun_name <- task_pairs$dt_fun[i]
1761642437199:df_fun_name <- task_pairs$df_fun[i]
1761642437200:cat("\n⏱️ Running", task_name, "...\n")
1761642437200:if (!exists(dt_fun_name, mode = "function") ||
1761642437201:!exists(df_fun_name, mode = "function")) {
1761642437201:warning("⚠️ Skipping ", task_name, " — one of the functions not found.")
1761642437201:next
1761642437202:}
1761642437202:dt_fun <- get(dt_fun_name, mode = "function")
1761642437202:df_fun <- get(df_fun_name, mode = "function")
1761642437203:mb <- microbenchmark(
1761642437203:data.table = { suppressMessages(dt_fun()) },
1761642437203:data.frame = { suppressMessages(df_fun()) },
1761642437204:times = 3L
1761642437204:)
1761642437204:benchmark_results[[task_name]] <- data.frame(
1761642437205:task   = task_name,
1761642437205:method = c("data.table", "data.frame"),
1761642437205:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761642437206:)
1761642437206:}
1761642437218:# --- Combine all results ---
1761642437218:if (length(benchmark_results) == 0) {
1761642437218:cat("\n⚠️ No benchmarks could be run — check that your functions are defined.\n")
1761642437219:} else
1761642437219:# ---- Combine results ----
1761642437219:benchmark_summary <- do.call(rbind, benchmark_results)
1761642437220:row.names(benchmark_summary) <- NULL
1761642450480:devtools::load_all()
1761642452959:############################################################
1761642452960:# benchmark_tasks.R
1761642452960:# Compare data.table vs data.frame functions (Tasks 1–12)
1761642452960:############################################################
1761642452961:############################################################
1761642452961:# Works automatically whether functions are in package or global env
1761642452961:############################################################
1761642452961:suppressPackageStartupMessages({
1761642452962:library(microbenchmark)
1761642452962:library(dplyr)
1761642452962:library(tidyr)
1761642452962:})
1761642452963:# --- Auto-load all functions if not already available ---
1761642452963:if (!exists("task1_filter_counts")) {
1761642452963:if (file.exists("R/Functionsdatatable.R")) source("R/Functionsdatatable.R")
1761642452963:}
1761642452964:if (!exists("task1_df_filter_counts")) {
1761642452964:if (file.exists("R/Functionsdataframe.R")) source("R/Functionsdataframe.R")
1761642452964:}
1761642452964:# --- Helper: list available function names ---
1761642452965:dt_funcs <- ls(pattern = "^task[0-9]+_", envir = .GlobalEnv)
1761642452965:df_funcs <- grep("_df_", dt_funcs, value = TRUE)
1761642452965:# Match df and dt functions by task number
1761642452965:task_pairs <- tibble(
1761642452966:task_num = gsub("^task([0-9]+).*", "\\1", df_funcs),
1761642452966:df_fun = df_funcs
1761642452966:) %>%
1761642452966:mutate(dt_fun = paste0("task", task_num, "_",
1761642452966:gsub("task[0-9]+_df_", "", df_fun)))
1761642452969:# --- Run benchmark for each pair ---
1761642452969:benchmark_results <- list()
1761642452969:for (i in seq_len(nrow(task_pairs))) {
1761642452970:task_name <- paste0("task", task_pairs$task_num[i])
1761642452970:dt_fun_name <- task_pairs$dt_fun[i]
1761642452970:df_fun_name <- task_pairs$df_fun[i]
1761642452970:cat("\n⏱️ Running", task_name, "...\n")
1761642452971:if (!exists(dt_fun_name, mode = "function") ||
1761642452971:!exists(df_fun_name, mode = "function")) {
1761642452971:warning("⚠️ Skipping ", task_name, " — one of the functions not found.")
1761642452971:next
1761642452972:}
1761642452972:dt_fun <- get(dt_fun_name, mode = "function")
1761642452972:df_fun <- get(df_fun_name, mode = "function")
1761642452973:mb <- microbenchmark(
1761642452973:data.table = { suppressMessages(dt_fun()) },
1761642452973:data.frame = { suppressMessages(df_fun()) },
1761642452973:times = 3L
1761642452973:)
1761642452974:benchmark_results[[task_name]] <- data.frame(
1761642452974:task   = task_name,
1761642452974:method = c("data.table", "data.frame"),
1761642452975:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761642452975:)
1761642452975:}
1761642452987:# --- Combine all results ---
1761642452988:if (length(benchmark_results) == 0) {
1761642452988:cat("\n⚠️ No benchmarks could be run — check that your functions are defined.\n")
1761642452988:} else
1761642452988:# ---- Combine results ----
1761642452989:benchmark_summary <- do.call(rbind, benchmark_results)
1761642452989:row.names(benchmark_summary) <- NULL
1761642480233:suppressPackageStartupMessages({
1761642480234:library(microbenchmark)
1761642480235:library(dplyr)
1761642480235:library(tidyr)
1761642480236:})
1761642480633:# --- Auto-load all functions if not already available ---
1761642480633:if (!exists("task1_filter_counts")) {
1761642480634:if (file.exists("R/Functionsdatatable.R")) source("R/Functionsdatatable.R")
1761642480634:}
1761642481081:if (!exists("task1_df_filter_counts")) {
1761642481082:if (file.exists("R/Functionsdataframe.R")) source("R/Functionsdataframe.R")
1761642481082:}
1761642481465:# --- Helper: list available function names ---
1761642481465:dt_funcs <- ls(pattern = "^task[0-9]+_", envir = .GlobalEnv)
1761642481849:df_funcs <- grep("_df_", dt_funcs, value = TRUE)
1761642482266:# Match df and dt functions by task number
1761642482267:task_pairs <- tibble(
1761642482267:task_num = gsub("^task([0-9]+).*", "\\1", df_funcs),
1761642482268:df_fun = df_funcs
1761642482268:) %>%
1761642482269:mutate(dt_fun = paste0("task", task_num, "_",
1761642482270:gsub("task[0-9]+_df_", "", df_fun)))
1761642482664:# --- Run benchmark for each pair ---
1761642482664:benchmark_results <- list()
1761642483232:for (i in seq_len(nrow(task_pairs))) {
1761642483233:task_name <- paste0("task", task_pairs$task_num[i])
1761642483233:dt_fun_name <- task_pairs$dt_fun[i]
1761642483233:df_fun_name <- task_pairs$df_fun[i]
1761642483234:cat("\n⏱️ Running", task_name, "...\n")
1761642483234:if (!exists(dt_fun_name, mode = "function") ||
1761642483235:!exists(df_fun_name, mode = "function")) {
1761642483235:warning("⚠️ Skipping ", task_name, " — one of the functions not found.")
1761642483236:next
1761642483236:}
1761642483237:dt_fun <- get(dt_fun_name, mode = "function")
1761642483237:df_fun <- get(df_fun_name, mode = "function")
1761642483238:mb <- microbenchmark(
1761642483238:data.table = { suppressMessages(dt_fun()) },
1761642483239:data.frame = { suppressMessages(df_fun()) },
1761642483239:times = 3L
1761642483240:)
1761642483240:benchmark_results[[task_name]] <- data.frame(
1761642483241:task   = task_name,
1761642483241:method = c("data.table", "data.frame"),
1761642483242:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1761642483242:)
1761642483242:}
1761642483816:# --- Combine all results ---
1761642483818:if (length(benchmark_results) == 0) {
1761642483819:cat("\n⚠️ No benchmarks could be run — check that your functions are defined.\n")
1761642483820:} else
1761642484546:# ---- Combine results ----
1761642484547:benchmark_summary <- do.call(rbind, benchmark_results)
1761642485048:row.names(benchmark_summary) <- NULL
1761642485518:# ---- Compute speed ratio ----
1761642485519:library(dplyr)
1761642485948:library(tidyr)
1761642495952:View(benchmark_results)
1761642497848:View(task_pairs)
1761642999416:# ---- Combine results ----
1761642999417:benchmark_summary <- do.call(rbind, benchmark_results)
1761643025138:devtools::load_all()
1761643045690:source("~/benchmark_tasks.R")
1761643108046:source("~/functionshelp/R/Functionsdataframe.R")
1761643113545:source("~/functionshelp/R/Functionsdatatable.R")
1761643118593:source("~/benchmark_tasks.R")
1761643142663:# ---- Optional: Plot automatically ----
1761643142664:library(ggplot2)
1761643144111:ggplot(benchmark_summary, aes(x = reorder(task, speed_ratio), y = speed_ratio)) +
1761643144112:geom_col(fill = "steelblue") +
1761643144112:coord_flip() +
1761643144113:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1761643144113:labs(
1761643144113:title = "Speed Comparison: data.frame vs data.table",
1761643144114:x = "Task",
1761643144114:y = "Speed ratio (data.frame / data.table)"
1761643144114:) +
1761643144115:theme_minimal(base_size = 13)
1761643927473:devtools::load_all()
1761644018036:source(~/benchmark_tasks_function.R)
1761644033370:source("~/benchmark_tasks_function.R")
1761644064010:source("~/bechmark_tasks_function.R")
1761644179431:file.exists("R/benchmark_function.R")
1761644190827:file.exists("benchmark_function.R")
1761644231812:file.exists("benchmark_function.R")
1761644245273:devtools::load_all()
1761644264046:rm(list = c("task1_filter_counts", "task10_map_peaks_to_genes", "task11_map_snps",
1761644264048:"task12_combine_cohorts", "task2_add_qc_flags", "task3_join_and_index",
1761644264048:"task4_annotate_counts", "task5_classify_labs", "task6_match_labs_vitals",
1761644264049:"task7_filter_genomic_peaks", "task8_summarize_gene_stats", "task9_reshape_counts"))` to
1761644264049:remove the conflicts
1761644275404:source("~/bechmark_function.R")
1761644318938:file.exists("~/benchmark_function.R")
1761644333232:file.exists("benchmark_function.R")
1761644614137:source("~/bechmark_function.R")
1761644675947:file.exists("benchmark_function.R")
1761644687412:file.exists("benchmark_function.R")
1761644695090:source("~/bechmark_function.R")
1761644701660:file.exists("benchmark_function.R")
1761644814423:file.exists("benchmark_function.R")
1761644825201:source("~/benchmark_function.R")
1761644837304:file.exists("/home/benchmark_function.R")
1761649440913:source("~/functionshelp/R/finaltask_function_df.R")
1761649444092:source("~/functionshelp/R/finaltask_function_dt.R")
1761650103298:show_preview(final_task_df())
1761650133185:source(final_task_df())
1761734061348:source("~/Task1.R")
1761734079157:source("~/Task1dataframe.R")
1761820113558:usethis::use_vignette("data_table_workflow")
1761820948309:usethis::use_vignette("workflow")
1761821078518:devtools::build_vignettes()
1761821115707:browseVignettes("functionshelp")
1762093325139:source("~/benchmark_tasks.R")
1762093338037:View(benchmark_results)
1762093338160:View(benchmark_results)
1762093349921:source("~/benchmark_function.R")
1762093357733:source("~/benchmark_function.R")
1762093368904:run_benchmarks <- function(dt_file = "R/Functionsdatatable.R",
1762093368904:df_file = "R/Functionsdataframe.R",
1762093368904:times = 3L,
1762093368905:plot = TRUE) {
1762093368905:suppressPackageStartupMessages({
1762093368905:library(microbenchmark)
1762093368906:library(dplyr)
1762093368906:library(tidyr)
1762093368907:library(ggplot2)
1762093368907:})
1762093368908:# --- Load functions if not already available ---
1762093368908:if (!exists("task1_filter_counts") && file.exists(dt_file)) source(dt_file)
1762093368908:if (!exists("task1_df_filter_counts") && file.exists(df_file)) source(df_file)
1762093368909:# --- Identify all functions ---
1762093368909:all_funcs <- ls(pattern = "^task[0-9]+_", envir = .GlobalEnv)
1762093368909:df_funcs <- grep("_df_", all_funcs, value = TRUE)
1762093368910:task_pairs <- tibble(
1762093368910:task_num = gsub("^task([0-9]+).*", "\\1", df_funcs),
1762093368911:df_fun = df_funcs
1762093368911:) %>%
1762093368911:mutate(dt_fun = paste0("task", task_num, "_",
1762093368912:gsub("task[0-9]+_df_", "", df_fun)))
1762093368912:benchmark_results <- list()
1762093368913:# --- Run benchmarks ---
1762093368913:for (i in seq_len(nrow(task_pairs))) {
1762093368913:task_name <- paste0("task", task_pairs$task_num[i])
1762093368914:dt_fun_name <- task_pairs$dt_fun[i]
1762093368914:df_fun_name <- task_pairs$df_fun[i]
1762093368915:cat("\n⏱️ Running", task_name, "...\n")
1762093368916:if (!exists(dt_fun_name, mode = "function") ||
1762093368916:!exists(df_fun_name, mode = "function")) {
1762093368917:warning("⚠️ Skipping ", task_name, " — one of the functions not found.")
1762093368917:next
1762093368918:}
1762093368918:dt_fun <- get(dt_fun_name, mode = "function")
1762093368919:df_fun <- get(df_fun_name, mode = "function")
1762093368919:mb <- microbenchmark(
1762093368920:data.table = { suppressMessages(dt_fun()) },
1762093368920:data.frame = { suppressMessages(df_fun()) },
1762093368921:times = times
1762093368921:)
1762093368922:benchmark_results[[task_name]] <- data.frame(
1762093368922:task   = task_name,
1762093368922:method = c("data.table", "data.frame"),
1762093368923:mean_ms = tapply(mb$time / 1e6, mb$expr, mean)
1762093368923:)
1762093368923:}
1762093368924:# --- Combine results ---
1762093368924:if (length(benchmark_results) == 0) {
1762093368925:stop("No benchmarks could be run — check that your functions are defined.")
1762093368925:}
1762093368926:benchmark_summary <- do.call(rbind, benchmark_results)
1762093368926:row.names(benchmark_summary) <- NULL
1762093368927:# --- Compute speed ratio ---
1762093368927:benchmark_summary <- benchmark_summary %>%
1762093368928:tidyr::pivot_wider(names_from = method, values_from = mean_ms) %>%
1762093368928:dplyr::mutate(speed_ratio = data.frame / data.table)
1762093368929:cat("\n✅ Benchmark Summary (mean time in ms):\n")
1762093368929:print(benchmark_summary[, c("task", "data.table", "data.frame", "speed_ratio")])
1762093368930:# --- Optional plot ---
1762093368930:if (plot) {
1762093368930:p <- ggplot(benchmark_summary,
1762093368931:aes(x = reorder(task, speed_ratio), y = speed_ratio)) +
1762093368931:geom_col(fill = "steelblue") +
1762093368931:coord_flip() +
1762093368932:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1762093368932:labs(
1762093368932:title = "Speed Comparison: data.frame vs data.table",
1762093368933:x = "Task",
1762093368933:y = "Speed ratio (data.frame / data.table)"
1762093368933:) +
1762093368934:theme_minimal(base_size = 13)
1762093368934:print(p)
1762093368934:}
1762093368935:return(benchmark_summary)
1762093368935:}
1762093379318:View(benchmark_summary)
1762093382582:View(benchmark_results)
1762093400572:# ---- Optional: Plot automatically ----
1762093400573:library(ggplot2)
1762093401252:ggplot(benchmark_summary, aes(x = reorder(task, speed_ratio), y = speed_ratio)) +
1762093401253:geom_col(fill = "steelblue") +
1762093401254:coord_flip() +
1762093401254:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1762093401255:labs(
1762093401255:title = "Speed Comparison: data.frame vs data.table",
1762093401255:x = "Task",
1762093401256:y = "Speed ratio (data.frame / data.table)"
1762093401256:) +
1762093401256:theme_minimal(base_size = 13)
1762095347342:#' Task 11 — Map variants to genes
1762095347342:#' @return List of variant counts and genes with high-impact variants.
1762095347343:#' @export
1762095347343:task11_map_snps <- function() {
1762095347344:suppressPackageStartupMessages(library(data.table))
1762095347344:variants <- fread("~/workspace/variants.csv")
1762095347344:genes    <- fread("~/workspace/gene_annotation.bed.csv")
1762095347345:setnames(variants, tolower(trimws(names(variants))))
1762095347345:setnames(genes, tolower(trimws(names(genes))))
1762095347345:variants[, start := pos]
1762095347346:variants[, end := pos]
1762095347346:setkey(variants, chr, start, end)
1762095347346:setkey(genes, chr, start, end)
1762095347347:overlaps <- foverlaps(variants, genes, by.x = c("chr", "start", "end"),
1762095347347:by.y = c("chr", "start", "end"), type = "any", nomatch = 0L)
1762095347347:high_imp <- overlaps[tolower(impact) == "high"]
1762095347348:counts_gene_sample <- high_imp[, .N, by = .(gene, sample_id)]
1762095347348:setnames(counts_gene_sample, "N", "high_variant_count")
1762095347348:samples_with_high <- unique(high_imp[, .(gene, sample_id)])
1762095347349:gene_sample_counts <- samples_with_high[, .N, by = gene]
1762095347349:total_samples <- uniqueN(variants$sample_id)
1762095347349:genes_all_samples <- gene_sample_counts[N == total_samples, gene]
1762095347350:return(list(counts = counts_gene_sample, all_samples = genes_all_samples))
1762095347350:}
1762095351559:View(task11_map_snps)
1762095354808:View(task11_map_snps)
1762095372568:suppressPackageStartupMessages(library(data.table))
1762095373042:# ---- Load data ----
1762095373042:variants <- fread("~/workspace/variants.csv")
1762095374356:genes    <- fread("~/workspace/gene_annotation.bed.csv")
1762095374825:# ---- Standardize column names ----
1762095374826:setnames(variants, tolower(trimws(names(variants))))
1762095375290:setnames(genes,    tolower(trimws(names(genes))))
1762095376042:# ---- Convert variant positions to 1-bp intervals ----
1762095376043:variants[, start := pos]
1762095376572:variants[, end   := pos]
1762095377217:# ---- Set keys for overlap join ----
1762095377217:setkey(variants, chr, start, end)
1762095377719:setkey(genes,    chr, start, end)
1762095378156:# ---- Find overlaps (which gene each variant falls in) ----
1762095378156:overlaps <- foverlaps(
1762095378157:variants,
1762095378157:genes,
1762095378158:by.x = c("chr", "start", "end"),
1762095378159:by.y = c("chr", "start", "end"),
1762095378159:type = "any",
1762095378159:nomatch = 0L
1762095378160:)
1762095378805:# ---- Filter for HIGH-impact variants ----
1762095378806:high_imp <- overlaps[tolower(impact) == "high"]
1762095379427:# ---- Count HIGH variants by gene and sample ----
1762095379429:counts_gene_sample <- high_imp[, .N, by = .(gene, sample_id)]
1762095379975:setnames(counts_gene_sample, "N", "high_variant_count")
1762095380441:# ---- Summarize genes with HIGH-impact variants in all samples ----
1762095380442:samples_with_high <- unique(high_imp[, .(gene, sample_id)])
1762095380993:gene_sample_counts <- samples_with_high[, .N, by = gene]
1762095381543:total_samples <- uniqueN(variants$sample_id)
1762095382075:genes_all_samples <- gene_sample_counts[N == total_samples, gene]
1762095383592:# ---- Output ----
1762095383593:cat("✅ Count of HIGH-impact variants by gene and sample:\n")
1762095385073:print(head(counts_gene_sample))
1762095385591:cat("\n✅ Genes with HIGH-impact variants in all samples:\n")
1762096161860:suppressPackageStartupMessages(library(data.table))
1762096163294:#
1762096164695:# ---- Load data ----
1762096164695:counts <- fread("~/workspace/bulk_counts_long.csv")
1762096166427:meta   <- fread("~/workspace/sample_metadata.csv")
1762096167660:# ---- Standardize column names ----
1762096167661:setnames(counts, tolower(trimws(names(counts))))
1762096168860:setnames(meta,   tolower(trimws(names(meta))))
1762096169711:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1762096169711:filtered <- counts[grepl("^GENE_00", gene)]
1762096178583:source("~/Task1.R")
1762096180991:source("~/Task1.R")
1762096225223:suppressPackageStartupMessages(library(data.table))
1762096225744:# ---- Load data ----
1762096225746:counts <- fread("~/workspace/bulk_counts_long.csv")
1762096226210:meta   <- fread("~/workspace/sample_metadata.csv")
1762096226642:# ---- Standardize column names ----
1762096226642:setnames(counts, tolower(trimws(names(counts))))
1762096227094:setnames(meta,   tolower(trimws(names(meta))))
1762096227610:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1762096227610:filtered <- counts[grepl("^GENE_00", gene)]
1762096228253:# Join to get condition info
1762096228253:setkey(meta, sample_id)
1762096228793:filtered <- meta[filtered, on = "sample_id"]
1762096229377:filtered <- filtered[condition == "treated"]
1762096229943:# ---- 2️⃣ Compute mean and median count by gene ----
1762096229944:summary_gene <- filtered[, .(
1762096229944:mean_count   = mean(count),
1762096229945:median_count = median(count)
1762096229945:), by = gene]
1762096230778:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene (in one pipeline) ----
1762096230780:per_condition_summary <- meta[counts, on = "sample_id"
1762096230780:][, .(mean_count = mean(count)), by = .(gene, condition)]
1762096261065:View(per_condition_summary)
1762096276960:View(summary_gene)
1762096290394:View(filtered)
1762096496561:source("~/Task11.R")
1762096535294:source("~/Task1.R")
1762097063851:devtools::load_all()
1762097072260:devtools::install()
1762098496158:devtools::load_all()
1762098708811:source("~/benchmark_tasks.R")
1762098777718:file.exists("/home/rstudio/benchmark_tasks.R")
1762098885970:View(benchmark_summary)
1762099074600:View(benchmark_summary)
1762099214147:source("~/benchmark_tasks.R")
1762099231009:# ---- Optional: Plot automatically ----
1762099231009:library(ggplot2)
1762099231454:ggplot(benchmark_summary, aes(x = reorder(task, speed_ratio), y = speed_ratio)) +
1762099231455:geom_col(fill = "steelblue") +
1762099231455:coord_flip() +
1762099231455:geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
1762099231456:labs(
1762099231456:title = "Speed Comparison: data.frame vs data.table",
1762099231456:x = "Task",
1762099231457:y = "Speed ratio (data.frame / data.table)"
1762099231457:) +
1762099231457:theme_minimal(base_size = 13)
1762099329672:# ---- Combine results ----
1762099329673:benchmark_summary <- do.call(rbind, benchmark_results)
1762099330554:row.names(benchmark_summary) <- NULL
1762099335056:# ---- Compute speed ratio ----
1762099335057:library(dplyr)
1762099336320:library(tidyr)
1762099336719:# Pivot wide to have both methods in separate columns
1762099336720:benchmark_summary <- benchmark_summary |>
1762099336720:tidyr::pivot_wider(names_from = method, values_from = mean_ms) |>
1762099336721:dplyr::mutate(speed_ratio = data.frame / data.table)
1762099343971:print(benchmark_summary[, c("task", "data.table", "data.frame", "speed_ratio")])
1762099565327:source("~/benchmark_tasks.R")
1762099572935:View(benchmark_results)
1762099600869:View(benchmark_summary)
1762099819157:?source
1762099888099:source("../../benchmark_tasks.R")
1762099933993:wd()
1762099938316:??wd
1762099980822:source("benchmark_tasks.R")
1762100010166:getwd()
1762100026651:source(../"benchmark_tasks.R")
1762100036076:source("../benchmark_tasks.R")
1762100096302:bench <- benchmark_results()
1762100105789:View(benchmark_results)
1762100151164:View(benchmark_summary)
1762100199057:View(benchmark_summary)
1762100229948:View(benchmark_summary)
1762100311234:### Benchmark — data.table vs data.frame
1762100311235:source("../../benchmark_tasks.R")
1762100375850:getwd()
1762101417247:# ---- Load data ----
1762101417247:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762101421017:nt_cluster  <- fread("~/workspace/nt_combined_clustering.output.csv")
1762101422323:# ---- Standardize column names ----
1762101422324:setnames(integration, tolower(trimws(names(integration))))
1762101423147:setnames(nt_cluster,  tolower(trimws(names(nt_cluster))))
1762101424541:View(integration)
1762101425291:View(nt_cluster)
1762101458114:# ---- Merge ----
1762101458115:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1762101460018:View(merged)
1762268799028:source("~/functionshelp/R/finaltask_function_dt.R")
1762268800890:View(final_task_dt)
1762268802290:View(final_task_dt)
1762268811846:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762268811847:#'
1762268811847:#' This function merges Seurat integration results with cell type annotations
1762268811848:#' and summarizes the number and proportion of cells of each type
1762268811848:#' per integration cluster and tissue type (Normal/Tumor).
1762268811849:#'
1762268811850:#' @return data.table with columns:
1762268811851:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762268811851:#' @export
1762268811851:final_task_dt <- function() {
1762268811852:suppressPackageStartupMessages(library(data.table))
1762268811853:# ---- Load data ----
1762268811853:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762268811853:nt_cluster  <- fread("~/workspace/nt_combined_clustering.output.csv")
1762268811854:# ---- Standardize column names ----
1762268811854:setnames(integration, tolower(trimws(names(integration))))
1762268811855:setnames(nt_cluster,  tolower(trimws(names(nt_cluster))))
1762268811855:# ---- Detect the cell ID column ----
1762268811856:cell_col <- intersect(names(integration), names(nt_cluster))[1]
1762268811856:if (is.na(cell_col)) stop("❌ No matching cell ID column found between files.")
1762268811857:message("✅ Matching by cell column: ", cell_col)
1762268811857:# ---- Merge ----
1762268811858:merged <- merge(integration, nt_cluster, by = cell_col, all.x = TRUE)
1762268811858:# Rename typical metadata columns if needed
1762268811858:if ("orig.ident" %in% names(merged) && !"sample_type" %in% names(merged))
1762268811858:setnames(merged, "orig.ident", "sample_type")
1762268811859:if ("predicted_celltype" %in% names(merged) && !"cell_type" %in% names(merged))
1762268811859:setnames(merged, "predicted_celltype", "cell_type")
1762268811860:# ---- Summarize ----
1762268811860:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762268811860:setnames(summary_counts, "N", "n_cells")
1762268811860:# ---- Proportions ----
1762268811860:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762268811861:# ---- Sort ----
1762268811861:setorder(summary_counts, integration_cluster, -n_cells)
1762268811862:return(summary_counts)
1762268811862:}
1762268833190:source("R/Functionsdatatable.R")
1762268833199:res <- final_task_dt()
1762268833258:head(res)
1762268895160:source("R/Functionsdatatable.R")
1762268909009:res <- final_task_dt()
1762268913949:head(res)
1762268928012:source("~/functionshelp/R/finaltask_function_dt.R")
1762268978179:source("~/functionshelp/R/finaltask_function_dt.R")
1762268982892:View(res)
1762269159849:source("~/functionshelp/R/finaltask_function_dt.R")
1762269161554:View(res)
1762269166758:# ---- Standardize column names ----
1762269166759:setnames(integration, tolower(trimws(names(integration))))
1762269167504:setnames(nt_cluster,  tolower(trimws(names(nt_cluster))))
1762269171491:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762269171491:#'
1762269171491:#' This function merges Seurat integration results with cell type annotations
1762269171492:#' and summarizes the number and proportion of cells of each type
1762269171492:#' per integration cluster and tissue type (Normal/Tumor).
1762269171492:#'
1762269171493:#' @return data.table with columns:
1762269171493:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762269171494:#' @export
1762269171494:final_task_dt <- function() {
1762269171495:suppressPackageStartupMessages(library(data.table))
1762269171495:# ---- Load data ----
1762269171496:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762269171496:nt_cluster  <- fread("~/workspace/nt_combined_clustering.output.csv")
1762269171497:# ---- Standardize column names ----
1762269171497:setnames(integration, tolower(trimws(names(integration))))
1762269171497:setnames(nt_cluster,  tolower(trimws(names(nt_cluster))))
1762269171498:print(names(integration))
1762269171498:print(names(nt_cluster))
1762269171499:# ---- Detect the cell ID column ----
1762269171499:cell_col <- intersect(names(integration), names(nt_cluster))[1]
1762269171500:if (is.na(cell_col)) stop("❌ No matching cell ID column found between files.")
1762269171501:message("✅ Matching by cell column: ", cell_col)
1762269171501:# ---- Merge ----
1762269171502:merged <- merge(integration, nt_cluster, by = cell_col, all.x = TRUE)
1762269171502:# Rename typical metadata columns if needed
1762269171503:if ("orig.ident" %in% names(merged) && !"sample_type" %in% names(merged))
1762269171503:setnames(merged, "orig.ident", "sample_type")
1762269171503:if ("predicted_celltype" %in% names(merged) && !"cell_type" %in% names(merged))
1762269171504:setnames(merged, "predicted_celltype", "cell_type")
1762269171504:# ---- Summarize ----
1762269171504:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762269171505:setnames(summary_counts, "N", "n_cells")
1762269171505:# ---- Proportions ----
1762269171505:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762269171506:# ---- Sort ----
1762269171506:setorder(summary_counts, integration_cluster, -n_cells)
1762269171506:return(summary_counts)
1762269171507:}
1762269173954:View(res)
1762269297500:source("~/functionshelp/R/finaltask_function_dt.R")
1762269325358:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762269325359:#'
1762269325359:#' This function merges Seurat integration results with cell type annotations
1762269325360:#' and summarizes the number and proportion of cells of each type
1762269325360:#' per integration cluster and tissue type (Normal/Tumor).
1762269325360:#'
1762269325361:#' @return data.table with columns:
1762269325361:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762269325361:#' @export
1762269325362:final_task_dt <- function()
1762269325362:{
1762269325362:suppressPackageStartupMessages(library(data.table))
1762269325363:# ---- Load data ----
1762269325364:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762269325366:nt_cluster <- fread("~/workspace/nt_combined_clustering.output.csv")
1762269325367:# ---- Standardize column names ----
1762269325368:setnames(integration, tolower(trimws(names(integration))))
1762269325368:setnames(nt_cluster, tolower(trimws(names(nt_cluster))))
1762269325369:print(names(integration))
1762269325369:print(names(nt_cluster))
1762269325369:# ---- Merge ----
1762269325370:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1762269325370:# ---- Summarize counts ----
1762269325371:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762269325371:setnames(summary_counts, "N", "n_cells")
1762269325371:# ---- Add proportions per cluster ----
1762269325372:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762269325372:# ---- Sort for readability ----
1762269325373:setorder(summary_counts, integration_cluster, -n_cells)
1762269325373:return(summary_counts)
1762269325373:}
1762269476014:source("~/functionshelp/R/finaltask_function_dt.R")
1762269598211:rm(list = ls())
1762269598214:source("~/functionshelp/R/finaltask_function_dt.R")
1762269598220:library(data.table)
1762269598321:print("Integration Columns:")
1762269598321:print(names(integration))
1762269683208:View(final_task_dt)
1762270165672:rm(list = ls())
1762270165674:source("~/functionshelp/R/finaltask_function_dt.R")
1762270165677:final_task_dt()
1762270369003:res <- final_task_dt()
1762270369022:head(res, 10)
1762270381630:View(final_task_dt)
1762270450198:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762270450199:#'
1762270450199:#' This function merges Seurat integration results with cell type annotations
1762270450199:#' and summarizes the number and proportion of cells of each type
1762270450200:#' per integration cluster and tissue type (Normal/Tumor).
1762270450200:#'
1762270450200:#' @return data.table with columns:
1762270450201:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762270450201:#' @export
1762270450201:final_task_dt <- function()
1762270450202:{
1762270450202:suppressPackageStartupMessages(library(data.table))
1762270450203:# ---- Load data ----
1762270450203:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762270450203:nt_cluster <- fread("~/workspace/nt_combined_clustering.output.csv")
1762270450204:# ---- Standardize column names ----
1762270450204:setnames(integration, tolower(trimws(names(integration))))
1762270450205:setnames(nt_cluster, tolower(trimws(names(nt_cluster))))
1762270450205:# ---- Debug Print ----
1762270450206:#print("Integration Columns:")
1762270450206:#print(names(integration))
1762270450206:#print("NT Cluster Columns:")
1762270450207:#print(names(nt_cluster))
1762270450207:#return(invisible(NULL))
1762270450208:# ---- Merge ----
1762270450208:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1762270450209:# ---- Summarize counts ----
1762270450209:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762270450209:setnames(summary_counts, "N", "n_cells")
1762270450210:# ---- Add proportions per cluster ----
1762270450211:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762270450211:# ---- Sort for readability ----
1762270450212:setorder(summary_counts, integration_cluster, -n_cells)
1762270450212:return(summary_counts)
1762270450213:}
1762270470071:view(summary_counts)
1762271824571:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762271824572:#'
1762271824572:#' This function merges Seurat integration results with cell type annotations
1762271824573:#' and summarizes the number and proportion of cells of each type
1762271824573:#' per integration cluster and tissue type (Normal/Tumor).
1762271824574:#'
1762271824574:#' @return data.table with columns:
1762271824574:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762271824575:#' @export
1762271824575:final_task_dt <- function()
1762271824576:{
1762271824576:suppressPackageStartupMessages(library(data.table))
1762271824576:# ---- Load data ----
1762271824577:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762271824577:nt_cluster <- fread("~/workspace/nt_combined_clustering.output.csv")
1762271824578:# ---- Standardize column names ----
1762271824578:setnames(integration, tolower(trimws(names(integration))))
1762271824578:setnames(nt_cluster, tolower(trimws(names(nt_cluster))))
1762271824579:# ---- Debug Print ----
1762271824579:#print("Integration Columns:")
1762271824579:#print(names(integration))
1762271824580:#print("NT Cluster Columns:")
1762271824581:#print(names(nt_cluster))
1762271824581:#return(invisible(NULL))
1762271824582:# ---- Merge ----
1762271824582:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1762271824583:# ---- Summarize counts ----
1762271824584:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762271824584:setnames(summary_counts, "N", "n_cells")
1762271824585:# ---- Add proportions per cluster ----
1762271824585:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762271824586:# ---- Sort for readability ----
1762271824587:setorder(summary_counts, integration_cluster, -n_cells)
1762271824587:return(summary_counts)
1762271824588:}
1762271974756:source("~/functionshelp/R/finaltask_function_dt.R")
1762271981253:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762271981254:#'
1762271981254:#' This function merges Seurat integration results with cell type annotations
1762271981255:#' and summarizes the number and proportion of cells of each type
1762271981255:#' per integration cluster and tissue type (Normal/Tumor).
1762271981256:#'
1762271981256:#' @return data.table with columns:
1762271981257:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762271981257:#' @export
1762271981257:final_task_dt <- function()
1762271981258:{
1762271981258:suppressPackageStartupMessages(library(data.table))
1762271981259:# ---- Load data ----
1762271981259:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762271981259:nt_cluster <- fread("~/workspace/nt_combined_clustering.output.csv")
1762271981260:# ---- Standardize column names ----
1762271981260:setnames(integration, tolower(trimws(names(integration))))
1762271981261:setnames(nt_cluster, tolower(trimws(names(nt_cluster))))
1762271981261:# ---- Remove possible sample prefixes before merge ----
1762271981262:integration[, cell := sub(".*_", "", cell)]
1762271981262:nt_cluster[, cell := sub(".*_", "", cell)]
1762271981263:# ---- Merge ----
1762271981264:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1762271981265:# ---- Summarize counts ----
1762271981265:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762271981266:setnames(summary_counts, "N", "n_cells")
1762271981267:# ---- Add proportions per cluster ----
1762271981267:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762271981268:# ---- Sort for readability ----
1762271981269:setorder(summary_counts, integration_cluster, -n_cells)
1762271981269:return(summary_counts)
1762271981270:}
1762271992434:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762271992435:#'
1762271992435:#' This function merges Seurat integration results with cell type annotations
1762271992436:#' and summarizes the number and proportion of cells of each type
1762271992436:#' per integration cluster and tissue type (Normal/Tumor).
1762271992436:#'
1762271992437:#' @return data.table with columns:
1762271992437:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762271992437:#' @export
1762271992438:final_task_dt <- function()
1762271992438:{
1762271992439:suppressPackageStartupMessages(library(data.table))
1762271992440:# ---- Load data ----
1762271992440:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762271992440:nt_cluster <- fread("~/workspace/nt_combined_clustering.output.csv")
1762271992441:# ---- Standardize column names ----
1762271992441:setnames(integration, tolower(trimws(names(integration))))
1762271992442:setnames(nt_cluster, tolower(trimws(names(nt_cluster))))
1762271992442:# ---- Remove possible sample prefixes before merge ----
1762271992443:integration[, cell := sub(".*_", "", cell)]
1762271992443:nt_cluster[, cell := sub(".*_", "", cell)]
1762271992444:# ---- Merge ----
1762271992445:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1762271992461:# ---- Summarize counts ----
1762271992462:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762271992462:setnames(summary_counts, "N", "n_cells")
1762271992463:# ---- Add proportions per cluster ----
1762271992463:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762271992463:# ---- Sort for readability ----
1762271992463:setorder(summary_counts, integration_cluster, -n_cells)
1762271992464:return(summary_counts)
1762271992464:}
1762271995866:View(final_task_dt)
1762272024232:length(intersect(integration$cell, nt_cluster$cell))
1762272080203:#' final_task_dt — Associate cell types to integration clusters (data.table)
1762272080204:#'
1762272080204:#' This function merges Seurat integration results with cell type annotations
1762272080205:#' and summarizes the number and proportion of cells of each type
1762272080205:#' per integration cluster and tissue type (Normal/Tumor).
1762272080206:#'
1762272080207:#' @return data.table with columns:
1762272080207:#' integration_cluster, sample_type, cell_type, n_cells, prop
1762272080207:#' @export
1762272080208:final_task_dt <- function()
1762272080208:{
1762272080208:suppressPackageStartupMessages(library(data.table))
1762272080209:# ---- Load data ----
1762272080210:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762272080210:nt_cluster <- fread("~/workspace/nt_combined_clustering.output.csv")
1762272080211:# ---- Standardize column names ----
1762272080211:setnames(integration, tolower(trimws(names(integration))))
1762272080212:setnames(nt_cluster, tolower(trimws(names(nt_cluster))))
1762272080212:# ---- Remove possible sample prefixes before merge ----
1762272080212:integration[, cell := sub(".*_", "", cell)]
1762272080213:nt_cluster[, cell := sub(".*_", "", cell)]
1762272080214:# ---- Merge ----
1762272080214:merged <- merge(integration, nt_cluster, by = "cell", all.x = TRUE)
1762272080215:# ---- Summarize counts ----
1762272080215:summary_counts <- merged[, .N, by = .(integration_cluster, sample_type, cell_type)]
1762272080215:setnames(summary_counts, "N", "n_cells")
1762272080216:# ---- Add proportions per cluster ----
1762272080216:summary_counts[, prop := n_cells / sum(n_cells), by = integration_cluster]
1762272080217:# ---- Sort for readability ----
1762272080217:setorder(summary_counts, integration_cluster, -n_cells)
1762272080218:return(summary_counts)
1762272080218:}
1762272088884:# Sample 20 cell IDs from each file
1762272088885:head(integration$cell, 20)
1762272179691:library(data.table)
1762272179700:integration <- fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv")
1762272179755:nt_cluster  <- fread("~/workspace/nt_combined_clustering.output.csv")
1762272179767:# Standardize column names like in your function
1762272179768:setnames(integration, tolower(trimws(names(integration))))
1762272179768:setnames(nt_cluster,  tolower(trimws(names(nt_cluster))))
1762272189757:# Sample 20 cell IDs from each file
1762272189759:head(integration$cell, 20)
1762272189761:head(nt_cluster$cell, 20)
1762272189763:# Count exact matches between the two files
1762272189763:length(intersect(integration$cell, nt_cluster$cell))
1762272301968:head(integration$cell, 10)
1762272301971:head(nt_cluster$cell, 10)
1762272331163:integration[, cell_clean := gsub("-1$", "", cell)]
1762272331192:nt_cluster[, cell_clean := gsub("-1$", "", cell)]
1762272331197:integration[, cell_clean := tolower(cell_clean)]
1762272331208:nt_cluster[, cell_clean := tolower(cell_clean)]
1762272331217:length(intersect(integration$cell_clean, nt_cluster$cell_clean))
1762272390966:# Standardize IDs
1762272390967:integration[, cell_clean := gsub("_X_", "", cell)]
1762272390981:nt_cluster[, cell_clean := cell]   # nt already clean
1762272390983:# Ensure lowercase just in case
1762272390983:integration[, cell_clean := tolower(cell_clean)]
1762272390990:nt_cluster[, cell_clean := tolower(cell_clean)]
1762272390994:# check match
1762272390995:length(intersect(integration$cell_clean, nt_cluster$cell_clean))
1762281040128:?task3_join_and_index
1762376606592:git init
1762376635545:git init
1762422026606:suppressPackageStartupMessages(library(data.table))
1762422027014:# ---- Load data ----
1762422027015:counts <- fread("~/workspace/bulk_counts_long.csv")
1762422028165:meta   <- fread("~/workspace/sample_metadata.csv")
1762422028720:# ---- Standardize column names ----
1762422028721:setnames(counts, tolower(trimws(names(counts))))
1762422029717:setnames(meta,   tolower(trimws(names(meta))))
1762422030363:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1762422030364:filtered <- counts[grepl("^GENE_00", gene)]
1762422030804:# Join to get condition info
1762422030805:setkey(meta, sample_id)
1762422031366:filtered <- meta[filtered, on = "sample_id"]
1762422031729:filtered <- filtered[condition == "treated"]
1762422032100:# ---- 2️⃣ Compute mean and median count by gene ----
1762422032100:summary_gene <- filtered[, .(
1762422032101:mean_count   = mean(count),
1762422032101:median_count = median(count)
1762422032101:), by = gene]
1762422032416:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene (in one pipeline) ----
1762422032417:per_condition_summary <- meta[counts, on = "sample_id"
1762422032417:][, .(mean_count = mean(count)), by = .(gene, condition)]
1762422037351:suppressPackageStartupMessages(library(data.table))
1762422037681:# ---- Load data ----
1762422037682:counts <- as.data.frame(fread("~/workspace/bulk_counts_long.csv"))
1762422037910:meta   <- as.data.frame(fread("~/workspace/sample_metadata.csv"))
1762422038162:# ---- Standardize column names ----
1762422038163:names(counts) <- tolower(trimws(names(counts)))
1762422038366:names(meta)   <- tolower(trimws(names(meta)))
1762422038583:# ---- 1️⃣ Filter: keep only treated samples and genes starting with "GENE_00" ----
1762422038584:filtered <- subset(counts, grepl("^GENE_00", gene))
1762422038782:# Join metadata (same direction as data.table: meta[filtered, on="sample_id"])
1762422038784:filtered <- merge(meta, filtered, by = "sample_id", all.y = TRUE)
1762422038982:# Keep only treated samples
1762422038983:filtered <- subset(filtered, condition == "treated")
1762422039218:# ---- 2️⃣ Compute mean and median count by gene ----
1762422039218:summary_gene <- aggregate(filtered$count,
1762422039218:by = list(gene = filtered$gene),
1762422039219:FUN = function(x) c(mean = mean(x), median = median(x)))
1762422039417:summary_gene <- data.frame(
1762422039417:gene = summary_gene$gene,
1762422039418:mean_count = summary_gene$x[, "mean"],
1762422039418:median_count = summary_gene$x[, "median"]
1762422039419:)
1762422039618:# ---- 3️⃣ Join metadata and compute per-condition mean counts by gene ----
1762422039618:merged <- merge(meta, counts, by = "sample_id", all.y = TRUE)
1762422039813:per_condition_summary <- aggregate(merged$count,
1762422039814:by = list(gene = merged$gene, condition = merged$condition),
1762422039814:FUN = mean)
1762422040027:names(per_condition_summary)[3] <- "mean_count"
1762422040250:# ---- Output preview ----
1762422040251:cat("\n✅ Summary of treated GENE_00 genes:\n")
1762422040484:print(head(summary_gene))
1762422040666:cat("\n✅ Per-condition mean counts by gene:\n")
1762422040886:print(head(per_condition_summary))
1762422050534:suppressPackageStartupMessages(library(data.table))
1762422050884:# ---- Load data ----
1762422050884:counts <- fread("~/workspace/bulk_counts_long.csv")
1762422051083:# ---- Standardize column names ----
1762422051084:setnames(counts, tolower(trimws(names(counts))))
1762422051300:# ---- 1️⃣ Add log2(count) column ----
1762422051301:# Add a small offset (e.g. +1) to avoid log(0) errors
1762422051301:counts[, log2_count := log2(count + 1)]
1762422051502:# ---- 2️⃣ Add a binary flag 'high' if count > 100 ----
1762422051503:counts[, high := count > 100]
1762422051700:# ---- 3️⃣ Overwrite 'high' to use a gene-wise threshold ----
1762422051701:# For each gene, compute its median count, then mark high if above that median
1762422051701:counts[, high := count > median(count), by = gene]
1762422051917:# ---- Output preview ----
1762422051919:cat("✅ Added derived columns:\n")
1762422052099:print(head(counts))
1762422060117:suppressPackageStartupMessages(library(data.table))
1762422060431:# ---- Load data ----
1762422060432:peaks <- fread("~/workspace/atac_peaks.bed.csv")
1762422060950:# ---- Standardize column names ----
1762422060950:setnames(peaks, tolower(trimws(names(peaks))))
1762422061216:# ---- Filter: peaks on chr2 with start between 2–4 Mb ----
1762422061216:filtered <- peaks[chr == "chr2" & start >= 2e6 & start <= 4e6]
1762422061433:# ---- Order by descending score and select top 50 ----
1762422061434:setorder(filtered, -score)
1762422061633:top50 <- filtered[1:50]
1762422061813:# ---- Output preview ----
1762422061814:print(head(top50))
1762422067667:suppressPackageStartupMessages(library(data.table))
1762422067944:# ---- Load data ----
1762422067944:labs   <- fread("~/workspace/clinical_labs.csv")
1762422068200:vitals <- fread("~/workspace/vitals_time_series.csv")
1762422068398:# ---- Standardize column names ----
1762422068400:setnames(labs,   tolower(trimws(names(labs))))
1762422068582:setnames(vitals, tolower(trimws(names(vitals))))
1762422068748:# Rename 'time_iso' to 'time'
1762422068748:setnames(labs,   "time_iso", "time")
1762422069065:setnames(vitals, "time_iso", "time")
1762422074751:suppressPackageStartupMessages(library(data.table))
1762422075000:# ---- Load data ----
1762422075001:peaks <- fread("~/workspace/atac_peaks.bed.csv")
1762422075232:genes <- fread("~/workspace/gene_annotation.bed.csv")
1762422075432:# ---- Standardize column names ----
1762422075432:setnames(peaks, tolower(trimws(names(peaks))))
1762422075615:setnames(genes, tolower(trimws(names(genes))))
1762422075784:# ---- Key by chromosome and coordinates ----
1762422075785:setkey(peaks, chr, start, end)
1762422075948:setkey(genes, chr, start, end)
1762448661120:getwd()
1762448720122:suppressPackageStartupMessages(library(data.table))
1762448720437:# ---- Load data ----
1762448720437:integration <- as.data.frame(fread("~/workspace/annotated_GSM3516673_normal_annotated_GSM3516672_tumor_SeuratIntegration.csv"))
1762448720987:nt_cluster  <- as.data.frame(fread("~/workspace/nt_combined_clustering.output.csv"))
1762448721437:# ---- Standardize column names ----
1762448721438:names(integration) <- tolower(trimws(names(integration)))
1762448721987:names(nt_cluster)  <- tolower(trimws(names(nt_cluster)))
1762448809425:source("~/benchmark_tasks.R")
1762448844875:source("~/Tasks /benchmark_tasks.R")
1762449133687:getwd()
1762449198699:git rev-parse --show-toplevel
